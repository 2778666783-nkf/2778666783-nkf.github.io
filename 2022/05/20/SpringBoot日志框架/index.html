

<!DOCTYPE html>
<html lang="zh-CN" data-default-color-scheme=auto>



<head>
  <meta charset="UTF-8">
  <link rel="apple-touch-icon" sizes="76x76" href="/img/fluid.png">
  <link rel="icon" href="/img/fluid.png">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="author" content="温笙">
  <meta name="keywords" content="">
  
    <meta name="description" content="第一章 日志的概念一、概述日志文件是用于记录系统操作事件的文件集合，可以分为事件日志和消息日志。具有处理历史数据，诊断问题的追踪以及理解系统的活动等重要作用 在计算机中，日志文件是记录操作系统或其他软件运行中发生的事件或在通信软件的不同用户之间的消息的记录的文件，记录是保持日志的行为，在最简单的情况下，消息写入单个日志文件 二、日志的作用 测试 在java项目调试时，查看栈信息可以方便地知道当前程">
<meta property="og:type" content="article">
<meta property="og:title" content="SpringBoot日志框架">
<meta property="og:url" content="http://example.com/2022/05/20/SpringBoot%E6%97%A5%E5%BF%97%E6%A1%86%E6%9E%B6/index.html">
<meta property="og:site_name" content="WS CODE">
<meta property="og:description" content="第一章 日志的概念一、概述日志文件是用于记录系统操作事件的文件集合，可以分为事件日志和消息日志。具有处理历史数据，诊断问题的追踪以及理解系统的活动等重要作用 在计算机中，日志文件是记录操作系统或其他软件运行中发生的事件或在通信软件的不同用户之间的消息的记录的文件，记录是保持日志的行为，在最简单的情况下，消息写入单个日志文件 二、日志的作用 测试 在java项目调试时，查看栈信息可以方便地知道当前程">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://example.com/local_blog/springboot/SpringBoot%E6%97%A5%E5%BF%97%E6%A1%86%E6%9E%B6/image-20220315123657205.png">
<meta property="og:image" content="http://example.com/local_blog/springboot/SpringBoot%E6%97%A5%E5%BF%97%E6%A1%86%E6%9E%B6/image-20220315142048210.png">
<meta property="og:image" content="http://example.com/local_blog/springboot/SpringBoot%E6%97%A5%E5%BF%97%E6%A1%86%E6%9E%B6/image-20220315142211926.png">
<meta property="og:image" content="http://example.com/local_blog/springboot/SpringBoot%E6%97%A5%E5%BF%97%E6%A1%86%E6%9E%B6/image-20220315142333792.png">
<meta property="og:image" content="http://example.com/local_blog/springboot/SpringBoot%E6%97%A5%E5%BF%97%E6%A1%86%E6%9E%B6/image-20220315142408197.png">
<meta property="og:image" content="http://example.com/local_blog/springboot/SpringBoot%E6%97%A5%E5%BF%97%E6%A1%86%E6%9E%B6/image-20220315143019303.png">
<meta property="og:image" content="http://example.com/local_blog/springboot/SpringBoot%E6%97%A5%E5%BF%97%E6%A1%86%E6%9E%B6/image-20220315144221904.png">
<meta property="og:image" content="http://example.com/local_blog/springboot/SpringBoot%E6%97%A5%E5%BF%97%E6%A1%86%E6%9E%B6/image-20220315145229684.png">
<meta property="og:image" content="http://example.com/local_blog/springboot/SpringBoot%E6%97%A5%E5%BF%97%E6%A1%86%E6%9E%B6/image-20220315150455275.png">
<meta property="og:image" content="http://example.com/local_blog/springboot/SpringBoot%E6%97%A5%E5%BF%97%E6%A1%86%E6%9E%B6/image-20220316112850137.png">
<meta property="og:image" content="http://example.com/local_blog/springboot/SpringBoot%E6%97%A5%E5%BF%97%E6%A1%86%E6%9E%B6/image-20220316142932951.png">
<meta property="og:image" content="http://example.com/local_blog/springboot/SpringBoot%E6%97%A5%E5%BF%97%E6%A1%86%E6%9E%B6/image-20220316143016163.png">
<meta property="og:image" content="http://example.com/local_blog/springboot/SpringBoot%E6%97%A5%E5%BF%97%E6%A1%86%E6%9E%B6/image-20220316143429825-16474124707221.png">
<meta property="og:image" content="http://example.com/local_blog/springboot/SpringBoot%E6%97%A5%E5%BF%97%E6%A1%86%E6%9E%B6/image-20220316225755166-16474426759331.png">
<meta property="article:published_time" content="2022-05-20T06:29:47.000Z">
<meta property="article:modified_time" content="2022-05-20T06:30:17.977Z">
<meta property="article:author" content="温笙">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="http://example.com/local_blog/springboot/SpringBoot%E6%97%A5%E5%BF%97%E6%A1%86%E6%9E%B6/image-20220315123657205.png">
  
  
  
  <title>SpringBoot日志框架 - WS CODE</title>

  <link  rel="stylesheet" href="https://lib.baomitu.com/twitter-bootstrap/4.6.1/css/bootstrap.min.css" />



  <link  rel="stylesheet" href="https://lib.baomitu.com/github-markdown-css/4.0.0/github-markdown.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/hint.css/2.7.0/hint.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.css" />



<!-- 主题依赖的图标库，不要自行修改 -->
<!-- Do not modify the link that theme dependent icons -->

<link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_hj8rtnfg7um.css">



<link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_lbnruvf0jn.css">


<link  rel="stylesheet" href="/css/main.css" />


  <link id="highlight-css" rel="stylesheet" href="/css/highlight.css" />
  
    <link id="highlight-css-dark" rel="stylesheet" href="/css/highlight-dark.css" />
  




  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    Fluid.ctx = Object.assign({}, Fluid.ctx)
    var CONFIG = {"hostname":"example.com","root":"/","version":"1.9.0","typing":{"enable":true,"typeSpeed":70,"cursorChar":"_","loop":false,"scope":["home","post","tag","category","about","links","page",404]},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"left","visible":"hover","icon":""},"progressbar":{"enable":true,"height_px":3,"color":"#29d","options":{"showSpinner":false,"trickleSpeed":100}},"code_language":{"enable":true,"default":"JAVA"},"copy_btn":true,"image_caption":{"enable":true},"image_zoom":{"enable":true,"img_url_replace":["",""]},"toc":{"enable":true,"placement":"right","headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":0},"lazyload":{"enable":true,"loading_img":"/img/loading.gif","onlypost":false,"offset_factor":2},"web_analytics":{"enable":false,"follow_dnt":true,"baidu":null,"google":null,"gtag":null,"tencent":{"sid":null,"cid":null},"woyaola":null,"cnzz":null,"leancloud":{"app_id":null,"app_key":null,"server_url":null,"path":"window.location.pathname","ignore_local":false}},"search_path":"/local-search.xml"};

    if (CONFIG.web_analytics.follow_dnt) {
      var dntVal = navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack;
      Fluid.ctx.dnt = dntVal && (dntVal.startsWith('1') || dntVal.startsWith('yes') || dntVal.startsWith('on'));
    }
  </script>
  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>

  
<meta name="generator" content="Hexo 6.2.0"></head>


<body>
  

  <header>
    

<div class="header-inner" style="height: 70vh;">
  <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand" href="/">
      <strong>ws code</strong>
    </a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/">
                <i class="iconfont icon-home-fill"></i>
                首页
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/">
                <i class="iconfont icon-archive-fill"></i>
                归档
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/categories/">
                <i class="iconfont icon-category-fill"></i>
                分类
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/">
                <i class="iconfont icon-tags-fill"></i>
                标签
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/">
                <i class="iconfont icon-user-fill"></i>
                关于
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search">
              &nbsp;<i class="iconfont icon-search"></i>&nbsp;
            </a>
          </li>
          
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle">&nbsp;<i
                class="iconfont icon-dark" id="color-toggle-icon"></i>&nbsp;</a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

  

<div id="banner" class="banner" parallax=true
     style="background: url('/img/default.png') no-repeat center center; background-size: cover;">
  <div class="full-bg-img">
    <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
      <div class="banner-text text-center fade-in-up">
        <div class="h2">
          
            <span id="subtitle" data-typed-text="SpringBoot日志框架"></span>
          
        </div>

        
          
  <div class="mt-3">
    
    
      <span class="post-meta">
        <i class="iconfont icon-date-fill" aria-hidden="true"></i>
        <time datetime="2022-05-20 14:29" pubdate>
          2022年5月20日 下午
        </time>
      </span>
    
  </div>

  <div class="mt-1">
    
      <span class="post-meta mr-2">
        <i class="iconfont icon-chart"></i>
        
          85k 字
        
      </span>
    

    
      <span class="post-meta mr-2">
        <i class="iconfont icon-clock-fill"></i>
        
        
        
          711 分钟
        
      </span>
    

    
    
  </div>


        
      </div>

      
    </div>
  </div>
</div>

</div>

  </header>

  <main>
    
      

<div class="container-fluid nopadding-x">
  <div class="row nomargin-x">
    <div class="side-col d-none d-lg-block col-lg-2">
      

    </div>

    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div id="board">
          <article class="post-content mx-auto">
            <!-- SEO header -->
            <h1 style="display: none">SpringBoot日志框架</h1>
            
            <div class="markdown-body">
              
              <h1 id="第一章-日志的概念"><a href="#第一章-日志的概念" class="headerlink" title="第一章 日志的概念"></a>第一章 日志的概念</h1><h2 id="一、概述"><a href="#一、概述" class="headerlink" title="一、概述"></a>一、概述</h2><p>日志文件是用于记录系统操作事件的文件集合，可以分为事件日志和消息日志。具有处理历史数据，诊断问题的追踪以及理解系统的活动等重要作用</p>
<p>在计算机中，日志文件是记录操作系统或其他软件运行中发生的事件或在通信软件的不同用户之间的消息的记录的文件，记录是保持日志的行为，在最简单的情况下，消息写入单个日志文件</p>
<h2 id="二、日志的作用"><a href="#二、日志的作用" class="headerlink" title="二、日志的作用"></a>二、日志的作用</h2><ul>
<li><p>测试</p>
<p>在java项目调试时，查看栈信息可以方便地知道当前程序的运行状态，输出的日志便于记录程序在之前的运行结果，如果大量的使用out和err，这是一种最方便有效的方法，但是不够专业</p>
</li>
<li><p>错误定位</p>
<p>不要以为项目能正确运行就可以高枕无忧，项目在运行一段时间之后，可能由于数据问题，网络问题，内存问题出现异常，这时日志可以帮助开发者快速定位错误位置，提出解决方案</p>
</li>
<li><p>数据分析</p>
<p>大数据的兴起，使得大量的日志分析，成为可能，ELK也让日志分析门槛降低了许多，日志中蕴含了大量的用户数据，包括点击行为，兴趣等，用户画像对于公司下一步的战略方向有一定的指导作用</p>
</li>
</ul>
<h2 id="三、接触过的日志"><a href="#三、接触过的日志" class="headerlink" title="三、接触过的日志"></a>三、接触过的日志</h2><p>最简单的日志输出</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java">System.out.print(<span class="hljs-string">&#x27;xxx&#x27;</span>)<br></code></pre></td></tr></table></figure>

<p>以及错误日志：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java">System.err.println(<span class="hljs-string">&quot;此处发生了异常&quot;</span>);<br></code></pre></td></tr></table></figure>

<p>此类代码在程序的执行过程中没有什么实质的作用，但是却能打印一些中间变量，辅助我们调试和错误的排查。</p>
<p>日志系统我们也见过：</p>
<p>在tomcat中</p>
<p><img src="/../../../local_blog/springboot/SpringBoot%E6%97%A5%E5%BF%97%E6%A1%86%E6%9E%B6/image-20220315123657205.png" srcset="/img/loading.gif" lazyload alt="image-20220315123657205"></p>
<p>当我们的程序无法启动或者运行过程中产生问题，会有所记录，比如我的catalina.log中查看，发现确实有错误信息，这能帮我们迅速定位：</p>
<p>而我们的<code>System.err</code>只能做到控制台打印日志，所以我们需要更强大日志框架来处理：</p>
<h2 id="四、主流日志框架"><a href="#四、主流日志框架" class="headerlink" title="四、主流日志框架"></a>四、主流日志框架</h2><ul>
<li>日志实现（具体干活的）：JUL（java util logging）、logback、log4j、log4j2</li>
<li>日志门面（指定规则的）：JCL（Jakarta Commons Logging）、slf4j（ Simple Logging Facade for Java）</li>
</ul>
<h1 id="第二章-JUL日志框架"><a href="#第二章-JUL日志框架" class="headerlink" title="第二章 JUL日志框架"></a>第二章 JUL日志框架</h1><p>JUL全称Java util Logging是java原生的日志框架，使用时不需要另外引用第三方类库，相对其他日志框 架使用方便，学习简单，能够在小型应用中灵活使用。</p>
<p>在JUL中有以下组件，我们先做了解，慢慢学习：</p>
<ul>
<li>Loggers：被称为记录器，应用程序通过获取Logger对象，调用其API来来发布日志信息。Logger 通常时应用程序访问日志系统的入口程序。</li>
<li>Appenders：也被称为Handlers，每个Logger都会关联一组Handlers，Logger会将日志交给关联 Handlers处理，由Handlers负责将日志做记录。Handlers在此是一个抽象，其具体的实现决定了 日志记录的位置可以是控制台、文件、网络上的其他日志服务或操作系统日志等。</li>
<li>Layouts：也被称为Formatters，它负责对日志事件中的数据进行转换和格式化。Layouts决定了 数据在一条日志记录中的最终形式。</li>
<li>Level：每条日志消息都有一个关联的日志级别。该级别粗略指导了日志消息的重要性和紧迫，我 可以将Level和Loggers，Appenders做关联以便于我们过滤消息。</li>
<li>Filters：过滤器，根据需要定制哪些信息会被记录，哪些信息会被放过。</li>
</ul>
<p><strong>总结一下就是：</strong></p>
<p> 用户使用Logger来进行日志记录，Logger持有若干个Handler，日志的输出操作是由Handler完成的。 在Handler在输出日志前，会经过Filter的过滤，判断哪些日志级别过滤放行哪些拦截，Handler会将日志内容输出到指定位置（日志文件、控制台等）。Handler在输出日志时会使用Layout，将输出内容进行排版。</p>
<h2 id="一、入门案例"><a href="#一、入门案例" class="headerlink" title="一、入门案例"></a>一、入门案例</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// 获取 logger 对象</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">Logger</span> <span class="hljs-variable">LOGGER</span> <span class="hljs-operator">=</span> Logger.getLogger(<span class="hljs-string">&quot;myLog&quot;</span>);<br><br><span class="hljs-meta">@Test</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">testJUL</span><span class="hljs-params">()</span>&#123;<br>    LOGGER.severe(<span class="hljs-string">&quot;十分严重的日志&quot;</span>);<br>    LOGGER.warning(<span class="hljs-string">&quot;警告&quot;</span>);<br>    LOGGER.info(<span class="hljs-string">&quot;信息&quot;</span>);<br>    LOGGER.fine(<span class="hljs-string">&quot;fine&quot;</span>);<br>    LOGGER.finer(<span class="hljs-string">&quot;finer&quot;</span>);<br>    LOGGER.finest(<span class="hljs-string">&quot;finest&quot;</span>);<br>&#125;<br></code></pre></td></tr></table></figure>

<p><img src="/../../../local_blog/springboot/SpringBoot%E6%97%A5%E5%BF%97%E6%A1%86%E6%9E%B6/image-20220315142048210.png" srcset="/img/loading.gif" lazyload alt="image-20220315142048210"></p>
<h2 id="二、日志的级别"><a href="#二、日志的级别" class="headerlink" title="二、日志的级别"></a>二、日志的级别</h2><p> jul中定义的日志级别，从上述例子中我们也看到使用info和warning打印出的日志有不同的前缀，通过给日志设置不同的级别可以清晰的从日志中区分出哪些是基本信息，哪些是调试信息，哪些是严重的异常。</p>
<p>（1）java.util.logging.Level中定义了日志的级别：</p>
<ol>
<li>SEVERE（最高值）</li>
<li>WARNING</li>
<li>INFO （默认级别）</li>
<li>CONFIG</li>
<li>FINE</li>
<li>FINER</li>
<li>FINEST（最低值）</li>
</ol>
<p>再例如：我们查看tomcat的日志，能明显的看到不同级别的日志，其实tomcat默认使用的就是JUL：</p>
<p><img src="/../../../local_blog/springboot/SpringBoot%E6%97%A5%E5%BF%97%E6%A1%86%E6%9E%B6/image-20220315142211926.png" srcset="/img/loading.gif" lazyload alt="image-20220315142211926"></p>
<p>还有两个特殊的级别：</p>
<ul>
<li>OFF，可用来关闭日志记录。</li>
<li>ALL，启用所有消息的日志记录。</li>
</ul>
<p>虽然我们测试了7个日志级别，</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Test</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">testLogger</span><span class="hljs-params">()</span> &#123;<br>    <span class="hljs-type">Logger</span> <span class="hljs-variable">logger</span> <span class="hljs-operator">=</span> Logger.getLogger(LoggerTest.class.getName());<br>    logger.severe(<span class="hljs-string">&quot;severe&quot;</span>);<br>    logger.warning(<span class="hljs-string">&quot;warning&quot;</span>);<br>    logger.info(<span class="hljs-string">&quot;info&quot;</span>);<br>    logger.config(<span class="hljs-string">&quot;config&quot;</span>);<br>    logger.fine(<span class="hljs-string">&quot;fine&quot;</span>);<br>    logger.finer(<span class="hljs-string">&quot;finer&quot;</span>);<br>    logger.finest(<span class="hljs-string">&quot;finest&quot;</span>);<br>&#125;<br></code></pre></td></tr></table></figure>

<p>我们发现能够打印的只有三行，这是为什么呢？</p>
<p>我们找一下这个文件，下图是jdk11的日志配置文件：</p>
<p><img src="/../../../local_blog/springboot/SpringBoot%E6%97%A5%E5%BF%97%E6%A1%86%E6%9E%B6/image-20220315142333792.png" srcset="/img/loading.gif" lazyload alt="image-20220315142333792"></p>
<p>或者在jdk1.8中：</p>
<p><img src="/../../../local_blog/springboot/SpringBoot%E6%97%A5%E5%BF%97%E6%A1%86%E6%9E%B6/image-20220315142408197.png" srcset="/img/loading.gif" lazyload alt="image-20220315142408197"></p>
<p>就可以看到系统默认在控制台打印的日志级别了，系统配置我们暂且不动，一会我们独立创建配置文件完成修改。</p>
<p>但是我们可以简单的看看这个日志配置了哪些内容：</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs properties"><span class="hljs-attr">.level</span>= <span class="hljs-string">INFO</span><br><span class="hljs-comment"></span><br><span class="hljs-comment">############################################################</span><br><span class="hljs-comment"># Handler specific properties.</span><br><span class="hljs-comment"># Describes specific configuration info for Handlers.</span><br><span class="hljs-comment">############################################################</span><br><span class="hljs-comment"></span><br><span class="hljs-comment"># default file output is in user&#x27;s home directory.</span><br><span class="hljs-attr">java.util.logging.FileHandler.pattern</span> = <span class="hljs-string">%h/java%u.log</span><br><span class="hljs-attr">java.util.logging.FileHandler.limit</span> = <span class="hljs-string">50000</span><br><span class="hljs-attr">java.util.logging.FileHandler.count</span> = <span class="hljs-string">1</span><br><span class="hljs-comment"># Default number of locks FileHandler can obtain synchronously.</span><br><span class="hljs-comment"># This specifies maximum number of attempts to obtain lock file by FileHandler</span><br><span class="hljs-comment"># implemented by incrementing the unique field %u as per FileHandler API documentation.</span><br><span class="hljs-attr">java.util.logging.FileHandler.maxLocks</span> = <span class="hljs-string">100</span><br><span class="hljs-attr">java.util.logging.FileHandler.formatter</span> = <span class="hljs-string">java.util.logging.XMLFormatter</span><br><span class="hljs-comment"></span><br><span class="hljs-comment"># Limit the message that are printed on the console to INFO and above.</span><br><span class="hljs-attr">java.util.logging.ConsoleHandler.level</span> = <span class="hljs-string">INFO</span><br><span class="hljs-attr">java.util.logging.ConsoleHandler.formatter</span> = <span class="hljs-string">java.util.logging.SimpleFormatter</span><br></code></pre></td></tr></table></figure>

<p>在日志中我们发现了，貌似可以给这个日志对象添加各种handler就是处理器，比如ConsoleHandler专门处理控制台日志，FileHandler貌似可以处理文件，同时我们确实发现了他有这么一个方法：</p>
<p><img src="/../../../local_blog/springboot/SpringBoot%E6%97%A5%E5%BF%97%E6%A1%86%E6%9E%B6/image-20220315143019303.png" srcset="/img/loading.gif" lazyload alt="image-20220315143019303"></p>
<h2 id="三、日志配置"><a href="#三、日志配置" class="headerlink" title="三、日志配置"></a>三、日志配置</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Test</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">testLogConfig</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>    <span class="hljs-comment">// 1.创建日志记录器对象</span><br>    <span class="hljs-type">Logger</span> <span class="hljs-variable">logger</span> <span class="hljs-operator">=</span> Logger.getLogger(<span class="hljs-string">&quot;com.ydlclass.log.JULTest&quot;</span>);<br>    <br>    <span class="hljs-comment">// 一、自定义日志级别</span><br>    <span class="hljs-comment">// a.关闭系统默认配置</span><br>    logger.setUseParentHandlers(<span class="hljs-literal">false</span>);<br>    <br>    <span class="hljs-comment">// b.创建handler对象</span><br>    <span class="hljs-type">ConsoleHandler</span> <span class="hljs-variable">consoleHandler</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ConsoleHandler</span>();<br>    <br>    <span class="hljs-comment">// c.创建formatter对象</span><br>    <span class="hljs-type">SimpleFormatter</span> <span class="hljs-variable">simpleFormatter</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">SimpleFormatter</span>();<br>    <br>    <span class="hljs-comment">// d.进行关联</span><br>    consoleHandler.setFormatter(simpleFormatter);<br>    logger.addHandler(consoleHandler);<br>    <br>    <span class="hljs-comment">// e.设置日志级别</span><br>    logger.setLevel(Level.ALL);<br>    consoleHandler.setLevel(Level.ALL);<br>    <br>    <span class="hljs-comment">// 二、输出到日志文件</span><br>    <span class="hljs-type">FileHandler</span> <span class="hljs-variable">fileHandler</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">FileHandler</span>(<span class="hljs-string">&quot;d:/logs/jul.log&quot;</span>);<br>    fileHandler.setFormatter(simpleFormatter);<br>    logger.addHandler(fileHandler);<br>    <br>    <span class="hljs-comment">// 2.日志记录输出</span><br>    logger.severe(<span class="hljs-string">&quot;severe&quot;</span>);<br>    logger.warning(<span class="hljs-string">&quot;warning&quot;</span>);<br>    logger.info(<span class="hljs-string">&quot;info&quot;</span>);<br>    logger.config(<span class="hljs-string">&quot;config&quot;</span>);<br>    logger.fine(<span class="hljs-string">&quot;fine&quot;</span>);<br>    logger.finer(<span class="hljs-string">&quot;finer&quot;</span>);<br>    logger.finest(<span class="hljs-string">&quot;finest&quot;</span>);<br>&#125;<br></code></pre></td></tr></table></figure>

<p>再次查看结果：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-number">10</span>月 <span class="hljs-number">21</span>, <span class="hljs-number">2021</span> <span class="hljs-number">11</span>:<span class="hljs-number">50</span>:<span class="hljs-number">01</span> 上午 com.ydlclass.entity.LoggerTest testConfig<br>严重: severe<br><span class="hljs-number">10</span>月 <span class="hljs-number">21</span>, <span class="hljs-number">2021</span> <span class="hljs-number">11</span>:<span class="hljs-number">50</span>:<span class="hljs-number">01</span> 上午 com.ydlclass.entity.LoggerTest testConfig<br>警告: warning<br><span class="hljs-number">10</span>月 <span class="hljs-number">21</span>, <span class="hljs-number">2021</span> <span class="hljs-number">11</span>:<span class="hljs-number">50</span>:<span class="hljs-number">01</span> 上午 com.ydlclass.entity.LoggerTest testConfig<br>信息: info<br><span class="hljs-number">10</span>月 <span class="hljs-number">21</span>, <span class="hljs-number">2021</span> <span class="hljs-number">11</span>:<span class="hljs-number">50</span>:<span class="hljs-number">01</span> 上午 com.ydlclass.entity.LoggerTest testConfig<br>配置: config<br><span class="hljs-number">10</span>月 <span class="hljs-number">21</span>, <span class="hljs-number">2021</span> <span class="hljs-number">11</span>:<span class="hljs-number">50</span>:<span class="hljs-number">01</span> 上午 com.ydlclass.entity.LoggerTest testConfig<br>详细: fine<br><span class="hljs-number">10</span>月 <span class="hljs-number">21</span>, <span class="hljs-number">2021</span> <span class="hljs-number">11</span>:<span class="hljs-number">50</span>:<span class="hljs-number">01</span> 上午 com.ydlclass.entity.LoggerTest testConfig<br>较详细: finer<br><span class="hljs-number">10</span>月 <span class="hljs-number">21</span>, <span class="hljs-number">2021</span> <span class="hljs-number">11</span>:<span class="hljs-number">50</span>:<span class="hljs-number">01</span> 上午 com.ydlclass.entity.LoggerTest testConfig<br>非常详细: finest<br><br>Process finished with exit code <span class="hljs-number">0</span><br></code></pre></td></tr></table></figure>

<h2 id="四、-Logger之间的父子关系"><a href="#四、-Logger之间的父子关系" class="headerlink" title="四、 Logger之间的父子关系"></a>四、 Logger之间的父子关系</h2><p> JUL中Logger之间存在父子关系，这种父子关系通过树状结构存储，JUL在初始化时会创建一个顶层 RootLogger作为所有Logger父Logger，存储上作为树状结构的根节点。并父子关系通过名称来关联。默认子Logger会继承父Logger的属性。</p>
<p><img src="/../../../local_blog/springboot/SpringBoot%E6%97%A5%E5%BF%97%E6%A1%86%E6%9E%B6/image-20220315144221904.png" srcset="/img/loading.gif" lazyload alt="image-20220315144221904"></p>
<p>所有的logger实例都是由LoggerManager统一管理，不妨我们点进getLogger方法：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> Logger <span class="hljs-title function_">demandLogger</span><span class="hljs-params">(String name, String resourceBundleName, Class&lt;?&gt; caller)</span> &#123;<br>    <span class="hljs-type">LogManager</span> <span class="hljs-variable">manager</span> <span class="hljs-operator">=</span> LogManager.getLogManager();<br>    <span class="hljs-keyword">if</span> (!SystemLoggerHelper.disableCallerCheck) &#123;<br>        <span class="hljs-keyword">if</span> (isSystem(caller.getModule())) &#123;<br>            <span class="hljs-keyword">return</span> manager.demandSystemLogger(name, resourceBundleName, caller);<br>        &#125;<br>    &#125;<br>    <span class="hljs-keyword">return</span> manager.demandLogger(name, resourceBundleName, caller);<br>    <span class="hljs-comment">// ends up calling new Logger(name, resourceBundleName, caller)</span><br>    <span class="hljs-comment">// iff the logger doesn&#x27;t exist already</span><br>&#125;<br></code></pre></td></tr></table></figure>

<p>我们可以看到LogManager是单例的：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> LogManager <span class="hljs-title function_">getLogManager</span><span class="hljs-params">()</span> &#123;<br>    <span class="hljs-keyword">if</span> (manager != <span class="hljs-literal">null</span>) &#123;<br>        manager.ensureLogManagerInitialized();<br>    &#125;<br>    <span class="hljs-keyword">return</span> manager;<br>&#125;<br></code></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Test</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">testLogParent</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>    <span class="hljs-type">Logger</span> <span class="hljs-variable">logger1</span> <span class="hljs-operator">=</span> Logger.getLogger(<span class="hljs-string">&quot;com.ydlclass.service&quot;</span>);<br>    <span class="hljs-type">Logger</span> <span class="hljs-variable">logger2</span> <span class="hljs-operator">=</span> Logger.getLogger(<span class="hljs-string">&quot;com.ydlclass&quot;</span>);<br>    System.out.println(<span class="hljs-string">&quot;logger1 = &quot;</span> + logger1);<br>    System.out.println(<span class="hljs-string">&quot;logger1.getParent() = &quot;</span> + logger1.getParent());<br>    System.out.println(<span class="hljs-string">&quot;logger2 = &quot;</span> + logger2);<br>    System.out.println(<span class="hljs-string">&quot;logger2.getParent() = &quot;</span> + logger2.getParent());<br>    System.out.println(logger1.getParent() == logger2);<br>&#125;<br><br>结果：<br>logger1 = java.util.logging.Logger@2b4bac49<br>logger1.getParent() = java.util.logging.Logger<span class="hljs-meta">@fd07cbb</span><br>logger2 = java.util.logging.Logger<span class="hljs-meta">@fd07cbb</span><br>logger2.getParent() = java.util.logging.LogManager$RootLogger@3571b748<br><span class="hljs-literal">true</span><br></code></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Test</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">testLogParent</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>    <span class="hljs-type">Logger</span> <span class="hljs-variable">logger1</span> <span class="hljs-operator">=</span> Logger.getLogger(<span class="hljs-string">&quot;com.ydlclass.service&quot;</span>);<br>    <span class="hljs-type">Logger</span> <span class="hljs-variable">logger2</span> <span class="hljs-operator">=</span> Logger.getLogger(<span class="hljs-string">&quot;com.ydlclass&quot;</span>);<br>    <span class="hljs-comment">// 一、对logger2进行独立的配置</span><br>    <span class="hljs-comment">// 1.关闭系统默认配置</span><br>    logger2.setUseParentHandlers(<span class="hljs-literal">false</span>);<br>    <span class="hljs-comment">// 2.创建handler对象</span><br>    <span class="hljs-type">ConsoleHandler</span> <span class="hljs-variable">consoleHandler</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ConsoleHandler</span>();<br>    <span class="hljs-comment">// 3.创建formatter对象</span><br>    <span class="hljs-type">SimpleFormatter</span> <span class="hljs-variable">simpleFormatter</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">SimpleFormatter</span>();<br>    <span class="hljs-comment">// 4.进行关联</span><br>    consoleHandler.setFormatter(simpleFormatter);<br>    logger2.addHandler(consoleHandler);<br>    <span class="hljs-comment">// 5.设置日志级别</span><br>    logger2.setLevel(Level.ALL);<br>    consoleHandler.setLevel(Level.ALL);<br>    <span class="hljs-comment">// 测试logger1是否被logger2影响</span><br>    logger1.severe(<span class="hljs-string">&quot;severe&quot;</span>);<br>    logger1.warning(<span class="hljs-string">&quot;warning&quot;</span>);<br>    logger1.info(<span class="hljs-string">&quot;info&quot;</span>);<br>    logger1.config(<span class="hljs-string">&quot;config&quot;</span>);<br>    logger1.fine(<span class="hljs-string">&quot;fine&quot;</span>);<br>    logger1.finer(<span class="hljs-string">&quot;finer&quot;</span>);<br>    logger1.finest(<span class="hljs-string">&quot;finest&quot;</span>);<br>&#125;<br>    <br>    <br> <span class="hljs-number">10</span>月 <span class="hljs-number">21</span>, <span class="hljs-number">2021</span> <span class="hljs-number">12</span>:<span class="hljs-number">45</span>:<span class="hljs-number">15</span> 下午 com.ydlclass.entity.LoggerTest testLogParent<br>严重: severe<br><span class="hljs-number">10</span>月 <span class="hljs-number">21</span>, <span class="hljs-number">2021</span> <span class="hljs-number">12</span>:<span class="hljs-number">45</span>:<span class="hljs-number">15</span> 下午 com.ydlclass.entity.LoggerTest testLogParent<br>警告: warning<br><span class="hljs-number">10</span>月 <span class="hljs-number">21</span>, <span class="hljs-number">2021</span> <span class="hljs-number">12</span>:<span class="hljs-number">45</span>:<span class="hljs-number">15</span> 下午 com.ydlclass.entity.LoggerTest testLogParent<br>信息: info<br><span class="hljs-number">10</span>月 <span class="hljs-number">21</span>, <span class="hljs-number">2021</span> <span class="hljs-number">12</span>:<span class="hljs-number">45</span>:<span class="hljs-number">15</span> 下午 com.ydlclass.entity.LoggerTest testLogParent<br>配置: config<br><span class="hljs-number">10</span>月 <span class="hljs-number">21</span>, <span class="hljs-number">2021</span> <span class="hljs-number">12</span>:<span class="hljs-number">45</span>:<span class="hljs-number">15</span> 下午 com.ydlclass.entity.LoggerTest testLogParent<br>详细: fine<br><span class="hljs-number">10</span>月 <span class="hljs-number">21</span>, <span class="hljs-number">2021</span> <span class="hljs-number">12</span>:<span class="hljs-number">45</span>:<span class="hljs-number">15</span> 下午 com.ydlclass.entity.LoggerTest testLogParent<br>较详细: finer<br><span class="hljs-number">10</span>月 <span class="hljs-number">21</span>, <span class="hljs-number">2021</span> <span class="hljs-number">12</span>:<span class="hljs-number">45</span>:<span class="hljs-number">15</span> 下午 com.ydlclass.entity.LoggerTest testLogParent<br>非常详细: finest<br><br>Process finished with exit code <span class="hljs-number">0</span><br></code></pre></td></tr></table></figure>

<h2 id="五、日志格式化"><a href="#五、日志格式化" class="headerlink" title="五、日志格式化"></a>五、日志格式化</h2><p>我们可以独立的实现日志格式化的Formatter，而不使用SimpleFormatter，我们可以做如下处理，最后返回的结果我们可以随意拼写：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-type">Formatter</span> <span class="hljs-variable">myFormatter</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Formatter</span>()&#123;<br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">format</span><span class="hljs-params">(LogRecord record)</span> &#123;<br>        <span class="hljs-keyword">return</span> record.getLoggerName()+<span class="hljs-string">&quot;.&quot;</span> +record.getSourceMethodName() + <span class="hljs-string">&quot; &quot;</span> + LocalDateTime.ofInstant(record.getInstant(), ZoneId.systemDefault())+<span class="hljs-string">&quot;\r\n&quot;</span><br>            +record.getLevel()+<span class="hljs-string">&quot;: &quot;</span> +record.getMessage() + <span class="hljs-string">&quot;\r\n&quot;</span>;<br>    &#125;<br>&#125;;<br></code></pre></td></tr></table></figure>

<p>结果为：</p>
<p><img src="/../../../local_blog/springboot/SpringBoot%E6%97%A5%E5%BF%97%E6%A1%86%E6%9E%B6/image-20220315145229684.png" srcset="/img/loading.gif" lazyload alt="image-20220315145229684"></p>
<p>当然我们参考一下SimpleFormatter的该方法的实现：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// format string for printing the log record</span><br><span class="hljs-keyword">static</span> String <span class="hljs-title function_">getLoggingProperty</span><span class="hljs-params">(String name)</span> &#123;<br>    <span class="hljs-keyword">return</span> LogManager.getLogManager().getProperty(name);<br>&#125;<br><br><span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">format</span> <span class="hljs-operator">=</span><br>    SurrogateLogger.getSimpleFormat(SimpleFormatter::getLoggingProperty);<br><br><span class="hljs-type">ZonedDateTime</span> <span class="hljs-variable">zdt</span> <span class="hljs-operator">=</span> ZonedDateTime.ofInstant(<br>    record.getInstant(), ZoneId.systemDefault());<br><span class="hljs-keyword">return</span> String.format(format,<br>                     zdt,<br>                     source,<br>                     record.getLoggerName(),<br>                     record.getLevel().getLocalizedLevelName(),<br>                     message,<br>                     throwable);<br></code></pre></td></tr></table></figure>

<p>这个写法貌似比我们的写法高级一点，所以我们必须好好学一下String的format方法了。</p>
<h3 id="1、String的format方法"><a href="#1、String的format方法" class="headerlink" title="1、String的format方法"></a>1、String的format方法</h3><p>String类的format()方法用于创建格式化的字符串以及连接多个字符串对象。</p>
<p>format()方法有两种重载形式：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> String <span class="hljs-title function_">format</span><span class="hljs-params">(String format, Object... args)</span> &#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Formatter</span>().format(format, args).toString();<br>&#125;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> String <span class="hljs-title function_">format</span><span class="hljs-params">(Locale l, String format, Object... args)</span> &#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Formatter</span>(l).format(format, args).toString();<br>&#125;<br></code></pre></td></tr></table></figure>

<p>在这个方法中我们可以定义字符串模板，然后使用类似填空的方式将模板格式化成我们想要的结果字符串：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-type">String</span> <span class="hljs-variable">java</span> <span class="hljs-operator">=</span> String.format(<span class="hljs-string">&quot;hello %s&quot;</span>, <span class="hljs-string">&quot;world&quot;</span>);<br></code></pre></td></tr></table></figure>

<p>得到的结果就是hello world，我们可以把第一个参数当做模板， %s当做填空题，后边的可变参数当做答案</p>
<h3 id="2、常用的转换符"><a href="#2、常用的转换符" class="headerlink" title="2、常用的转换符"></a>2、常用的转换符</h3><p>当然不同数据类型需要不同转换符完成字符串的转换，以下是不同类型的转化符列表：</p>
<table>
<thead>
<tr>
<th align="left">转换符</th>
<th align="left">详细说明</th>
<th align="left">示例</th>
</tr>
</thead>
<tbody><tr>
<td align="left"><strong>%s</strong></td>
<td align="left"><strong>字符串类型</strong></td>
<td align="left"><strong>“喜欢请收藏”</strong></td>
</tr>
<tr>
<td align="left">%c</td>
<td align="left">字符类型</td>
<td align="left">‘m’</td>
</tr>
<tr>
<td align="left">%b</td>
<td align="left">布尔类型</td>
<td align="left">true</td>
</tr>
<tr>
<td align="left"><strong>%d</strong></td>
<td align="left"><strong>整数类型（十进制）</strong></td>
<td align="left"><strong>88</strong></td>
</tr>
<tr>
<td align="left">%x</td>
<td align="left">整数类型（十六进制）</td>
<td align="left">FF</td>
</tr>
<tr>
<td align="left">%o</td>
<td align="left">整数类型（八进制）</td>
<td align="left">77</td>
</tr>
<tr>
<td align="left"><strong>%f</strong></td>
<td align="left"><strong>浮点类型</strong></td>
<td align="left"><strong>8.888</strong></td>
</tr>
<tr>
<td align="left">%a</td>
<td align="left">十六进制浮点类型</td>
<td align="left">FF.35AE</td>
</tr>
<tr>
<td align="left">%e</td>
<td align="left">指数类型</td>
<td align="left">9.38e+5</td>
</tr>
<tr>
<td align="left"><strong>%n</strong></td>
<td align="left">换行符</td>
<td align="left"></td>
</tr>
<tr>
<td align="left">%tx</td>
<td align="left">日期与时间类型（x代表不同的日期与时间转换符)</td>
<td align="left">后边详细说</td>
</tr>
</tbody></table>
<p>小例子：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java">System.out.printf(<span class="hljs-string">&quot;过年了，%s今年%d岁了，今天收了%f元的压岁钱!&quot;</span>,<br>                <span class="hljs-string">&quot;小明&quot;</span>,<span class="hljs-number">5</span>,<span class="hljs-number">88.88</span>);<br><br>结果：<br>    过年了，小明今年<span class="hljs-number">5</span>岁了，今天收了<span class="hljs-number">88.880000</span>元的压岁钱!<br></code></pre></td></tr></table></figure>

<h3 id="3、特殊符号"><a href="#3、特殊符号" class="headerlink" title="3、特殊符号"></a>3、特殊符号</h3><p>接下来我们看几个特殊字符的常用搭配，可以实现一些高级功能：</p>
<table>
<thead>
<tr>
<th align="left">标志</th>
<th align="left">说明</th>
<th align="left">示例</th>
<th align="left">结果</th>
</tr>
</thead>
<tbody><tr>
<td align="left">+</td>
<td align="left">为正数或者负数添加符号，因为一般整数不会主动加符号</td>
<td align="left">(“%+d”,15)</td>
<td align="left">+15</td>
</tr>
<tr>
<td align="left">0</td>
<td align="left">数字前面补0，用于对齐</td>
<td align="left">(“%04d”, 99)</td>
<td align="left">0099</td>
</tr>
<tr>
<td align="left">空格</td>
<td align="left">在整数之前添加指定数量的空格</td>
<td align="left">(“%4d”, 99)</td>
<td align="left">99</td>
</tr>
<tr>
<td align="left">,</td>
<td align="left">以“,”对数字分组(常用显示金额)</td>
<td align="left">(“%,f”, 9999.99)</td>
<td align="left">9,999.990000</td>
</tr>
<tr>
<td align="left">(</td>
<td align="left">使用括号包含负数</td>
<td align="left">(“%(f”, -99.99)</td>
<td align="left">(99.990000)</td>
</tr>
</tbody></table>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java">System.out.printf(<span class="hljs-string">&quot;过年了，%s今年%03d岁了，今天收了%,f元的压岁钱!&quot;</span>,<br>                <span class="hljs-string">&quot;小明&quot;</span>,<span class="hljs-number">5</span>,<span class="hljs-number">8888.88</span>);<br>                结果<br>        过年了，小明今年<span class="hljs-number">005</span>岁了，今天收了<span class="hljs-number">8</span>,<span class="hljs-number">888.880000</span>元的压岁钱!        <br></code></pre></td></tr></table></figure>

<p>默认情况下，我们的可变参数是安装顺序依次替换，但是我想重复利用可变参数那该怎么处理呢？</p>
<p>我们可以采用 在转换符中加<code>数字$</code>完成匹配：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java">System.out.printf(<span class="hljs-string">&quot;%1$s %1$s %1$s&quot;</span>,<span class="hljs-string">&quot;小明&quot;</span>);<br></code></pre></td></tr></table></figure>

<p>其中1$就代表第一个参数，那么2$就代表第二个参数了：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java">小明 小明 小明<br></code></pre></td></tr></table></figure>

<h3 id="4、日期处理"><a href="#4、日期处理" class="headerlink" title="4、日期处理"></a>4、日期处理</h3><p>第一个例子中有说到 %tx x代表日期转换符 我也顺便列举下日期转换符</p>
<table>
<thead>
<tr>
<th align="left">标志</th>
<th align="left">说明</th>
<th align="left">示例</th>
</tr>
</thead>
<tbody><tr>
<td align="left">c</td>
<td align="left">包括全部日期和时间信息</td>
<td align="left">周四 10月 21 14:52:10 GMT+08:00 2021</td>
</tr>
<tr>
<td align="left">F</td>
<td align="left">“年-月-日”格式</td>
<td align="left">2021-10-21</td>
</tr>
<tr>
<td align="left">D</td>
<td align="left">“月&#x2F;日&#x2F;年”格式</td>
<td align="left">10&#x2F;21&#x2F;21</td>
</tr>
<tr>
<td align="left">r</td>
<td align="left">“HH:MM:SS PM”格式（12时制）</td>
<td align="left">02:53:20 下午</td>
</tr>
<tr>
<td align="left">T</td>
<td align="left">“HH:MM:SS”格式（24时制）</td>
<td align="left">14:53:39</td>
</tr>
<tr>
<td align="left">R</td>
<td align="left">“HH:MM”格式（24时制）</td>
<td align="left">14:53</td>
</tr>
<tr>
<td align="left">b</td>
<td align="left">月份本地化</td>
<td align="left">10月</td>
</tr>
<tr>
<td align="left">y</td>
<td align="left">两位的年</td>
<td align="left">21</td>
</tr>
<tr>
<td align="left">Y</td>
<td align="left">四位的年</td>
<td align="left">2021</td>
</tr>
<tr>
<td align="left">m</td>
<td align="left">月</td>
<td align="left">10</td>
</tr>
<tr>
<td align="left">d</td>
<td align="left">日</td>
<td align="left">21</td>
</tr>
<tr>
<td align="left">H</td>
<td align="left">24小时制的时</td>
<td align="left">14</td>
</tr>
<tr>
<td align="left">l</td>
<td align="left">12小时制的时</td>
<td align="left">2</td>
</tr>
<tr>
<td align="left">M</td>
<td align="left">分</td>
<td align="left">57</td>
</tr>
<tr>
<td align="left">S</td>
<td align="left">秒</td>
<td align="left">46</td>
</tr>
<tr>
<td align="left">s</td>
<td align="left">秒为单位的时间戳</td>
<td align="left">1634799527</td>
</tr>
<tr>
<td align="left">p</td>
<td align="left">上午还是下午</td>
<td align="left">下午</td>
</tr>
</tbody></table>
<p>我们可以使用以下三个类去进行格式化，其中可能存在不支持的情况，比如LocalDateTime不支持c：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs java">System.out.printf(<span class="hljs-string">&quot;%tc&quot;</span>,<span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>());<br>System.out.printf(<span class="hljs-string">&quot;%tc&quot;</span>,ZonedDateTime.now());<br>System.out.printf(<span class="hljs-string">&quot;%tF&quot;</span>,LocalDateTime.now());<br></code></pre></td></tr></table></figure>

<p>此时我们使用debug查看，默认情况下的fomat，我们不妨来读一读：</p>
<p><img src="/../../../local_blog/springboot/SpringBoot%E6%97%A5%E5%BF%97%E6%A1%86%E6%9E%B6/image-20220315150455275.png" srcset="/img/loading.gif" lazyload alt="image-20220315150455275"></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-number">10</span>月 <span class="hljs-number">21</span>, <span class="hljs-number">2021</span> <span class="hljs-number">2</span>:<span class="hljs-number">23</span>:<span class="hljs-number">42</span> 下午 com.ydlclass.entity.LoggerTest testLogParent<br>警告: warning<br></code></pre></td></tr></table></figure>

<h2 id="六、配置文件"><a href="#六、配置文件" class="headerlink" title="六、配置文件"></a>六、配置文件</h2><p>我们不妨看看一个文件处理器的源码是怎么读配置项的：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">configure</span><span class="hljs-params">()</span> &#123;<br>    <br>        <span class="hljs-type">LogManager</span> <span class="hljs-variable">manager</span> <span class="hljs-operator">=</span> LogManager.getLogManager();<br><br>        <span class="hljs-type">String</span> <span class="hljs-variable">cname</span> <span class="hljs-operator">=</span> getClass().getName();<br><br>        pattern = manager.getStringProperty(cname + <span class="hljs-string">&quot;.pattern&quot;</span>, <span class="hljs-string">&quot;%h/java%u.log&quot;</span>);<br>        limit = manager.getLongProperty(cname + <span class="hljs-string">&quot;.limit&quot;</span>, <span class="hljs-number">0</span>);<br>        <span class="hljs-keyword">if</span> (limit &lt; <span class="hljs-number">0</span>) &#123;<br>            limit = <span class="hljs-number">0</span>;<br>        &#125;<br>        count = manager.getIntProperty(cname + <span class="hljs-string">&quot;.count&quot;</span>, <span class="hljs-number">1</span>);<br>        <span class="hljs-keyword">if</span> (count &lt;= <span class="hljs-number">0</span>) &#123;<br>            count = <span class="hljs-number">1</span>;<br>        &#125;<br>        append = manager.getBooleanProperty(cname + <span class="hljs-string">&quot;.append&quot;</span>, <span class="hljs-literal">false</span>);<br>        setLevel(manager.getLevelProperty(cname + <span class="hljs-string">&quot;.level&quot;</span>, Level.ALL));<br>        setFilter(manager.getFilterProperty(cname + <span class="hljs-string">&quot;.filter&quot;</span>, <span class="hljs-literal">null</span>));<br>        setFormatter(manager.getFormatterProperty(cname + <span class="hljs-string">&quot;.formatter&quot;</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">XMLFormatter</span>()));<br>        <span class="hljs-comment">// Initialize maxLocks from the logging.properties file.</span><br>        <span class="hljs-comment">// If invalid/no property is provided 100 will be used as a default value.</span><br>        maxLocks = manager.getIntProperty(cname + <span class="hljs-string">&quot;.maxLocks&quot;</span>, MAX_LOCKS);<br>        <span class="hljs-keyword">if</span>(maxLocks &lt;= <span class="hljs-number">0</span>) &#123;<br>            maxLocks = MAX_LOCKS;<br>        &#125;<br>        <span class="hljs-keyword">try</span> &#123;<br>            setEncoding(manager.getStringProperty(cname +<span class="hljs-string">&quot;.encoding&quot;</span>, <span class="hljs-literal">null</span>));<br>        &#125; <span class="hljs-keyword">catch</span> (Exception ex) &#123;<br>            <span class="hljs-keyword">try</span> &#123;<br>                setEncoding(<span class="hljs-literal">null</span>);<br>            &#125; <span class="hljs-keyword">catch</span> (Exception ex2) &#123;<br>                <span class="hljs-comment">// doing a setEncoding with null should always work.</span><br>                <span class="hljs-comment">// assert false;</span><br>            &#125;<br>        &#125;<br>    &#125;<br></code></pre></td></tr></table></figure>

<p>可以从以下源码中看到配置项:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">FileHandler</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">StreamHandler</span> &#123;<br>    <span class="hljs-keyword">private</span> MeteredStream meter;<br>    <span class="hljs-keyword">private</span> <span class="hljs-type">boolean</span> append;<br>    <span class="hljs-comment">// 限制文件大小</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-type">long</span> limit;       <span class="hljs-comment">// zero =&gt; no limit.</span><br>    <span class="hljs-comment">// 控制日志文件的数量</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> count;<br>    <span class="hljs-comment">// 日志文件的格式化方式</span><br>    <span class="hljs-keyword">private</span> String pattern;<br>    <span class="hljs-keyword">private</span> String lockFileName;<br>    <span class="hljs-keyword">private</span> FileChannel lockFileChannel;<br>    <span class="hljs-keyword">private</span> File files[];<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">MAX_LOCKS</span> <span class="hljs-operator">=</span> <span class="hljs-number">100</span>;<br>    <span class="hljs-comment">// 可以理解为同时可以有多少个线程打开文件，源码中有介绍</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> <span class="hljs-variable">maxLocks</span> <span class="hljs-operator">=</span> MAX_LOCKS;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> Set&lt;String&gt; locks = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashSet</span>&lt;&gt;();<br>&#125;<br></code></pre></td></tr></table></figure>

<p>我们已经知道系统默认的配置文件的位置，那我们能不能自定义呢？当然可以了，我们从jdk中赋值一个配置文件过来：</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs properties"><span class="hljs-attr">.level</span>= <span class="hljs-string">INFO</span><br><span class="hljs-comment"></span><br><span class="hljs-comment"># default file output is in user&#x27;s home directory.</span><br><span class="hljs-attr">java.util.logging.FileHandler.pattern</span> = <span class="hljs-string">%h/java%u.log</span><br><span class="hljs-attr">java.util.logging.FileHandler.limit</span> = <span class="hljs-string">50000</span><br><span class="hljs-attr">java.util.logging.FileHandler.count</span> = <span class="hljs-string">1</span><br><span class="hljs-comment"></span><br><span class="hljs-comment"># Default number of locks FileHandler can obtain synchronously.</span><br><span class="hljs-comment"># This specifies maximum number of attempts to obtain lock file by FileHandler</span><br><span class="hljs-comment"># implemented by incrementing the unique field %u as per FileHandler API documentation.</span><br><span class="hljs-attr">java.util.logging.FileHandler.maxLocks</span> = <span class="hljs-string">100</span><br><span class="hljs-attr">java.util.logging.FileHandler.formatter</span> = <span class="hljs-string">java.util.logging.XMLFormatter</span><br><span class="hljs-comment"></span><br><span class="hljs-comment"># Limit the message that are printed on the console to INFO and above.</span><br><span class="hljs-attr">java.util.logging.ConsoleHandler.level</span> = <span class="hljs-string">INFO</span><br><span class="hljs-attr">java.util.logging.ConsoleHandler.formatter</span> = <span class="hljs-string">java.util.logging.SimpleFormatter</span><br><span class="hljs-comment"></span><br><span class="hljs-comment"># java.util.logging.SimpleFormatter.format=%4$s: %5$s [%1$tc]%n</span><br></code></pre></td></tr></table></figure>

<p>读取自己的配置文件</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Test</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">testReadConfigurationFile</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> IOException &#123;<br>    <span class="hljs-type">LogManager</span> <span class="hljs-variable">logManager</span> <span class="hljs-operator">=</span> LogManager.getLogManager();<br>    logManager.readConfiguration(Thread.currentThread().getContextClassLoader().getResourceAsStream(<span class="hljs-string">&quot;log.properties&quot;</span>));<br>    <span class="hljs-type">Logger</span> <span class="hljs-variable">logger</span> <span class="hljs-operator">=</span> Logger.getLogger(<span class="hljs-built_in">this</span>.getClass().getName());<br>    logger.fine(<span class="hljs-string">&quot;fine&quot;</span>);<br>&#125;<br></code></pre></td></tr></table></figure>

<h1 id="第三章-LOG4J-日志框架"><a href="#第三章-LOG4J-日志框架" class="headerlink" title="第三章 LOG4J 日志框架"></a>第三章 LOG4J 日志框架</h1><p>Log4j是Apache下的一款开源的日志框架。 官方网站： <a target="_blank" rel="noopener" href="http://logging.apache.org/log4j/1.2/%EF%BC%8C%E8%BF%99%E6%98%AF%E4%B8%80%E6%AC%BE%E6%AF%94%E8%BE%83%E8%80%81%E7%9A%84%E6%97%A5%E5%BF%97%E6%A1%86%E6%9E%B6%EF%BC%8C%E7%9B%AE%E5%89%8D%E6%96%B0%E7%9A%84log4j2%E5%81%9A%E4%BA%86%E5%BE%88%E5%A4%A7%E7%9A%84%E6%94%B9%E5%8A%A8%EF%BC%8C%E4%BB%BB%E7%84%B6%E6%9C%89%E4%B8%80%E4%BA%9B%E9%A1%B9%E7%9B%AE%E5%9C%A8%E4%BD%BF%E7%94%A8log4j%E3%80%82">http://logging.apache.org/log4j/1.2/，这是一款比较老的日志框架，目前新的log4j2做了很大的改动，任然有一些项目在使用log4j。</a></p>
<h2 id="一、入门案例-1"><a href="#一、入门案例-1" class="headerlink" title="一、入门案例"></a>一、入门案例</h2><ol>
<li><p>建立maven工程</p>
</li>
<li><p>添加依赖</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependencies</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>log4j<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>log4j<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.2.17<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>junit<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>junit<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>4.13.2<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependencies</span>&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">build</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">plugins</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">plugin</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.apache.maven.plugins<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>maven-compiler-plugin<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>3.8.1<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">configuration</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">source</span>&gt;</span>$&#123;maven.compiler.source&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">source</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">target</span>&gt;</span>$&#123;maven.compiler.target&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">target</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">encoding</span>&gt;</span>UTF-8<span class="hljs-tag">&lt;/<span class="hljs-name">encoding</span>&gt;</span><br>            <span class="hljs-tag">&lt;/<span class="hljs-name">configuration</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">plugin</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">plugins</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">build</span>&gt;</span><br></code></pre></td></tr></table></figure>
</li>
<li><p>java代码</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Test</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">testLogger</span><span class="hljs-params">()</span> &#123;<br>    <span class="hljs-type">Logger</span> <span class="hljs-variable">logger</span> <span class="hljs-operator">=</span> Logger.getLogger(Log4jTest.class);<br>    <span class="hljs-comment">// 日志记录输出</span><br>    logger.info(<span class="hljs-string">&quot;hello log4j&quot;</span>);<br>    <span class="hljs-comment">// 日志级别</span><br>    logger.fatal(<span class="hljs-string">&quot;fatal&quot;</span>); <span class="hljs-comment">// 严重错误，一般会造成系统崩溃和终止运行</span><br>    logger.error(<span class="hljs-string">&quot;error&quot;</span>); <span class="hljs-comment">// 错误信息，但不会影响系统运行</span><br>    logger.warn(<span class="hljs-string">&quot;warn&quot;</span>); <span class="hljs-comment">// 警告信息，可能会发生问题</span><br>    logger.info(<span class="hljs-string">&quot;info&quot;</span>); <span class="hljs-comment">// 程序运行信息，数据库的连接、网络、IO操作等</span><br>    logger.debug(<span class="hljs-string">&quot;debug&quot;</span>); <span class="hljs-comment">// 调试信息，一般在开发阶段使用，记录程序的变量、参数等</span><br>    logger.trace(<span class="hljs-string">&quot;trace&quot;</span>); <span class="hljs-comment">// 追踪信息，记录程序的所有流程信息</span><br>&#125;<br></code></pre></td></tr></table></figure>

<p>发现会有一些警告，JUL可以直接在控制台输出是因为他有默认的配置文件，而这个独立的第三方的日志框架却没有配置文件：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs cobol">log4j:WARN No appenders could be found for logger (com.ydlclass.entity.Log4jTest).<br>log4j:WARN Please initialize the log4j system properly.<br>log4j:WARN See http://logging.apache.org/log4j/1.2/faq.html#noconfig for more info.<br></code></pre></td></tr></table></figure>

<p>我们在执行代码之前，加上以下代码，他会初始化一个默认配置：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java">BasicConfigurator.configure();<br></code></pre></td></tr></table></figure>

<p>结果：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs cobol">0 [main] INFO com.ydlclass.entity.Log4jTest  - hello log4j<br>1 [main] FATAL com.ydlclass.entity.Log4jTest  - fatal<br>1 [main] ERROR com.ydlclass.entity.Log4jTest  - error<br>1 [main] WARN com.ydlclass.entity.Log4jTest  - warn<br>1 [main] INFO com.ydlclass.entity.Log4jTest  - info<br>1 [main] DEBUG com.ydlclass.entity.Log4jTest  - debug<br></code></pre></td></tr></table></figure>

<p>log4j定义了以下的日志的级别，和JUL的略有不同：</p>
<ol>
<li>fatal 指出每个严重的错误事件将会导致应用程序的退出。</li>
<li>error 指出虽然发生错误事件，但仍然不影响系统的继续运行。</li>
<li>warn 表明会出现潜在的错误情形。</li>
<li>info 一般和在粗粒度级别上，强调应用程序的运行全程。</li>
<li>debug 一般用于细粒度级别上，对调试应用程序非常有帮助。</li>
<li>trace 是程序追踪，可以用于输出程序运行中的变量，显示执行的流程。</li>
</ol>
<p>和JUL一样：还有两个特殊的级别：OFF，可用来关闭日志记录。 ALL，启用所有消息的日志记录。</p>
<p>一般情况下，我们只使用4个级别，优先级从高到低为 ERROR &gt; WARN &gt; INFO &gt; DEBUG</p>
</li>
</ol>
<h2 id="二、组件讲解"><a href="#二、组件讲解" class="headerlink" title="二、组件讲解"></a>二、组件讲解</h2><p> Log4J 主要由 Loggers (日志记录器)、Appenders（输出端）和 Layout（日志格式化器）组成。其中 Loggers 控制日志的输出级别与日志是否输出；Appenders 指定日志的输出方式（输出到控制台、文件 等）；Layout 控制日志信息的输出格式。</p>
<h4 id="1、Loggers"><a href="#1、Loggers" class="headerlink" title="1、Loggers"></a>1、Loggers</h4><p>日志记录器：负责收集处理日志记录，实例的命名就是类“XX”的full quailied name（类的全限定名）， Logger的名字大小写敏感，其命名有继承机制：例如：name为com.ydlclass.service的logger会继承 name为com.ydlclass的logger，和JUL一致。</p>
<p>Log4J中有一个特殊的logger叫做“root”，他是所有logger的根，也就意味着其他所有的logger都会直接 或者间接地继承自root。root logger可以用Logger.getRootLogger()方法获取。 JUL是不是也有一个名为<code>.</code>的根。</p>
<h4 id="2、Appenders"><a href="#2、Appenders" class="headerlink" title="2、Appenders"></a>2、Appenders</h4><p>Appender和JUL的Handler很像，用来指定日志输出到哪个地方，可以同时指定日志的输出目的地。Log4j 常用的输出目的地 有以下几种：</p>
<table>
<thead>
<tr>
<th>输出端类型</th>
<th>作用</th>
</tr>
</thead>
<tbody><tr>
<td>ConsoleAppender</td>
<td>将日志输出到控制台</td>
</tr>
<tr>
<td>FileAppender</td>
<td>将日志输出到文件中</td>
</tr>
<tr>
<td>DailyRollingFileAppender</td>
<td>将日志输出到一个日志文件，并且每天输出到一个新的文件</td>
</tr>
<tr>
<td>RollingFileAppender</td>
<td>将日志信息输出到一个日志文件，并且指定文件的尺寸，当文件大 小达到指定尺寸时，会自动把文件改名，同时产生一个新的文件</td>
</tr>
<tr>
<td>JDBCAppender</td>
<td>把日志信息保存到数据库中</td>
</tr>
</tbody></table>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// 配置一个控制台输出源</span><br><span class="hljs-type">ConsoleAppender</span> <span class="hljs-variable">consoleAppender</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ConsoleAppender</span>();<br>consoleAppender.setName(<span class="hljs-string">&quot;ydl&quot;</span>);<br>consoleAppender.setWriter(<span class="hljs-keyword">new</span> <span class="hljs-title class_">PrintWriter</span>(System.out));<br>logger.addAppender(consoleAppender);<br></code></pre></td></tr></table></figure>

<h4 id="3、Layouts"><a href="#3、Layouts" class="headerlink" title="3、Layouts"></a>3、Layouts</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-type">Layout</span> <span class="hljs-variable">layout</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Layout</span>() &#123;<br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">format</span><span class="hljs-params">(LoggingEvent loggingEvent)</span> &#123;<br>        <span class="hljs-keyword">return</span> loggingEvent.getLoggerName() + <span class="hljs-string">&quot; &quot;</span><br>            +loggingEvent.getMessage() + <span class="hljs-string">&quot;\r\n&quot;</span>;<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">ignoresThrowable</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">activateOptions</span><span class="hljs-params">()</span> &#123;<br><br>    &#125;<br>&#125;;<br></code></pre></td></tr></table></figure>

<p>有一些默认的实现类：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-type">Layout</span> <span class="hljs-variable">layout</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">SimpleLayout</span>();<br></code></pre></td></tr></table></figure>

<p>他的实现太简单了：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> String <span class="hljs-title function_">format</span><span class="hljs-params">(LoggingEvent event)</span> &#123;<br>    sbuf.setLength(<span class="hljs-number">0</span>);<br>    sbuf.append(event.getLevel().toString());<br>    sbuf.append(<span class="hljs-string">&quot; - &quot;</span>);<br>    sbuf.append(event.getRenderedMessage());<br>    sbuf.append(LINE_SEP);<br>    <span class="hljs-keyword">return</span> sbuf.toString();<br>  &#125;<br></code></pre></td></tr></table></figure>

<p>还有一个比较常用的Layout，就是PatternLayout这个实现类，能够根据特定的占位符进行转化，和JUL很像，但是又不一样，我们庖丁解牛研究一番，首先看他的构造器，构造器中如果传入一个pattern字符串，他会根据这个pattern创建一个链表，这个链表具体干什么咱们慢慢往后看：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-title function_">PatternLayout</span><span class="hljs-params">(String pattern)</span> &#123;<br>    <span class="hljs-built_in">this</span>.pattern = pattern;<br>    head = createPatternParser((pattern == <span class="hljs-literal">null</span>) ? DEFAULT_CONVERSION_PATTERN :<br>                               pattern).parse();<br>&#125;<br></code></pre></td></tr></table></figure>

<p>将步骤拆解开来看，首先创建了一个解析器：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">protected</span> PatternParser <span class="hljs-title function_">createPatternParser</span><span class="hljs-params">(String pattern)</span> &#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">PatternParser</span>(pattern);<br>&#125;<br></code></pre></td></tr></table></figure>

<p>查看parse方法，这个方法比较复杂我们简化来看：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> PatternConverter <span class="hljs-title function_">parse</span><span class="hljs-params">()</span> &#123;<br>    <span class="hljs-type">char</span> c;<br>    i = <span class="hljs-number">0</span>;<br>    <span class="hljs-keyword">while</span>(i &lt; patternLength) &#123;<br>        ...此次省略了很多代码，但是可以从这个核心看出来<br>        c = pattern.charAt(i++);<br>        finalizeConverter(c);<br>    &#125;<br>    <span class="hljs-keyword">return</span> head;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>而finalizeConverter做的工作大家就能看的很清楚了：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">finalizeConverter</span><span class="hljs-params">(<span class="hljs-type">char</span> c)</span> &#123;<br>    <span class="hljs-type">PatternConverter</span> <span class="hljs-variable">pc</span> <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>;<br>    <span class="hljs-keyword">switch</span>(c) &#123;<br>    <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;c&#x27;</span>:<br>      pc = <span class="hljs-keyword">new</span> <span class="hljs-title class_">CategoryPatternConverter</span>(formattingInfo,<br>					extractPrecisionOption());<br>      <span class="hljs-comment">//LogLog.debug(&quot;CATEGORY converter.&quot;);</span><br>      <span class="hljs-comment">//formattingInfo.dump();</span><br>      currentLiteral.setLength(<span class="hljs-number">0</span>);<br>      <span class="hljs-keyword">break</span>;<br>    <span class="hljs-comment">//处理类名的转化器</span><br>    <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;C&#x27;</span>:<br>      pc = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ClassNamePatternConverter</span>(formattingInfo,<br>					 extractPrecisionOption());<br>      <span class="hljs-comment">//LogLog.debug(&quot;CLASS_NAME converter.&quot;);</span><br>      <span class="hljs-comment">//formattingInfo.dump();</span><br>      currentLiteral.setLength(<span class="hljs-number">0</span>);<br>      <span class="hljs-keyword">break</span>;<br>     <span class="hljs-comment">//处理时间的转化器</span><br>    <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;d&#x27;</span>:<br>      <span class="hljs-type">String</span> <span class="hljs-variable">dateFormatStr</span> <span class="hljs-operator">=</span> AbsoluteTimeDateFormat.ISO8601_DATE_FORMAT;<br>      DateFormat df;<br>		... <br>      pc = <span class="hljs-keyword">new</span> <span class="hljs-title class_">DatePatternConverter</span>(formattingInfo, df);<br>      currentLiteral.setLength(<span class="hljs-number">0</span>);<br>      <span class="hljs-keyword">break</span>;<br>    <span class="hljs-comment">//输出日志时间发生的位置，包括类名、线程、及在代码中的行数</span><br>    <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;F&#x27;</span>:<br>      pc = <span class="hljs-keyword">new</span> <span class="hljs-title class_">LocationPatternConverter</span>(formattingInfo,<br>					FILE_LOCATION_CONVERTER);<br>      <span class="hljs-keyword">break</span>;<br>    <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;l&#x27;</span>:<br>      pc = <span class="hljs-keyword">new</span> <span class="hljs-title class_">LocationPatternConverter</span>(formattingInfo,<br>					FULL_LOCATION_CONVERTER);<br>      currentLiteral.setLength(<span class="hljs-number">0</span>);<br>      <span class="hljs-keyword">break</span>;<br>    <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;L&#x27;</span>:<br>      pc = <span class="hljs-keyword">new</span> <span class="hljs-title class_">LocationPatternConverter</span>(formattingInfo,<br>					LINE_LOCATION_CONVERTER);<br>      currentLiteral.setLength(<span class="hljs-number">0</span>);<br>      <span class="hljs-keyword">break</span>;<br>    <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;m&#x27;</span>:<br>      pc = <span class="hljs-keyword">new</span> <span class="hljs-title class_">BasicPatternConverter</span>(formattingInfo, MESSAGE_CONVERTER);<br>      currentLiteral.setLength(<span class="hljs-number">0</span>);<br>      <span class="hljs-keyword">break</span>;<br>    <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;M&#x27;</span>:<br>      pc = <span class="hljs-keyword">new</span> <span class="hljs-title class_">LocationPatternConverter</span>(formattingInfo,<br>					METHOD_LOCATION_CONVERTER);<br>      currentLiteral.setLength(<span class="hljs-number">0</span>);<br>      <span class="hljs-keyword">break</span>;<br>    <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;p&#x27;</span>:<br>      pc = <span class="hljs-keyword">new</span> <span class="hljs-title class_">BasicPatternConverter</span>(formattingInfo, LEVEL_CONVERTER);<br>      currentLiteral.setLength(<span class="hljs-number">0</span>);<br>      <span class="hljs-keyword">break</span>;<br>    <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;r&#x27;</span>:<br>      pc = <span class="hljs-keyword">new</span> <span class="hljs-title class_">BasicPatternConverter</span>(formattingInfo,<br>					 RELATIVE_TIME_CONVERTER);<br>      currentLiteral.setLength(<span class="hljs-number">0</span>);<br>      <span class="hljs-keyword">break</span>;<br>    <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;t&#x27;</span>:<br>      pc = <span class="hljs-keyword">new</span> <span class="hljs-title class_">BasicPatternConverter</span>(formattingInfo, THREAD_CONVERTER);<br>      currentLiteral.setLength(<span class="hljs-number">0</span>);<br>      <span class="hljs-keyword">break</span>;<br>    <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;x&#x27;</span>:<br>      pc = <span class="hljs-keyword">new</span> <span class="hljs-title class_">BasicPatternConverter</span>(formattingInfo, NDC_CONVERTER);<br>      <span class="hljs-comment">//LogLog.debug(&quot;NDC converter.&quot;);</span><br>      currentLiteral.setLength(<span class="hljs-number">0</span>);<br>      <span class="hljs-keyword">break</span>;<br>    <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;X&#x27;</span>:<br>      <span class="hljs-type">String</span> <span class="hljs-variable">xOpt</span> <span class="hljs-operator">=</span> extractOption();<br>      pc = <span class="hljs-keyword">new</span> <span class="hljs-title class_">MDCPatternConverter</span>(formattingInfo, xOpt);<br>      currentLiteral.setLength(<span class="hljs-number">0</span>);<br>      <span class="hljs-keyword">break</span>;<br>    <span class="hljs-keyword">default</span>:<br>      LogLog.error(<span class="hljs-string">&quot;Unexpected char [&quot;</span> +c+<span class="hljs-string">&quot;] at position &quot;</span>+i<br>		   +<span class="hljs-string">&quot; in conversion patterrn.&quot;</span>);<br>      pc = <span class="hljs-keyword">new</span> <span class="hljs-title class_">LiteralPatternConverter</span>(currentLiteral.toString());<br>      currentLiteral.setLength(<span class="hljs-number">0</span>);<br>    &#125;<br><br>    addConverter(pc);<br>  &#125;<br></code></pre></td></tr></table></figure>

<p>下边就是一个典型的链表结构的构建了：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">addConverter</span><span class="hljs-params">(PatternConverter pc)</span> &#123;<br>    currentLiteral.setLength(<span class="hljs-number">0</span>);<br>    <span class="hljs-comment">// Add the pattern converter to the list.</span><br>    addToList(pc);<br>    <span class="hljs-comment">// Next pattern is assumed to be a literal.</span><br>    state = LITERAL_STATE;<br>    <span class="hljs-comment">// Reset formatting info</span><br>    formattingInfo.reset();<br>&#125;<br></code></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span>  <span class="hljs-title function_">addToList</span><span class="hljs-params">(PatternConverter pc)</span> &#123;<br>    <span class="hljs-keyword">if</span>(head == <span class="hljs-literal">null</span>) &#123;<br>        head = tail = pc;<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>        tail.next = pc;<br>        tail = pc;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>构建完转化器链表之后，就是循环这个链表，一次处理对应的占位符了，他的核心的格式化的方法也是format方法，在format方法中是通过一个转化器链来完成转化的：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> String <span class="hljs-title function_">format</span><span class="hljs-params">(LoggingEvent event)</span> &#123;<br>    <span class="hljs-comment">// 在format方法中是通过一个转化器链来完成转化的</span><br>    <span class="hljs-type">PatternConverter</span> <span class="hljs-variable">c</span> <span class="hljs-operator">=</span> head;<br><br>    <span class="hljs-keyword">while</span>(c != <span class="hljs-literal">null</span>) &#123;<br>      <span class="hljs-comment">// 这一句是核心，第一个参数是一个StringBuilder，第二个参数LoggingEvent</span><br>      c.format(sbuf, event);<br>      c = c.next;<br>    &#125;<br>    <span class="hljs-keyword">return</span> sbuf.toString();<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>这里就是通过一个pattern字符串，这个字符串可能张这个样子（%-d{yyyy-MM-dd HH:mm:ss} [%t:%r] -[%p] %m%n），使用createPatternParser().parse()方法构建一个处理器的链表，这个每个处理器处理一个占位符比如（%d）。</p>
<p>进入c.format()方法，我们会进入一个抽象类PatternConverter中的format方法，里边的核心就是如下代码：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">format</span><span class="hljs-params">(StringBuffer sbuf, LoggingEvent e)</span> &#123;<br>    <span class="hljs-comment">// 核心就是这一句</span><br>    <span class="hljs-type">String</span> <span class="hljs-variable">s</span> <span class="hljs-operator">=</span> convert(e);<br>&#125;<br></code></pre></td></tr></table></figure>

<p>log4j 其实采用类似 C 语言的 printf 函数的打印格式格式化日志信息，源码已经看过了，具体的占位符及其含义如下：</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs text">%m 输出代码中指定的日志信息<br>%p 输出日志级别，及 DEBUG、INFO 等<br>%n 换行符（Windows平台的换行符为 &quot;\n&quot;，Unix 平台为 &quot;\n&quot;）<br>%r 输出自应用启动到输出该 log 信息耗费的毫秒数<br>%c 输出打印语句所属的类的全名<br>%t 输出产生该日志的线程全名<br>%d 输出服务器当前时间，默认为 ISO8601，也可以指定格式，如：%d&#123;yyyy年MM月dd日HH:mm:ss&#125;<br>%l 输出日志时间发生的位置，包括类名、线程、及在代码中的行数。如：Test.main(Test.java:10)<br>%F 输出日志消息产生时所在的文件名称<br>%L 输出代码中的行号<br>%% 输出一个 &quot;%&quot; 字符<br>* 可以在 % 与字符之间加上修饰符来控制最小宽度、最大宽度和文本的对其方式。如：<br>%5c 输出category名称，最小宽度是5，category&lt;5，默认的情况下右对齐<br>%-5c 输出category名称，最小宽度是5，category&lt;5，&quot;-&quot;号指定左对齐,会有空格<br>%.5c 输出category名称，最大宽度是5，category&gt;5，就会将左边多出的字符截掉，&lt;5不会有空格<br>%20.30c category名称&lt;20补空格，并且右对齐，&gt;30字符，就从左边交远销出的字符截掉<br></code></pre></td></tr></table></figure>

<p>举一个例子：</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs text">%-d&#123;yyyy-MM-dd HH:mm:ss&#125; [%t:%r] -[%p] %m%n<br>打印：日期 [线程:毫秒数] - [日志级别] - 日志信息 换行<br></code></pre></td></tr></table></figure>

<p>尝试写一个：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Test</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">testLog</span><span class="hljs-params">()</span>&#123;<br>    <span class="hljs-comment">// 获取一个logger</span><br>    <span class="hljs-type">Logger</span> <span class="hljs-variable">logger</span> <span class="hljs-operator">=</span> Logger.getLogger(TestLog4j.class);<br>    <span class="hljs-comment">// 创建一个layout</span><br>    <span class="hljs-type">Layout</span> <span class="hljs-variable">layout</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">PatternLayout</span>(<span class="hljs-string">&quot;%-d&#123;yyyy-MM-dd HH:mm:ss&#125; [%t:%r] -[%p] %m%n&quot;</span>);<br>    <span class="hljs-comment">// 创建一个输出源</span><br>    <span class="hljs-type">ConsoleAppender</span> <span class="hljs-variable">appender</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ConsoleAppender</span>();<br>    appender.setLayout(layout);<br>    appender.setWriter(<span class="hljs-keyword">new</span> <span class="hljs-title class_">PrintWriter</span>(System.out));<br>    logger.addAppender(appender);<br>    logger.warn(<span class="hljs-string">&quot;warning&quot;</span>);<br>&#125;<br><br>结果：<br><span class="hljs-number">2021</span>-<span class="hljs-number">10</span>-<span class="hljs-number">21</span> <span class="hljs-number">21</span>:<span class="hljs-number">31</span>:<span class="hljs-number">05</span> [main:<span class="hljs-number">0</span>] -[WARN] warning<br></code></pre></td></tr></table></figure>

<p>配置一个jdbcAppender</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-type">JDBCAppender</span> <span class="hljs-variable">jdbcAppender</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">JDBCAppender</span>();<br>jdbcAppender.setDriver(<span class="hljs-string">&quot;com.mysql.cj.jdbc.Driver&quot;</span>);<br>jdbcAppender.setURL(<span class="hljs-string">&quot;jdbc:mysql://localhost:3306/ydlclass?characterEncoding=utf8&amp;useSSL=false&amp;serverTimezone=UTC&quot;</span>);<br>jdbcAppender.setUser(<span class="hljs-string">&quot;root&quot;</span>);<br>jdbcAppender.setPassword(<span class="hljs-string">&quot;root&quot;</span>);<br>jdbcAppender.setSql(<span class="hljs-string">&quot;INSERT INTO log(project_name,create_date,level,category,file_name,thread_name,line,all_category,message) values(&#x27;ydlclass&#x27;,&#x27;%d&#123;yyyy-MM-ddHH:mm:ss&#125;&#x27;,&#x27;%p&#x27;,&#x27;%c&#x27;,&#x27;%F&#x27;,&#x27;%t&#x27;,&#x27;%L&#x27;,&#x27;%l&#x27;,&#x27;%m&#x27;)&quot;</span>);<br>        <br></code></pre></td></tr></table></figure>

<p>数据表</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> `log` (<br>    `log_id` <span class="hljs-type">int</span>(<span class="hljs-number">11</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> AUTO_INCREMENT,<br>    `project_name` <span class="hljs-type">varchar</span>(<span class="hljs-number">255</span>) <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">&#x27;目项名&#x27;</span>,<br>    `create_date` <span class="hljs-type">varchar</span>(<span class="hljs-number">255</span>) <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">&#x27;创建时间&#x27;</span>,<br>    `level` <span class="hljs-type">varchar</span>(<span class="hljs-number">255</span>) <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">&#x27;优先级&#x27;</span>,<br>    `category` <span class="hljs-type">varchar</span>(<span class="hljs-number">255</span>) <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">&#x27;所在类的全名&#x27;</span>,<br>    `file_name` <span class="hljs-type">varchar</span>(<span class="hljs-number">255</span>) <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">&#x27;输出日志消息产生时所在的文件名称 &#x27;</span>,<br>    `thread_name` <span class="hljs-type">varchar</span>(<span class="hljs-number">255</span>) <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">&#x27;日志事件的线程名&#x27;</span>,<br>    `line` <span class="hljs-type">varchar</span>(<span class="hljs-number">255</span>) <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">&#x27;号行&#x27;</span>,<br>    `all_category` <span class="hljs-type">varchar</span>(<span class="hljs-number">255</span>) <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">&#x27;日志事件的发生位置&#x27;</span>,<br>    `message` <span class="hljs-type">varchar</span>(<span class="hljs-number">4000</span>) <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">&#x27;输出代码中指定的消息&#x27;</span>,<br>    <span class="hljs-keyword">PRIMARY</span> KEY (`log_id`)<br>);<br></code></pre></td></tr></table></figure>

<p>依赖</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs text">&lt;dependency&gt;<br>    &lt;groupId&gt;mysql&lt;/groupId&gt;<br>    &lt;artifactId&gt;mysql-connector-java&lt;/artifactId&gt;<br>    &lt;version&gt;8.0.22&lt;/version&gt;<br>&lt;/dependency&gt;<br></code></pre></td></tr></table></figure>

<h2 id="三、配置"><a href="#三、配置" class="headerlink" title="三、配置"></a>三、配置</h2><p>log4j不仅仅可以在控制台，文件文件中输出日志，甚至可以在数据库中，我们先使用配置的方式完成日志的输入：</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs properties"><span class="hljs-comment">#指定日志的输出级别与输出端</span><br><span class="hljs-attr">log4j.rootLogger</span>=<span class="hljs-string">INFO,Console,ydl</span><br><span class="hljs-comment"># 控制台输出配置</span><br><span class="hljs-attr">log4j.appender.Console</span>=<span class="hljs-string">org.apache.log4j.ConsoleAppender</span><br><span class="hljs-attr">log4j.appender.Console.layout</span>=<span class="hljs-string">org.apache.log4j.PatternLayout</span><br><span class="hljs-attr">log4j.appender.Console.layout.ConversionPattern</span>=<span class="hljs-string">%d [%t] %-5p [%c] - %m%n</span><br><span class="hljs-comment"># 文件输出配置</span><br><span class="hljs-attr">log4j.appender.ydl</span> = <span class="hljs-string">org.apache.log4j.DailyRollingFileAppender</span><br><span class="hljs-comment">#指定日志的输出路径</span><br><span class="hljs-attr">log4j.appender.ydl.File</span> = <span class="hljs-string">D:/logs/ydl.log</span><br><span class="hljs-attr">log4j.appender.ydl.Append</span> = <span class="hljs-string">true</span><br><span class="hljs-comment">#使用自定义日志格式化器</span><br><span class="hljs-attr">log4j.appender.ydl.layout</span> = <span class="hljs-string">org.apache.log4j.PatternLayout</span><br><span class="hljs-comment">#指定日志的输出格式</span><br><span class="hljs-attr">log4j.appender.ydl.layout.ConversionPattern</span> = <span class="hljs-string">%-d&#123;yyyy-MM-dd HH:mm:ss&#125; [%t:%r] -[%p] %m%n</span><br><span class="hljs-comment">#指定日志的文件编码</span><br><span class="hljs-attr">log4j.appender.ydl.encoding</span>=<span class="hljs-string">UTF-8</span><br></code></pre></td></tr></table></figure>

<p>有了这个配置文件我们些代码就简单了一些：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Test</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">testConfig</span><span class="hljs-params">()</span>&#123;<br>    <span class="hljs-comment">// 获取一个logger</span><br>    <span class="hljs-type">Logger</span> <span class="hljs-variable">logger</span> <span class="hljs-operator">=</span> Logger.getLogger(TestLog4j.class);<br>    logger.warn(<span class="hljs-string">&quot;warning&quot;</span>);<br>&#125;<br><br>结果：<br>    <span class="hljs-number">2021</span>-<span class="hljs-number">10</span>-<span class="hljs-number">21</span> <span class="hljs-number">21</span>:<span class="hljs-number">37</span>:<span class="hljs-number">06</span>,<span class="hljs-number">705</span> [main] WARN  [com.ydlclass.TestLog4j] - warning<br></code></pre></td></tr></table></figure>

<p>当然日志配置文件是什么时候读取的呢？每一个logger都是LogManager创建的，而LogManager有一个静态代码块帮助我们解析配置文件，细节就不需要了解了：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">LogManager</span> &#123;<br><br>  <span class="hljs-comment">/**</span><br><span class="hljs-comment">   * <span class="hljs-doctag">@deprecated</span> This variable is for internal use only. It will</span><br><span class="hljs-comment">   * become package protected in future versions.</span><br><span class="hljs-comment">   * */</span><br>  <span class="hljs-keyword">static</span> <span class="hljs-keyword">public</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">DEFAULT_CONFIGURATION_FILE</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;log4j.properties&quot;</span>;<br>  <br>  <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">DEFAULT_XML_CONFIGURATION_FILE</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;log4j.xml&quot;</span>;  <br>   <br>  <span class="hljs-comment">/**</span><br><span class="hljs-comment">   * <span class="hljs-doctag">@deprecated</span> This variable is for internal use only. It will</span><br><span class="hljs-comment">   * become private in future versions.</span><br><span class="hljs-comment">   * */</span><br>  <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">public</span> String DEFAULT_CONFIGURATION_KEY=<span class="hljs-string">&quot;log4j.configuration&quot;</span>;<br><br>  <span class="hljs-comment">/**</span><br><span class="hljs-comment">   * <span class="hljs-doctag">@deprecated</span> This variable is for internal use only. It will</span><br><span class="hljs-comment">   * become private in future versions.</span><br><span class="hljs-comment">   * */</span><br>  <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">public</span> String CONFIGURATOR_CLASS_KEY=<span class="hljs-string">&quot;log4j.configuratorClass&quot;</span>;<br><br>  <span class="hljs-comment">/**</span><br><span class="hljs-comment">  * <span class="hljs-doctag">@deprecated</span> This variable is for internal use only. It will</span><br><span class="hljs-comment">  * become private in future versions.</span><br><span class="hljs-comment">  */</span><br>  <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">DEFAULT_INIT_OVERRIDE_KEY</span> <span class="hljs-operator">=</span> <br>                                                 <span class="hljs-string">&quot;log4j.defaultInitOverride&quot;</span>;<br><br><br>  <span class="hljs-keyword">static</span> <span class="hljs-keyword">private</span> <span class="hljs-type">Object</span> <span class="hljs-variable">guard</span> <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>;<br>  <span class="hljs-keyword">static</span> <span class="hljs-keyword">private</span> RepositorySelector repositorySelector;<br><br>  <span class="hljs-keyword">static</span> &#123;<br>      <span class="hljs-comment">// By default we use a DefaultRepositorySelector which always returns &#x27;h&#x27;.</span><br>      <span class="hljs-type">Hierarchy</span> <span class="hljs-variable">h</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Hierarchy</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">RootLogger</span>((Level) Level.DEBUG));<br>      repositorySelector = <span class="hljs-keyword">new</span> <span class="hljs-title class_">DefaultRepositorySelector</span>(h);<br><br>      <span class="hljs-comment">/** Search for the properties file log4j.properties in the CLASSPATH.  */</span><br>      <span class="hljs-type">String</span> <span class="hljs-variable">override</span> <span class="hljs-operator">=</span>OptionConverter.getSystemProperty(DEFAULT_INIT_OVERRIDE_KEY,<br>                                                         <span class="hljs-literal">null</span>);<br><br>      <span class="hljs-comment">// if there is no default init override, then get the resource</span><br>      <span class="hljs-comment">// specified by the user or the default config file.</span><br>      <span class="hljs-keyword">if</span>(override == <span class="hljs-literal">null</span> || <span class="hljs-string">&quot;false&quot;</span>.equalsIgnoreCase(override)) &#123;<br><br>          <span class="hljs-type">String</span> <span class="hljs-variable">configurationOptionStr</span> <span class="hljs-operator">=</span> OptionConverter.getSystemProperty(<br>              DEFAULT_CONFIGURATION_KEY, <br>              <span class="hljs-literal">null</span>);<br><br>          <span class="hljs-type">String</span> <span class="hljs-variable">configuratorClassName</span> <span class="hljs-operator">=</span> OptionConverter.getSystemProperty(<br>              CONFIGURATOR_CLASS_KEY, <br>              <span class="hljs-literal">null</span>);<br><br>          <span class="hljs-type">URL</span> <span class="hljs-variable">url</span> <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>;<br><br>          <span class="hljs-comment">// if the user has not specified the log4j.configuration</span><br>          <span class="hljs-comment">// property, we search first for the file &quot;log4j.xml&quot; and then</span><br>          <span class="hljs-comment">// &quot;log4j.properties&quot;</span><br>          <span class="hljs-keyword">if</span>(configurationOptionStr == <span class="hljs-literal">null</span>) &#123;	<br>              url = Loader.getResource(DEFAULT_XML_CONFIGURATION_FILE);<br>              <span class="hljs-keyword">if</span>(url == <span class="hljs-literal">null</span>) &#123;<br>                  url = Loader.getResource(DEFAULT_CONFIGURATION_FILE);<br>              &#125;<br>          &#125; <span class="hljs-keyword">else</span> &#123;<br>              <span class="hljs-keyword">try</span> &#123;<br>                  url = <span class="hljs-keyword">new</span> <span class="hljs-title class_">URL</span>(configurationOptionStr);<br>              &#125; <span class="hljs-keyword">catch</span> (MalformedURLException ex) &#123;<br>                  <span class="hljs-comment">// so, resource is not a URL:</span><br>                  <span class="hljs-comment">// attempt to get the resource from the class path</span><br>                  url = Loader.getResource(configurationOptionStr); <br>              &#125;	<br>          &#125;<br><br>          <span class="hljs-comment">// If we have a non-null url, then delegate the rest of the</span><br>          <span class="hljs-comment">// configuration to the OptionConverter.selectAndConfigure</span><br>          <span class="hljs-comment">// method.</span><br>          <span class="hljs-keyword">if</span>(url != <span class="hljs-literal">null</span>) &#123;<br>              LogLog.debug(<span class="hljs-string">&quot;Using URL [&quot;</span>+url+<span class="hljs-string">&quot;] for automatic log4j configuration.&quot;</span>);<br>              <span class="hljs-keyword">try</span> &#123;<br>                  OptionConverter.selectAndConfigure(url, configuratorClassName,<br>                                                     LogManager.getLoggerRepository());<br>              &#125; <span class="hljs-keyword">catch</span> (NoClassDefFoundError e) &#123;<br>                  LogLog.warn(<span class="hljs-string">&quot;Error during default initialization&quot;</span>, e);<br>              &#125;<br>          &#125; <span class="hljs-keyword">else</span> &#123;<br>              LogLog.debug(<span class="hljs-string">&quot;Could not find resource: [&quot;</span>+configurationOptionStr+<span class="hljs-string">&quot;].&quot;</span>);<br>          &#125;<br>      &#125; <span class="hljs-keyword">else</span> &#123;<br>          LogLog.debug(<span class="hljs-string">&quot;Default initialization of overridden by &quot;</span> + <br>                       DEFAULT_INIT_OVERRIDE_KEY + <span class="hljs-string">&quot;property.&quot;</span>); <br>      &#125;  <br>  &#125; <br>&#125;<br></code></pre></td></tr></table></figure>

<p>还有更有意思的，我们可以直接添加一个数据源，讲日志输出到数据库中，就是一个和数据库链接的输出源而已：</p>
<p>加入一个数据库的日志输出源：</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs properties"><span class="hljs-comment">#mysql</span><br><span class="hljs-attr">log4j.appender.logDB</span>=<span class="hljs-string">org.apache.log4j.jdbc.JDBCAppender</span><br><span class="hljs-attr">log4j.appender.logDB.layout</span>=<span class="hljs-string">org.apache.log4j.PatternLayout</span><br><span class="hljs-attr">log4j.appender.logDB.Driver</span>=<span class="hljs-string">com.mysql.cj.jdbc.Driver</span><br><span class="hljs-attr">log4j.appender.logDB.URL</span>=<span class="hljs-string">jdbc:mysql://localhost:3306/ssm</span><br><span class="hljs-attr">log4j.appender.logDB.User</span>=<span class="hljs-string">root</span><br><span class="hljs-attr">log4j.appender.logDB.Password</span>=<span class="hljs-string">root</span><br><span class="hljs-attr">log4j.appender.logDB.Sql</span>=<span class="hljs-string">INSERT INTO log(project_name,create_date,level,category,file_name,thread_name,line,all_category,message) values(&#x27;ydlclass&#x27;,&#x27;%d&#123;yyyy-MM-ddHH:mm:ss&#125;&#x27;,&#x27;%p&#x27;,&#x27;%c&#x27;,&#x27;%F&#x27;,&#x27;%t&#x27;,&#x27;%L&#x27;,&#x27;%l&#x27;,&#x27;%m&#x27;)</span><br></code></pre></td></tr></table></figure>

<p>需要</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> `log` (<br>    `log_id` <span class="hljs-type">int</span>(<span class="hljs-number">11</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> AUTO_INCREMENT,<br>    `project_name` <span class="hljs-type">varchar</span>(<span class="hljs-number">255</span>) <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">&#x27;目项名&#x27;</span>,<br>    `create_date` <span class="hljs-type">varchar</span>(<span class="hljs-number">255</span>) <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">&#x27;创建时间&#x27;</span>,<br>    `level` <span class="hljs-type">varchar</span>(<span class="hljs-number">255</span>) <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">&#x27;优先级&#x27;</span>,<br>    `category` <span class="hljs-type">varchar</span>(<span class="hljs-number">255</span>) <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">&#x27;所在类的全名&#x27;</span>,<br>    `file_name` <span class="hljs-type">varchar</span>(<span class="hljs-number">255</span>) <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">&#x27;输出日志消息产生时所在的文件名称 &#x27;</span>,<br>    `thread_name` <span class="hljs-type">varchar</span>(<span class="hljs-number">255</span>) <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">&#x27;日志事件的线程名&#x27;</span>,<br>    `line` <span class="hljs-type">varchar</span>(<span class="hljs-number">255</span>) <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">&#x27;号行&#x27;</span>,<br>    `all_category` <span class="hljs-type">varchar</span>(<span class="hljs-number">255</span>) <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">&#x27;日志事件的发生位置&#x27;</span>,<br>    `message` <span class="hljs-type">varchar</span>(<span class="hljs-number">4000</span>) <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">&#x27;输出代码中指定的消息&#x27;</span>,<br>    <span class="hljs-keyword">PRIMARY</span> KEY (`log_id`)<br>);<br></code></pre></td></tr></table></figure>

<p>pom中添加驱动：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>mysql<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>mysql-connector-java<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>8.0.22<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></td></tr></table></figure>

<p>再次执行：</p>
<p>发现除了控制台，文件，数据库中也有了日志了：</p>
<h2 id="四、自定义Logger"><a href="#四、自定义Logger" class="headerlink" title="四、自定义Logger"></a>四、自定义Logger</h2><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs properties"><span class="hljs-comment"># RootLogger配置</span><br><span class="hljs-attr">log4j.rootLogger</span> = <span class="hljs-string">trace,console</span><br><span class="hljs-comment"># 自定义Logger</span><br><span class="hljs-attr">log4j.logger.com.ydlclass</span>= <span class="hljs-string">WARN,logDB</span><br><span class="hljs-attr">log4j.logger.org.apache</span> = <span class="hljs-string">error</span><br></code></pre></td></tr></table></figure>

<p>由此我们发现，我们可以很灵活的自定义，组装不同logger的实现，接下来我们写代码测试：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Test</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">testDefineLogger</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>    <span class="hljs-type">Logger</span> <span class="hljs-variable">logger1</span> <span class="hljs-operator">=</span> Logger.getLogger(Log4jTest.class);<br>    logger1.fatal(<span class="hljs-string">&quot;fatal&quot;</span>); <span class="hljs-comment">// 严重错误，一般会造成系统崩溃和终止运行</span><br>    logger1.error(<span class="hljs-string">&quot;error&quot;</span>); <span class="hljs-comment">// 错误信息，但不会影响系统运行</span><br>    logger1.warn(<span class="hljs-string">&quot;warn&quot;</span>); <span class="hljs-comment">// 警告信息，可能会发生问题</span><br>    logger1.info(<span class="hljs-string">&quot;info&quot;</span>); <span class="hljs-comment">// 程序运行信息，数据库的连接、网络、IO操作等</span><br>    logger1.debug(<span class="hljs-string">&quot;debug&quot;</span>); <span class="hljs-comment">// 调试信息，一般在开发阶段使用，记录程序的变量、参数等</span><br>    logger1.trace(<span class="hljs-string">&quot;trace&quot;</span>); <span class="hljs-comment">// 追踪信息，记录程序的所有流程信息</span><br>    <span class="hljs-comment">// 自定义 org.apache</span><br>    <span class="hljs-type">Logger</span> <span class="hljs-variable">logger2</span> <span class="hljs-operator">=</span> Logger.getLogger(Logger.class);<br>    logger2.fatal(<span class="hljs-string">&quot;fatal logger2&quot;</span>); <span class="hljs-comment">// 严重错误，一般会造成系统崩溃和终止运行</span><br>    logger2.error(<span class="hljs-string">&quot;error logger2&quot;</span>); <span class="hljs-comment">// 错误信息，但不会影响系统运行</span><br>    logger2.warn(<span class="hljs-string">&quot;warn logger2&quot;</span>); <span class="hljs-comment">// 警告信息，可能会发生问题</span><br>    logger2.info(<span class="hljs-string">&quot;info logger2&quot;</span>); <span class="hljs-comment">// 程序运行信息，数据库的连接、网络、IO操作等</span><br>    logger2.debug(<span class="hljs-string">&quot;debug logger2&quot;</span>); <span class="hljs-comment">// 调试信息，一般在开发阶段使用，记录程序的变量、参数等</span><br>    logger2.trace(<span class="hljs-string">&quot;trace logger2&quot;</span>); <span class="hljs-comment">// 追踪信息，记录程序的所有流程信息</span><br>&#125;<br></code></pre></td></tr></table></figure>

<p>我们发现logger1的日志级别成了warn，并且在数据库中有了日志，logger2级别成了error，他们其实都继承了根logger的一些属性。</p>
<h1 id="第四章-日志门面"><a href="#第四章-日志门面" class="headerlink" title="第四章 日志门面"></a>第四章 日志门面</h1><p> 当我们的系统变的复杂的之后，难免会集成其他的系统，不同的系统之间可能会使用不同的日志系统。那么在一个系统中，我们的日志框架可能会出现多个，会出现混乱，而且随着时间的发展，可能会出现新的效率更高的日志系统，如果我们想切换代价会非常的大。如果我们的日志系统能和jdbc一样，有一套自己的规范，其他实现均按照规范去实现，就能很灵活的使用日志框架了。</p>
<p> 日志门面就是为了解决这个问题而出现的一种技术，日志门面是规范，其他的实现按照规范实现各自的日志框架即可，我们程序员基于日志门面编程即可。举个例子：日志门面就好比菜单，日志实现就好比厨师，我们去餐馆吃饭按照菜单点菜即可，厨师是谁其实不重要，但是有一个符合我口味的厨师当然会更好。</p>
<p>常见的日志门面： JCL、slf4j</p>
<p>常见的日志实现： JUL、log4j、logback、log4j2</p>
<p>日志框架出现的历史顺序：</p>
<p>log4j –&gt;JUL–&gt;JCL–&gt; slf4j –&gt; logback –&gt; log4j2</p>
<h2 id="一、SLF4J日志门面"><a href="#一、SLF4J日志门面" class="headerlink" title="一、SLF4J日志门面"></a>一、SLF4J日志门面</h2><p> 简单日志门面(Simple Logging Facade For Java) SLF4J主要是为了给Java日志访问提供一套标准、规范的API框架，其主要意义在于提供接口，具体的实现可以交由其他日志框架，例如log4j和logback等。 当然slf4j自己也提供了功能较为简单的实现，但是一般很少用到。对于一般的Java项目而言，日志框架 会选择slf4j-api作为门面，配上具体的实现框架（log4j、logback等），中间使用桥接器完成桥接。官方网站： <a target="_blank" rel="noopener" href="https://www.slf4j.org/">https://www.slf4j.org/</a></p>
<p>SLF4J是目前市面上最流行的日志门面。现在的项目中，基本上都是使用SLF4J作为我们的日志系统。</p>
<p>SLF4J日志门面主要提供两大功能：</p>
<ol>
<li>日志框架的绑定</li>
<li>日志框架的桥接</li>
</ol>
<h3 id="1、阿里日志规约"><a href="#1、阿里日志规约" class="headerlink" title="1、阿里日志规约"></a>1、阿里日志规约</h3><ol>
<li>应用中不可直接使用日志系统（Log4j、Logback）中的API，而应依赖使用日志框架SLF4J中的API。使用门面模式的日志框架，有利于维护和各个类的日志处理方法统一。</li>
<li>日志文件推荐至少保存15天，因为有些异常具备以“周”为频次发生的特点。</li>
<li>应用中的扩展日志（如打点、临时监控、访问日志等）命名方式：appName_logType_logName.log。logType为日志类型，推荐分类有stats&#x2F;monitor&#x2F;visit 等；</li>
<li>logName为日志描述。这种命名的好处：通过文件名就可以知道日志文件属于哪个应用，哪种类型，有什么目的，这也有利于归类查找。</li>
<li>对trace&#x2F;debug&#x2F;info级别的日志输出，必须使用条件输出形式或者占位符的方式。</li>
<li>避免重复打印日志，否则会浪费磁盘空间。务必在日志配置文件中设置additivity&#x3D;false。</li>
<li>异常信息应该包括两类：案发现场信息和异常堆栈信息。如果不处理，那么通过关键字向上抛出。</li>
<li>谨慎地记录日志。生产环境禁止输出debug日志；有选择地输出info日志；如果使用warn记录刚上线时的业务行为信息，一定要注意日志输出量的问题，避免吧服务器磁盘撑爆，并及时删除这些观察日志。</li>
<li>可以使用warn日志级别记录用户输入参数错误的情况，避免当用户投诉时无所适从</li>
</ol>
<h3 id="2、SLF4J实战"><a href="#2、SLF4J实战" class="headerlink" title="2、SLF4J实战"></a>2、SLF4J实战</h3><p>（1）添加依赖</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-comment">&lt;!--slf4j core 使用slf4j必須添加--&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.slf4j<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>slf4j-api<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.7.27<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><span class="hljs-comment">&lt;!--slf4j 自带的简单日志实现 --&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.slf4j<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>slf4j-simple<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.7.27<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></td></tr></table></figure>

<p>（2）编写代码</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">TestSlf4j</span> &#123;<br><br>    <span class="hljs-comment">// 声明日志对象</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">static</span> <span class="hljs-type">Logger</span> <span class="hljs-variable">LOGGER</span> <span class="hljs-operator">=</span><br>            LoggerFactory.getLogger(TestSlf4j.class);<br>    <span class="hljs-meta">@Test</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">testSlfSimple</span><span class="hljs-params">()</span>  &#123;<br>        <span class="hljs-comment">//打印日志信息</span><br>        LOGGER.error(<span class="hljs-string">&quot;error&quot;</span>);<br>        LOGGER.warn(<span class="hljs-string">&quot;warn&quot;</span>);<br>        LOGGER.info(<span class="hljs-string">&quot;info&quot;</span>);<br>        LOGGER.debug(<span class="hljs-string">&quot;debug&quot;</span>);<br>        LOGGER.trace(<span class="hljs-string">&quot;trace&quot;</span>);<br>        <span class="hljs-comment">// 使用占位符输出日志信息</span><br>        <span class="hljs-type">String</span> <span class="hljs-variable">name</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;lucy&quot;</span>;<br>        <span class="hljs-type">Integer</span> <span class="hljs-variable">age</span> <span class="hljs-operator">=</span> <span class="hljs-number">18</span>;<br>        LOGGER.info(<span class="hljs-string">&quot;&#123;&#125;今年&#123;&#125;岁了！&quot;</span>, name, age);<br>        <span class="hljs-comment">// 将系统异常信息写入日志</span><br>        <span class="hljs-keyword">try</span> &#123;<br>            <span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">1</span> / <span class="hljs-number">0</span>;<br>        &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;<br>            <span class="hljs-comment">// e.printStackTrace();</span><br>            LOGGER.info(<span class="hljs-string">&quot;出现异常：&quot;</span>, e);<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<h3 id="3、绑定其他日志的实现（Binding）"><a href="#3、绑定其他日志的实现（Binding）" class="headerlink" title="3、绑定其他日志的实现（Binding）"></a>3、绑定其他日志的实现（Binding）</h3><p>如前所述，SLF4J支持各种日志框架。SLF4J发行版附带了几个称为“SLF4J绑定”的jar文件，每个绑定对应一个受支持的框架。</p>
<p><strong>使用slf4j的日志绑定流程:</strong></p>
<ol>
<li><p>添加slf4j-api的依赖</p>
</li>
<li><p>使用slf4j的API在项目中进行统一的日志记录</p>
</li>
<li><p>绑定具体的日志实现框架</p>
<p>a. 绑定已经实现了slf4j的日志框架,直接添加对应依赖</p>
<p>b. 绑定没有实现slf4j的日志框架,先添加日志的适配器,再添加实现类的依赖</p>
</li>
<li><p>slf4j有且仅有一个日志实现框架的绑定（如果出现多个默认使用第一个依赖日志实现）</p>
</li>
</ol>
<p><strong>绑定jul的实现</strong></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.slf4j<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>slf4j-api<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.7.27<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.slf4j<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>slf4j-jdk14<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.7.25<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></td></tr></table></figure>

<p><strong>绑定log4j的实现</strong></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-comment">&lt;!--slf4j core 使用slf4j必須添加--&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.slf4j<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>slf4j-api<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.7.27<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><span class="hljs-comment">&lt;!-- log4j--&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.slf4j<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>slf4j-log4j12<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.7.27<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>log4j<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>log4j<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.2.17<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></td></tr></table></figure>

<p>要切换日志框架，只需替换类路径上的slf4j绑定。例如，要从java.util.logging切换到log4j，只需将 slf4j-jdk14-1.7.27.jar替换为slf4j-log4j12-1.7.27.jar即可。</p>
<p> SLF4J不依赖于任何特殊的类装载。实际上，每个SLF4J绑定在编译时都是硬连线的， 以使用一个且只有 一个特定的日志记录框架。例如，slf4j-log4j12-1.7.27.jar绑定在编译时绑定以使用log4j</p>
<h3 id="4、桥接旧的日志框架（Bridging）"><a href="#4、桥接旧的日志框架（Bridging）" class="headerlink" title="4、桥接旧的日志框架（Bridging）"></a>4、桥接旧的日志框架（Bridging）</h3><p>通常，您依赖的某些组件依赖于SLF4J以外的日志记录API。您也可以假设这些组件在不久的将来不会切换到SLF4J。为了解决这种情况，SLF4J附带了几个桥接模块，这些模块将对log4j，JCL和 java.util.logging API的调用重定向，就好像它们是对SLF4J API一样。</p>
<p> 就是你还用log4j的api写代码，但是具体的实现给你抽离了，我们依赖了一个中间层，这个层其实是用旧的api操作slf4j，而不是操作具体的实现。</p>
<p>桥接解决的是项目中日志的遗留问题，当系统中存在之前的日志API，可以通过桥接转换到slf4j的实现</p>
<ol>
<li>先去除之前老的日志框架的依赖，必须去掉。</li>
<li>添加SLF4J提供的桥接组件，这个组件就是模仿之前老的日志写了一套相同的api，只不过这个api是在调用slf4j的api。</li>
<li>为项目添加SLF4J的具体实现。</li>
</ol>
<p>迁移的方式：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-comment">&lt;!-- 桥接的组件 --&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.slf4j<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>log4j-over-slf4j<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.7.27<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.slf4j<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>slf4j-api<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.7.27<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.slf4j<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>slf4j-simple<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.7.27<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></td></tr></table></figure>

<p>SLF4J提供的桥接器：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-comment">&lt;!-- log4j--&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.slf4j<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>log4j-over-slf4j<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.7.27<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><span class="hljs-comment">&lt;!-- jul --&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.slf4j<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>jul-to-slf4j<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.7.27<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><span class="hljs-comment">&lt;!--jcl --&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.slf4j<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>jcl-over-slf4j<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.7.27<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></td></tr></table></figure>

<p>注意问题：</p>
<ol>
<li>jcl-over-slf4j.jar和 slf4j-jcl.jar不能同时部署。前一个jar文件将导致JCL将日志系统的选择委托给 SLF4J，后一个jar文件将导致SLF4J将日志系统的选择委托给JCL，从而导致无限循环。</li>
<li>log4j-over-slf4j.jar和slf4j-log4j12.jar不能同时出现</li>
<li>jul-to-slf4j.jar和slf4j-jdk14.jar不能同时出现</li>
<li>所有的桥接都只对Logger日志记录器对象有效，如果程序中调用了内部的配置类或者是 Appender,Filter等对象，将无法产生效果。</li>
</ol>
<h3 id="5、SLF4J原理解析"><a href="#5、SLF4J原理解析" class="headerlink" title="5、SLF4J原理解析"></a>5、SLF4J原理解析</h3><ol>
<li>SLF4J通过LoggerFactory加载日志具体的实现对象。</li>
<li>LoggerFactory在初始化的过程中，会通过performInitialization()方法绑定具体的日志实现。</li>
<li>在绑定具体实现的时候，通过类加载器，加载org&#x2F;slf4j&#x2F;impl&#x2F;StaticLoggerBinder.class</li>
<li>所以，只要是一个日志实现框架，在org.slf4j.impl包中提供一个自己的StaticLoggerBinder类，在其中提供具体日志实现的LoggerFactory就可以被SLF4J所加载</li>
</ol>
<p>在slf4j中创建logger的方法是：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Logger <span class="hljs-title function_">getLogger</span><span class="hljs-params">(String name)</span> &#123;<br>    <span class="hljs-type">ILoggerFactory</span> <span class="hljs-variable">iLoggerFactory</span> <span class="hljs-operator">=</span> getILoggerFactory();<br>    <span class="hljs-keyword">return</span> iLoggerFactory.getLogger(name);<br>&#125;<br></code></pre></td></tr></table></figure>

<p>继续进入查看，核心就是performInitialization();：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> ILoggerFactory <span class="hljs-title function_">getILoggerFactory</span><span class="hljs-params">()</span> &#123;<br>    <span class="hljs-keyword">if</span> (INITIALIZATION_STATE == UNINITIALIZED) &#123;<br>        <span class="hljs-keyword">synchronized</span> (LoggerFactory.class) &#123;<br>            <span class="hljs-keyword">if</span> (INITIALIZATION_STATE == UNINITIALIZED) &#123;<br>                INITIALIZATION_STATE = ONGOING_INITIALIZATION;<br>                performInitialization();<br>            &#125;<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>继续进入查看，核心就是bind()，这个方法应该就能绑定日志实现了：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">performInitialization</span><span class="hljs-params">()</span> &#123;<br>        bind();<br>        <span class="hljs-keyword">if</span> (INITIALIZATION_STATE == SUCCESSFUL_INITIALIZATION) &#123;<br>            versionSanityCheck();<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>来到这里，看看绑定的方法：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">bind</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">try</span> &#123;<br>            ...<br>            <span class="hljs-comment">// 以下内容就绑定成功了</span><br>            StaticLoggerBinder.getSingleton();<br>            INITIALIZATION_STATE = SUCCESSFUL_INITIALIZATION;<br>            reportActualBinding(staticLoggerBinderPathSet);<br>            fixSubstituteLoggers();<br>            replayEvents();<br>            <span class="hljs-comment">// release all resources in SUBST_FACTORY</span><br>            SUBST_FACTORY.clear();<br>        &#125; <span class="hljs-keyword">catch</span> (NoClassDefFoundError ncde) &#123;<br>            <span class="hljs-type">String</span> <span class="hljs-variable">msg</span> <span class="hljs-operator">=</span> ncde.getMessage();<br>            <span class="hljs-keyword">if</span> (messageContainsOrgSlf4jImplStaticLoggerBinder(msg)) &#123;<br>                INITIALIZATION_STATE = NOP_FALLBACK_INITIALIZATION;<br>                Util.report(<span class="hljs-string">&quot;Failed to load class \&quot;org.slf4j.impl.StaticLoggerBinder\&quot;.&quot;</span>);<br>                Util.report(<span class="hljs-string">&quot;Defaulting to no-operation (NOP) logger implementation&quot;</span>);<br>                Util.report(<span class="hljs-string">&quot;See &quot;</span> + NO_STATICLOGGERBINDER_URL + <span class="hljs-string">&quot; for further details.&quot;</span>);<br>            &#125; <span class="hljs-keyword">else</span> &#123;<br>                failedBinding(ncde);<br>                <span class="hljs-keyword">throw</span> ncde;<br>            &#125;<br>        &#125; <span class="hljs-keyword">catch</span> (java.lang.NoSuchMethodError nsme) &#123;<br>            <span class="hljs-type">String</span> <span class="hljs-variable">msg</span> <span class="hljs-operator">=</span> nsme.getMessage();<br>            <span class="hljs-keyword">if</span> (msg != <span class="hljs-literal">null</span> &amp;&amp; msg.contains(<span class="hljs-string">&quot;org.slf4j.impl.StaticLoggerBinder.getSingleton()&quot;</span>)) &#123;<br>                INITIALIZATION_STATE = FAILED_INITIALIZATION;<br>                Util.report(<span class="hljs-string">&quot;slf4j-api 1.6.x (or later) is incompatible with this binding.&quot;</span>);<br>                Util.report(<span class="hljs-string">&quot;Your binding is version 1.5.5 or earlier.&quot;</span>);<br>                Util.report(<span class="hljs-string">&quot;Upgrade your binding to version 1.6.x.&quot;</span>);<br>            &#125;<br>            <span class="hljs-keyword">throw</span> nsme;<br>        &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;<br>            failedBinding(e);<br>            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">IllegalStateException</span>(<span class="hljs-string">&quot;Unexpected initialization failure&quot;</span>, e);<br>        &#125;<br>    &#125;<br><br></code></pre></td></tr></table></figure>

<p>每一个日志实现的中间包都有一个StaticLoggerBinder：</p>
<p><img src="/../../../local_blog/springboot/SpringBoot%E6%97%A5%E5%BF%97%E6%A1%86%E6%9E%B6/image-20220316112850137.png" srcset="/img/loading.gif" lazyload alt="image-20220316112850137"></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">StaticLoggerBinder</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">LoggerFactoryBinder</span> &#123;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * The unique instance of this class.</span><br><span class="hljs-comment">     * </span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">StaticLoggerBinder</span> <span class="hljs-variable">SINGLETON</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">StaticLoggerBinder</span>();<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * Return the singleton of this class.</span><br><span class="hljs-comment">     * </span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span> the StaticLoggerBinder singleton</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> StaticLoggerBinder <span class="hljs-title function_">getSingleton</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> SINGLETON;<br>    &#125;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * Declare the version of the SLF4J API this implementation is compiled against. </span><br><span class="hljs-comment">     * The value of this field is modified with each major release. </span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-comment">// to avoid constant folding by the compiler, this field must *not* be final</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-type">String</span> <span class="hljs-variable">REQUESTED_API_VERSION</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;1.6.99&quot;</span>; <span class="hljs-comment">// !final</span><br><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">loggerFactoryClassStr</span> <span class="hljs-operator">=</span> Log4jLoggerFactory.class.getName();<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * The ILoggerFactory instance returned by the &#123;<span class="hljs-doctag">@link</span> #getLoggerFactory&#125;</span><br><span class="hljs-comment">     * method should always be the same object</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> ILoggerFactory loggerFactory;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-title function_">StaticLoggerBinder</span><span class="hljs-params">()</span> &#123;<br>        loggerFactory = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Log4jLoggerFactory</span>();<br>        <span class="hljs-keyword">try</span> &#123;<br>            <span class="hljs-meta">@SuppressWarnings(&quot;unused&quot;)</span><br>            <span class="hljs-type">Level</span> <span class="hljs-variable">level</span> <span class="hljs-operator">=</span> Level.TRACE<br>            Util.report(<span class="hljs-string">&quot;This version of SLF4J requires log4j version 1.2.12 or later. See also http://www.slf4j.org/codes.html#log4j_version&quot;</span>);<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> ILoggerFactory <span class="hljs-title function_">getLoggerFactory</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> loggerFactory;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getLoggerFactoryClassStr</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> loggerFactoryClassStr;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<h2 id="二、JCL-日志门面"><a href="#二、JCL-日志门面" class="headerlink" title="二、JCL 日志门面"></a>二、JCL 日志门面</h2><p> 全称为Jakarta Commons Logging，是Apache提供的一个通用日志API。 改日志门面的使用并不是很广泛。</p>
<p> 它是为 “所有的Java日志实现”提供一个统一的接口，它自身也提供一个日志的实现，但是功能非常常弱 （SimpleLog）。所以一般不会单独使用它。他允许开发人员使用不同的具体日志实现工具: Log4j, Jdk 自带的日志（JUL)</p>
<p>JCL 有两个基本的抽象类：Log(基本记录器)和LogFactory(负责创建Log实例)</p>
<h3 id="1、JCL入门"><a href="#1、JCL入门" class="headerlink" title="1、JCL入门"></a>1、JCL入门</h3><ol>
<li><p>建立maven工程</p>
</li>
<li><p>添加依赖</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>commons-logging<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>commons-logging<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.2<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></td></tr></table></figure>
</li>
<li><p>入门代码</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">JULTest</span> &#123;<br>    <span class="hljs-meta">@Test</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">testQuick</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>        <span class="hljs-comment">// 创建日志对象</span><br>        <span class="hljs-type">Log</span> <span class="hljs-variable">log</span> <span class="hljs-operator">=</span> LogFactory.getLog(JULTest.class);<br>        <span class="hljs-comment">// 日志记录输出</span><br>        log.fatal(<span class="hljs-string">&quot;fatal&quot;</span>);<br>        log.error(<span class="hljs-string">&quot;error&quot;</span>);<br>        log.warn(<span class="hljs-string">&quot;warn&quot;</span>);<br>        log.info(<span class="hljs-string">&quot;info&quot;</span>);<br>        log.debug(<span class="hljs-string">&quot;debug&quot;</span>);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure></li>
</ol>
<p><strong>我们为什么要使用日志门面：</strong></p>
<ol>
<li>面向接口开发，不再依赖具体的实现类。减少代码的耦合</li>
<li>项目通过导入不同的日志实现类，可以灵活的切换日志框架</li>
<li>统一API，方便开发者学习和使用</li>
<li>统一配置便于项目日志的管理</li>
</ol>
<h3 id="2、JCL原理"><a href="#2、JCL原理" class="headerlink" title="2、JCL原理"></a>2、JCL原理</h3><p><img src="/../../../local_blog/springboot/SpringBoot%E6%97%A5%E5%BF%97%E6%A1%86%E6%9E%B6/image-20220316142932951.png" srcset="/img/loading.gif" lazyload alt="image-20220316142932951"></p>
<ol>
<li><p>通过LogFactory动态加载Log实现类</p>
<p><img src="/../../../local_blog/springboot/SpringBoot%E6%97%A5%E5%BF%97%E6%A1%86%E6%9E%B6/image-20220316143016163.png" srcset="/img/loading.gif" lazyload alt="image-20220316143016163"></p>
</li>
<li><p>日志门面支持的日志实现数组</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> String[] classesToDiscover =<br>    <span class="hljs-keyword">new</span> <span class="hljs-title class_">String</span>[]&#123;<span class="hljs-string">&quot;org.apache.commons.logging.impl.Log4JLogger&quot;</span>,<br>                 <span class="hljs-string">&quot;org.apache.commons.logging.impl.Jdk14Logger&quot;</span>,<br>                 <span class="hljs-string">&quot;org.apache.commons.logging.impl.Jdk13LumberjackLogger&quot;</span>,<br>                 <span class="hljs-string">&quot;org.apache.commons.logging.impl.SimpleLog&quot;</span>&#125;;<br></code></pre></td></tr></table></figure>
</li>
<li><p>获取具体的日志实现</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; classesToDiscover.length &amp;&amp; result == <span class="hljs-literal">null</span>; ++i) &#123;<br>    result = <span class="hljs-built_in">this</span>.createLogFromClass(classesToDiscover[i], logCategory,<br>                                     <span class="hljs-literal">true</span>);<br>&#125;<br></code></pre></td></tr></table></figure></li>
</ol>
<h3 id="3、日志生态图："><a href="#3、日志生态图：" class="headerlink" title="3、日志生态图："></a>3、日志生态图：</h3><p><img src="/../../../local_blog/springboot/SpringBoot%E6%97%A5%E5%BF%97%E6%A1%86%E6%9E%B6/image-20220316143429825-16474124707221.png" srcset="/img/loading.gif" lazyload alt="image-20220316143429825"></p>
<p>历史插曲：现在聊聊历史：<a target="_blank" rel="noopener" href="https://segmentfault.com/a/1190000021121882?utm_source=tag-newest">https://segmentfault.com/a/1190000021121882?utm_source=tag-newest</a></p>
<h1 id="第五章-Logback的使用"><a href="#第五章-Logback的使用" class="headerlink" title="第五章 Logback的使用"></a>第五章 Logback的使用</h1><p>Logback是由log4j创始人设计的另一个开源日志组件，性能比log4j要好。</p>
<p>官方网站：<a target="_blank" rel="noopener" href="https://logback.qos.ch/index.html">https://logback.qos.ch/index.html</a></p>
<p>Logback主要分为三个模块：</p>
<ul>
<li>logback-core：其它两个模块的基础模块</li>
<li>logback-classic：它是log4j的一个改良版本，同时它完整实现了slf4j API</li>
<li>logback-access：访问模块与Servlet容器集成提供通过Http来访问日志的功能 后续的日志代码都是通过SLF4J日志门面搭建日志系统，所以在代码是没有区别，主要是通过修改配置文件和pom.xml依赖</li>
</ul>
<h2 id="一、Logback-入门"><a href="#一、Logback-入门" class="headerlink" title="一、Logback 入门"></a>一、Logback 入门</h2><ol>
<li><p>添加依赖(它是log4j的一个改良版本，同时它完整实现了slf4j API)</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>ch.qos.logback<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>logback-classic<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.2.3<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></td></tr></table></figure>
</li>
<li><p>java 代码</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.atguigu;<br><br><span class="hljs-keyword">import</span> ch.qos.logback.classic.Logger;<br><span class="hljs-keyword">import</span> org.junit.Test;<br><span class="hljs-keyword">import</span> org.slf4j.LoggerFactory;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@author</span> ws</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@create</span> 2022/3/16</span><br><span class="hljs-comment"> */</span><br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">LogTest</span> &#123;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">Logger</span> <span class="hljs-variable">LOGGER</span> <span class="hljs-operator">=</span> (Logger) LoggerFactory.getLogger(LogTest.class);<br><br>    <span class="hljs-meta">@Test</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">testLogBack</span><span class="hljs-params">()</span>&#123;<br>        <span class="hljs-comment">//打印日志信息</span><br>        LOGGER.error(<span class="hljs-string">&quot;error&quot;</span>);<br>        LOGGER.warn(<span class="hljs-string">&quot;warn&quot;</span>);<br>        LOGGER.info(<span class="hljs-string">&quot;info&quot;</span>);<br>        LOGGER.debug(<span class="hljs-string">&quot;debug&quot;</span>);<br>        LOGGER.trace(<span class="hljs-string">&quot;trace&quot;</span>);<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure></li>
</ol>
<p>其实我们发现即使项目中没有引入slf4j我们这里也是用的slf4j门面进行编程。</p>
<h2 id="二、源码解析"><a href="#二、源码解析" class="headerlink" title="二、源码解析"></a>二、源码解析</h2><h3 id="1、spi机制"><a href="#1、spi机制" class="headerlink" title="1、spi机制"></a>1、spi机制</h3><p>SPI全称Service Provider Interface，是Java提供的一套用来被第三方实现或者扩展的API，它可以用来启用框架扩展和替换组件。他是一种服务发现机制。它通过在ClassPath路径下的META-INF&#x2F;services文件夹查找文件，自动加载文件里所定义的类。</p>
<p>主要是使用，java.util包下的ServiceLoader实现：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> &lt;S&gt; ServiceLoader&lt;S&gt; <span class="hljs-title function_">load</span><span class="hljs-params">(Class&lt;S&gt; service, ClassLoader loader)</span><br>&#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ServiceLoader</span>&lt;&gt;(service, loader);<br>&#125;<br></code></pre></td></tr></table></figure>

<h3 id="2、源码解析"><a href="#2、源码解析" class="headerlink" title="2、源码解析"></a>2、源码解析</h3><p>源码看一下启动过程：</p>
<p>1、我们从日志工厂的常见看起，这里是slf4j的实现：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">static</span> <span class="hljs-type">Logger</span> <span class="hljs-variable">logger</span> <span class="hljs-operator">=</span> LoggerFactory.getLogger(TestLog4j.class);<br></code></pre></td></tr></table></figure>

<p>核心方法只有一句：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Logger <span class="hljs-title function_">getLogger</span><span class="hljs-params">(Class&lt;?&gt; clazz)</span> &#123;<br>    <span class="hljs-type">Logger</span> <span class="hljs-variable">logger</span> <span class="hljs-operator">=</span> getLogger(clazz.getName());<br>    ...中间的逻辑判断省略掉<br>    <span class="hljs-keyword">return</span> logger;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>看一下getLogger方法，这里是先获取日志工厂，在从工厂中提取日志对象，我们不考虑日志对象，主要看看日志工厂的环境怎么初始化的：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Logger <span class="hljs-title function_">getLogger</span><span class="hljs-params">(String name)</span> &#123;<br>    <span class="hljs-type">ILoggerFactory</span> <span class="hljs-variable">iLoggerFactory</span> <span class="hljs-operator">=</span> getILoggerFactory();<br>    <span class="hljs-keyword">return</span> iLoggerFactory.getLogger(name);<br>&#125;<br></code></pre></td></tr></table></figure>

<p>日志工厂的创建方法：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> ILoggerFactory <span class="hljs-title function_">getILoggerFactory</span><span class="hljs-params">()</span> &#123;<br>	...去掉其他的代码，从这一行看。<br>    <span class="hljs-keyword">return</span> StaticLoggerBinder.getSingleton().getLoggerFactory();<br><br>&#125;<br></code></pre></td></tr></table></figure>

<p>这里就进入了，StaticLoggerBinder这个对象，这是日志实现用来和slf4j进行绑定的类，从此就进入日志实现中了。</p>
<p>StaticLoggerBinder.getSingleton()这里看到出来是一个单例，来到这个类当中，我们看到，直接返回了defaultLoggerContext</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs text">public ILoggerFactory getLoggerFactory() &#123;<br>        if (!initialized) &#123;<br>            return defaultLoggerContext;<br>        &#125;<br>... 省略其他<br>        <br>    &#125;<br></code></pre></td></tr></table></figure>

<p>这是个日志上下文，一定保存了我们的环境，配置内容一定在这个里边，那么哪里初始化他了呢，我们能想到的就是静态代码块了：</p>
<p>我们发现这个类中还真有：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">static</span> &#123;<br>    SINGLETON.init();<br>&#125;<br></code></pre></td></tr></table></figure>



<p>我们看到init()方法中，有一个autoConfig()，感觉就像在自动配置：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">void</span> <span class="hljs-title function_">init</span><span class="hljs-params">()</span> &#123;<br>    <span class="hljs-keyword">try</span> &#123;<br>        <span class="hljs-keyword">try</span> &#123;<br>            <span class="hljs-keyword">new</span> <span class="hljs-title class_">ContextInitializer</span>(defaultLoggerContext).autoConfig();<br>        &#125; <span class="hljs-keyword">catch</span> (JoranException je) &#123;<br>            Util.report(<span class="hljs-string">&quot;Failed to auto configure default logger context&quot;</span>, je);<br>        &#125;<br>        ...其他省略<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>



<p>默认配置：ContextInitializer类是初始化的关键：</p>
<p>自动配置是这么玩的，先找配置文件</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">autoConfig</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> JoranException &#123;<br>        StatusListenerConfigHelper.installIfAsked(loggerContext);<br>        <span class="hljs-comment">// 这就是去找配置文件</span><br>        <span class="hljs-type">URL</span> <span class="hljs-variable">url</span> <span class="hljs-operator">=</span> findURLOfDefaultConfigurationFile(<span class="hljs-literal">true</span>);<br>        <span class="hljs-keyword">if</span> (url != <span class="hljs-literal">null</span>) &#123;<br>            <span class="hljs-comment">// 解析配置</span><br>            configureByResource(url);<br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>            <span class="hljs-comment">// 没有找到文件，就去使用spi机制找一个配置类，这个配置类是在web中用的</span><br>            <span class="hljs-type">Configurator</span> <span class="hljs-variable">c</span> <span class="hljs-operator">=</span> EnvUtil.loadFromServiceLoader(Configurator.class);<br>            <span class="hljs-keyword">if</span> (c != <span class="hljs-literal">null</span>) &#123;<br>                <span class="hljs-keyword">try</span> &#123;<br>                    c.setContext(loggerContext);<br>                    c.configure(loggerContext);<br>                &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;<br>                    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">LogbackException</span>(String.format(<span class="hljs-string">&quot;Failed to initialize Configurator: %s using ServiceLoader&quot;</span>, c != <span class="hljs-literal">null</span> ? c.getClass()<br>                                    .getCanonicalName() : <span class="hljs-string">&quot;null&quot;</span>), e);<br>                &#125;<br>            &#125; <span class="hljs-keyword">else</span> &#123;<br>                <span class="hljs-comment">// 如果没有找到，就做基本的配置</span><br>                <span class="hljs-type">BasicConfigurator</span> <span class="hljs-variable">basicConfigurator</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">BasicConfigurator</span>();<br>                basicConfigurator.setContext(loggerContext);<br>                basicConfigurator.configure(loggerContext);<br>            &#125;<br>        &#125;<br>    &#125;<br></code></pre></td></tr></table></figure>

<p>寻找配置文件的过程：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">final</span> <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-type">String</span> <span class="hljs-variable">GROOVY_AUTOCONFIG_FILE</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;logback.groovy&quot;</span>;<br><span class="hljs-keyword">final</span> <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-type">String</span> <span class="hljs-variable">AUTOCONFIG_FILE</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;logback.xml&quot;</span>;<br><span class="hljs-keyword">final</span> <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-type">String</span> <span class="hljs-variable">TEST_AUTOCONFIG_FILE</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;logback-test.xml&quot;</span>;<br><br><span class="hljs-keyword">public</span> URL <span class="hljs-title function_">findURLOfDefaultConfigurationFile</span><span class="hljs-params">(<span class="hljs-type">boolean</span> updateStatus)</span> &#123;<br>    <span class="hljs-type">ClassLoader</span> <span class="hljs-variable">myClassLoader</span> <span class="hljs-operator">=</span> Loader.getClassLoaderOfObject(<span class="hljs-built_in">this</span>);<br>    <span class="hljs-type">URL</span> <span class="hljs-variable">url</span> <span class="hljs-operator">=</span> findConfigFileURLFromSystemProperties(myClassLoader, updateStatus);<br>    <span class="hljs-keyword">if</span> (url != <span class="hljs-literal">null</span>) &#123;<br>        <span class="hljs-keyword">return</span> url;<br>    &#125;<br><br>    url = getResource(TEST_AUTOCONFIG_FILE, myClassLoader, updateStatus);<br>    <span class="hljs-keyword">if</span> (url != <span class="hljs-literal">null</span>) &#123;<br>        <span class="hljs-keyword">return</span> url;<br>    &#125;<br><br>    url = getResource(GROOVY_AUTOCONFIG_FILE, myClassLoader, updateStatus);<br>    <span class="hljs-keyword">if</span> (url != <span class="hljs-literal">null</span>) &#123;<br>        <span class="hljs-keyword">return</span> url;<br>    &#125;<br><br>    <span class="hljs-keyword">return</span> getResource(AUTOCONFIG_FILE, myClassLoader, updateStatus);<br>&#125;<br></code></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">configureByResource</span><span class="hljs-params">(URL url)</span> <span class="hljs-keyword">throws</span> JoranException &#123;<br>       <span class="hljs-keyword">if</span> (url == <span class="hljs-literal">null</span>) &#123;<br>           <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">IllegalArgumentException</span>(<span class="hljs-string">&quot;URL argument cannot be null&quot;</span>);<br>       &#125;<br>       <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">urlString</span> <span class="hljs-operator">=</span> url.toString();<br>       <span class="hljs-keyword">if</span> (urlString.endsWith(<span class="hljs-string">&quot;groovy&quot;</span>)) &#123;<br>           <span class="hljs-keyword">if</span> (EnvUtil.isGroovyAvailable()) &#123;<br>               <span class="hljs-comment">// avoid directly referring to GafferConfigurator so as to avoid</span><br>               <span class="hljs-comment">// loading groovy.lang.GroovyObject . See also http://jira.qos.ch/browse/LBCLASSIC-214</span><br>               GafferUtil.runGafferConfiguratorOn(loggerContext, <span class="hljs-built_in">this</span>, url);<br>           &#125; <span class="hljs-keyword">else</span> &#123;<br>               <span class="hljs-type">StatusManager</span> <span class="hljs-variable">sm</span> <span class="hljs-operator">=</span> loggerContext.getStatusManager();<br>               sm.add(<span class="hljs-keyword">new</span> <span class="hljs-title class_">ErrorStatus</span>(<span class="hljs-string">&quot;Groovy classes are not available on the class path. ABORTING INITIALIZATION.&quot;</span>, loggerContext));<br>           &#125;<br>       &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (urlString.endsWith(<span class="hljs-string">&quot;xml&quot;</span>)) &#123;<br>           <span class="hljs-type">JoranConfigurator</span> <span class="hljs-variable">configurator</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">JoranConfigurator</span>();<br>           configurator.setContext(loggerContext);<br>           configurator.doConfigure(url);<br>       &#125; <span class="hljs-keyword">else</span> &#123;<br>           <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">LogbackException</span>(<span class="hljs-string">&quot;Unexpected filename extension of file [&quot;</span> + url.toString() + <span class="hljs-string">&quot;]. Should be either .groovy or .xml&quot;</span>);<br>       &#125;<br>   &#125;<br></code></pre></td></tr></table></figure>



<p>基础配置的代码：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">BasicConfigurator</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">ContextAwareBase</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Configurator</span> &#123;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">BasicConfigurator</span><span class="hljs-params">()</span> &#123;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">configure</span><span class="hljs-params">(LoggerContext lc)</span> &#123;<br>        addInfo(<span class="hljs-string">&quot;Setting up default configuration.&quot;</span>);<br>        <br>        ConsoleAppender&lt;ILoggingEvent&gt; ca = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ConsoleAppender</span>&lt;ILoggingEvent&gt;();<br>        ca.setContext(lc);<br>        ca.setName(<span class="hljs-string">&quot;console&quot;</span>);<br>        LayoutWrappingEncoder&lt;ILoggingEvent&gt; encoder = <span class="hljs-keyword">new</span> <span class="hljs-title class_">LayoutWrappingEncoder</span>&lt;ILoggingEvent&gt;();<br>        encoder.setContext(lc);<br>        <br> <br>        <span class="hljs-comment">// same as </span><br>        <span class="hljs-comment">// PatternLayout layout = new PatternLayout();</span><br>        <span class="hljs-comment">// layout.setPattern(&quot;%d&#123;HH:mm:ss.SSS&#125; [%thread] %-5level %logger&#123;36&#125; - %msg%n&quot;);</span><br>        <span class="hljs-type">TTLLLayout</span> <span class="hljs-variable">layout</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">TTLLLayout</span>();<br> <br>        layout.setContext(lc);<br>        layout.start();<br>        encoder.setLayout(layout);<br>        <br>        ca.setEncoder(encoder);<br>        ca.start();<br>        <br>        <span class="hljs-type">Logger</span> <span class="hljs-variable">rootLogger</span> <span class="hljs-operator">=</span> lc.getLogger(Logger.ROOT_LOGGER_NAME);<br>        rootLogger.addAppender(ca);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>



<p>我们先不说配置的事情，从源码中我们可以看出有几种配置，因为有了</p>
<p>我们先模仿BasicConfigurator写一个类，只做略微的改动：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MyConfigurator</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">ContextAwareBase</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Configurator</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">MyConfigurator</span><span class="hljs-params">()</span> &#123;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">configure</span><span class="hljs-params">(LoggerContext lc)</span> &#123;<br>        addInfo(<span class="hljs-string">&quot;Setting up default configuration.&quot;</span>);<br><br>        ConsoleAppender&lt;ILoggingEvent&gt; ca = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ConsoleAppender</span>&lt;ILoggingEvent&gt;();<br>        ca.setContext(lc);<br>        ca.setName(<span class="hljs-string">&quot;console&quot;</span>);<br>        LayoutWrappingEncoder&lt;ILoggingEvent&gt; encoder = <span class="hljs-keyword">new</span> <span class="hljs-title class_">LayoutWrappingEncoder</span>&lt;ILoggingEvent&gt;();<br>        encoder.setContext(lc);<br><br><br>        <span class="hljs-comment">// same as</span><br>        <span class="hljs-comment">// PatternLayout layout = new PatternLayout();</span><br>        <span class="hljs-comment">// layout.setPattern(&quot;%d&#123;HH:mm:ss.SSS&#125; [%thread] %-5level %logger&#123;36&#125; - %msg%n&quot;);</span><br>        <span class="hljs-type">PatternLayout</span> <span class="hljs-variable">layout</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">PatternLayout</span>();<br>        layout.setPattern(<span class="hljs-string">&quot;%d&#123;HH:mm:ss&#125; [%thread] %-5level %logger&#123;36&#125; - %msg%n&quot;</span>);<br><br>        layout.setContext(lc);<br>        layout.start();<br>        encoder.setLayout(layout);<br><br>        ca.setEncoder(encoder);<br>        ca.start();<br><br>        <span class="hljs-type">Logger</span> <span class="hljs-variable">rootLogger</span> <span class="hljs-operator">=</span> lc.getLogger(Logger.ROOT_LOGGER_NAME);<br>        rootLogger.addAppender(ca);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>在resource中新建META-INF目录，下边在新建services文件夹，再新建一个名字我<code>ch.qos.logback.classic.spi.Configurator</code>的文件，</p>
<p>内容是：com.ydlclass.MyConfigurator</p>
<h2 id="三、三大组件"><a href="#三、三大组件" class="headerlink" title="三、三大组件"></a>三、三大组件</h2><p>1、appender，输出源，一个日志可以后好几个输出源</p>
<p>2、encoder，一个appender有一个encoder，负责将一个event事件转换成一组byte数组，并将转换后的字节数据输出到文件中。</p>
<p>Encoder负责把事件转换为字节数组，并把字节数组写到合适的输出流。因此，encoder可以控制在什么时候、把什么样的字节数组写入到其拥有者维护的输出流中。Encoder接口有两个实现类，LayoutWrappingEncoder与PatternLayoutEncoder。</p>
<p>注意：在logback 0.9.19 版之前没有 encoder。</p>
<p>在之前的版本里，多数 appender 依靠 layout 来把事件转换成字符串并用 java.io.Writer 把字符串输出。在之前的版本里，用户需要在 FileAppender里嵌入一个 PatternLayout。</p>
<p>3、layout，格式化数据将event事件转化为字符串，解析的过程</p>
<p>4、filter 过滤器</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs text">LevelFilter levelFilter = new LevelFilter();<br>        levelFilter.setOnMatch(FilterReply.DENY);<br>        levelFilter.setLevel(Level.WARN);<br>        levelFilter.start();<br>        ca.addFilter(levelFilter);<br></code></pre></td></tr></table></figure>

<ol>
<li>%-5level</li>
<li>%d{yyyy-MM-dd HH:mm:ss.SSS}日期</li>
<li>%c类的完整名称</li>
<li>%M为method</li>
<li>%L为行号</li>
<li>%thread线程名称</li>
<li>%m或者%msg为信息</li>
<li>%n换行</li>
</ol>
<p>能看到logback的格式化信息</p>
<h2 id="四、logback配置"><a href="#四、logback配置" class="headerlink" title="四、logback配置"></a>四、logback配置</h2><p>Let us begin by discussing the initialization steps that logback follows to try to configure itself:</p>
<ol>
<li>Logback tries to find a file called <em>logback-test.xml</em> <a target="_blank" rel="noopener" href="http://logback.qos.ch/faq.html#configFileLocation">in the classpathopen in new window</a>.</li>
<li>If no such file is found, logback tries to find a file called <em>logback.groovy</em> <a target="_blank" rel="noopener" href="http://logback.qos.ch/faq.html#configFileLocation">in the classpathopen in new window</a>.</li>
<li>If no such file is found, it checks for the file <em>logback.xml</em> <a target="_blank" rel="noopener" href="http://logback.qos.ch/faq.html#configFileLocation">in the classpathopen in new window</a>..</li>
<li>If no such file is found, <a target="_blank" rel="noopener" href="http://docs.oracle.com/javase/6/docs/api/java/util/ServiceLoader.html">service-provider loading facilityopen in new window</a> (introduced in JDK 1.6) is used to resolve the implementation of <a target="_blank" rel="noopener" href="http://logback.qos.ch/xref/ch/qos/logback/classic/spi/Configurator.html"><code>com.qos.logback.classic.spi.Configurator</code>open in new window</a> interface by looking up the file <em>META-INF\services\ch.qos.logback.classic.spi.Configurator</em> in the class path. Its contents should specify the fully qualified class name of the desired <code>Configurator</code> implementation.</li>
<li>If none of the above succeeds, logback configures itself automatically using the <a target="_blank" rel="noopener" href="http://logback.qos.ch/xref/ch/qos/logback/classic/BasicConfigurator.html"><code>BasicConfigurator</code>open in new window</a> which will cause logging output to be directed to the console.</li>
<li>基本配置信息</li>
</ol>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-meta">&lt;?xml version=<span class="hljs-string">&quot;1.0&quot;</span> encoding=<span class="hljs-string">&quot;UTF-8&quot;</span>?&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">configuration</span>&gt;</span><br><br>    <span class="hljs-comment">&lt;!--格式化输出：%d表示日期，%thread表示线程名，%-5level：级别从左显示5个字符宽度</span><br><span class="hljs-comment">    %msg：日志消息，%n是换行符--&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;pattern&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;%d&#123;yyyy-MM-dd HH:mm:ss.SSS&#125; %c [%thread]</span></span><br><span class="hljs-string"><span class="hljs-tag">                                    %-5level %msg%n&quot;</span>/&gt;</span><br>    <span class="hljs-comment">&lt;!--</span><br><span class="hljs-comment">    	Appender: 设置日志信息的去向,常用的有以下几个</span><br><span class="hljs-comment">        ch.qos.logback.core.ConsoleAppender (控制台)</span><br><span class="hljs-comment">        ch.qos.logback.core.rolling.RollingFileAppender (文件大小到达指定尺寸的时候产生一个新文件)</span><br><span class="hljs-comment">        ch.qos.logback.core.FileAppender (文件)</span><br><span class="hljs-comment">        --&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">appender</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;console&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;ch.qos.logback.core.ConsoleAppender&quot;</span>&gt;</span><br>        <span class="hljs-comment">&lt;!--输出流对象 默认 System.out 改为 System.err--&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">target</span>&gt;</span>System.err<span class="hljs-tag">&lt;/<span class="hljs-name">target</span>&gt;</span><br>        <span class="hljs-comment">&lt;!--日志格式配置--&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">encoder</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;ch.qos.logback.classic.encoder.PatternLayoutEncoder&quot;</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">pattern</span>&gt;</span>$&#123;pattern&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">pattern</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">encoder</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">appender</span>&gt;</span><br>    <span class="hljs-comment">&lt;!--</span><br><span class="hljs-comment">  用来设置某一个包或者具体的某一个类的日志打印级别、以及指定&lt;appender&gt;。</span><br><span class="hljs-comment">                    &lt;loger&gt;仅有一个name属性，一个可选的level和一个可选的addtivity属性</span><br><span class="hljs-comment">                    name:</span><br><span class="hljs-comment">        用来指定受此logger约束的某一个包或者具体的某一个类。</span><br><span class="hljs-comment">            level:</span><br><span class="hljs-comment">        用来设置打印级别，大小写无关：TRACE, DEBUG, INFO, WARN, ERROR, ALL 和</span><br><span class="hljs-comment">            OFF，</span><br><span class="hljs-comment">            如果未设置此属性，那么当前logger将会继承上级的级别。</span><br><span class="hljs-comment">            additivity:</span><br><span class="hljs-comment">        是否向上级loger传递打印信息。默认是true。</span><br><span class="hljs-comment">            &lt;logger&gt;可以包含零个或多个&lt;appender-ref&gt;元素，标识这个appender将会添加到这个</span><br><span class="hljs-comment">            logger</span><br><span class="hljs-comment">            --&gt;</span><br>    <span class="hljs-comment">&lt;!--</span><br><span class="hljs-comment">            也是&lt;logger&gt;元素，但是它是根logger。默认debug</span><br><span class="hljs-comment">            level:用来设置打印级别，大小写无关：TRACE, DEBUG, INFO, WARN, ERROR, ALL</span><br><span class="hljs-comment">                和 OFF，</span><br><span class="hljs-comment">                &lt;root&gt;可以包含零个或多个&lt;appender-ref&gt;元素，标识这个appender将会添加到这个</span><br><span class="hljs-comment">                logger。</span><br><span class="hljs-comment">        --&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">root</span> <span class="hljs-attr">level</span>=<span class="hljs-string">&quot;ALL&quot;</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">appender-ref</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">&quot;console&quot;</span>/&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">root</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">configuration</span>&gt;</span><br></code></pre></td></tr></table></figure>

<ol start="3">
<li><p>FileAppender配置</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-meta">&lt;?xml version=<span class="hljs-string">&quot;1.0&quot;</span> encoding=<span class="hljs-string">&quot;UTF-8&quot;</span>?&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">configuration</span>&gt;</span><br>    <span class="hljs-comment">&lt;!-- 自定义属性 可以通过$&#123;name&#125;进行引用--&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;pattern&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;[%-5level] %d&#123;yyyy-MM-dd HH:mm:ss&#125; %c %M</span></span><br><span class="hljs-string"><span class="hljs-tag">                                    %L [%thread] %m %n&quot;</span>/&gt;</span><br>    <span class="hljs-comment">&lt;!--</span><br><span class="hljs-comment">    日志输出格式：</span><br><span class="hljs-comment">    %d&#123;pattern&#125;日期</span><br><span class="hljs-comment">    %m或者%msg为信息</span><br><span class="hljs-comment">    %M为method</span><br><span class="hljs-comment">    %L为行号</span><br><span class="hljs-comment">    %c类的完整名称</span><br><span class="hljs-comment">    %thread线程名称</span><br><span class="hljs-comment">    %n换行</span><br><span class="hljs-comment">    %-5level</span><br><span class="hljs-comment">    --&gt;</span><br>    <span class="hljs-comment">&lt;!-- 日志文件存放目录 --&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;log_dir&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;d:/logs&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span><br>    <span class="hljs-comment">&lt;!--控制台输出appender对象--&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">appender</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;console&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;ch.qos.logback.core.ConsoleAppender&quot;</span>&gt;</span><br>        <span class="hljs-comment">&lt;!--输出流对象 默认 System.out 改为 System.err--&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">target</span>&gt;</span>System.err<span class="hljs-tag">&lt;/<span class="hljs-name">target</span>&gt;</span><br>        <span class="hljs-comment">&lt;!--日志格式配置--&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">encoder</span></span><br><span class="hljs-tag">                 <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;ch.qos.logback.classic.encoder.PatternLayoutEncoder&quot;</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">pattern</span>&gt;</span>$&#123;pattern&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">pattern</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">encoder</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">appender</span>&gt;</span><br>    <span class="hljs-comment">&lt;!--日志文件输出appender对象--&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">appender</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;file&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;ch.qos.logback.core.FileAppender&quot;</span>&gt;</span><br>        <span class="hljs-comment">&lt;!--日志格式配置--&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">encoder</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;ch.qos.logback.classic.encoder.PatternLayoutEncoder&quot;</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">pattern</span>&gt;</span>$&#123;pattern&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">pattern</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">encoder</span>&gt;</span><br>        <span class="hljs-comment">&lt;!--日志输出路径--&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">file</span>&gt;</span>$&#123;log_dir&#125;/logback.log<span class="hljs-tag">&lt;/<span class="hljs-name">file</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">appender</span>&gt;</span><br>    <span class="hljs-comment">&lt;!-- 生成html格式appender对象 --&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">appender</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;htmlFile&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;ch.qos.logback.core.FileAppender&quot;</span>&gt;</span><br>        <span class="hljs-comment">&lt;!--日志格式配置--&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">encoder</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;ch.qos.logback.core.encoder.LayoutWrappingEncoder&quot;</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">layout</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;ch.qos.logback.classic.html.HTMLLayout&quot;</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">pattern</span>&gt;</span>%level%d&#123;yyyy-MM-dd HH:mm:ss&#125;%c%M%L%thread%m<span class="hljs-tag">&lt;/<span class="hljs-name">pattern</span>&gt;</span><br>            <span class="hljs-tag">&lt;/<span class="hljs-name">layout</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">encoder</span>&gt;</span><br>        <span class="hljs-comment">&lt;!--日志输出路径--&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">file</span>&gt;</span>$&#123;log_dir&#125;/logback.html<span class="hljs-tag">&lt;/<span class="hljs-name">file</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">appender</span>&gt;</span><br>    <span class="hljs-comment">&lt;!--RootLogger对象--&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">root</span> <span class="hljs-attr">level</span>=<span class="hljs-string">&quot;all&quot;</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">appender-ref</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">&quot;console&quot;</span>/&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">appender-ref</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">&quot;file&quot;</span>/&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">appender-ref</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">&quot;htmlFile&quot;</span>/&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">root</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">configuration</span>&gt;</span><br></code></pre></td></tr></table></figure>
</li>
<li><p>RollingFileAppender配置</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-meta">&lt;?xml version=<span class="hljs-string">&quot;1.0&quot;</span> encoding=<span class="hljs-string">&quot;UTF-8&quot;</span>?&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">configuration</span>&gt;</span><br>    <span class="hljs-comment">&lt;!-- 自定义属性 可以通过$&#123;name&#125;进行引用--&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;pattern&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;[%-5level] %d&#123;yyyy-MM-dd HH:mm:ss&#125; %c %M</span></span><br><span class="hljs-string"><span class="hljs-tag">                                    %L [%thread] %m %n&quot;</span>/&gt;</span><br>    <span class="hljs-comment">&lt;!--</span><br><span class="hljs-comment">    日志输出格式：</span><br><span class="hljs-comment">    %d&#123;pattern&#125;日期</span><br><span class="hljs-comment">    %m或者%msg为信息</span><br><span class="hljs-comment">    %M为method</span><br><span class="hljs-comment">    %L为行号</span><br><span class="hljs-comment">    %c类的完整名称</span><br><span class="hljs-comment">    %thread线程名称</span><br><span class="hljs-comment">    %n换行</span><br><span class="hljs-comment">    %-5level</span><br><span class="hljs-comment">    --&gt;</span><br>    <span class="hljs-comment">&lt;!-- 日志文件存放目录 --&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;log_dir&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;d:/logs&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span><br>    <span class="hljs-comment">&lt;!--控制台输出appender对象--&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">appender</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;console&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;ch.qos.logback.core.ConsoleAppender&quot;</span>&gt;</span><br>        <span class="hljs-comment">&lt;!--输出流对象 默认 System.out 改为 System.err--&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">target</span>&gt;</span>System.err<span class="hljs-tag">&lt;/<span class="hljs-name">target</span>&gt;</span><br>        <span class="hljs-comment">&lt;!--日志格式配置--&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">encoder</span></span><br><span class="hljs-tag">                 <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;ch.qos.logback.classic.encoder.PatternLayoutEncoder&quot;</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">pattern</span>&gt;</span>$&#123;pattern&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">pattern</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">encoder</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">appender</span>&gt;</span><br>    <span class="hljs-comment">&lt;!-- 日志文件拆分和归档的appender对象--&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">appender</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;rollFile&quot;</span></span><br><span class="hljs-tag">              <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;ch.qos.logback.core.rolling.RollingFileAppender&quot;</span>&gt;</span><br>        <span class="hljs-comment">&lt;!--日志格式配置--&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">encoder</span></span><br><span class="hljs-tag">                 <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;ch.qos.logback.classic.encoder.PatternLayoutEncoder&quot;</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">pattern</span>&gt;</span>$&#123;pattern&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">pattern</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">encoder</span>&gt;</span><br>        <span class="hljs-comment">&lt;!--日志输出路径--&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">file</span>&gt;</span>$&#123;log_dir&#125;/roll_logback.log<span class="hljs-tag">&lt;/<span class="hljs-name">file</span>&gt;</span><br>        <span class="hljs-comment">&lt;!--指定日志文件拆分和压缩规则--&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">rollingPolicy</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;ch.qos.logback.core.rolling.SizeAndTimeBasedRollingPolicy&quot;</span>&gt;</span><br>            <span class="hljs-comment">&lt;!--通过指定压缩文件名称，来确定分割文件方式--&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">fileNamePattern</span>&gt;</span>$&#123;log_dir&#125;/rolling.%d&#123;yyyy-MMdd&#125;.log%i.gz<span class="hljs-tag">&lt;/<span class="hljs-name">fileNamePattern</span>&gt;</span><br>            <span class="hljs-comment">&lt;!--文件拆分大小--&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">maxFileSize</span>&gt;</span>1MB<span class="hljs-tag">&lt;/<span class="hljs-name">maxFileSize</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">rollingPolicy</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">appender</span>&gt;</span><br>    <span class="hljs-comment">&lt;!--RootLogger对象--&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">root</span> <span class="hljs-attr">level</span>=<span class="hljs-string">&quot;all&quot;</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">appender-ref</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">&quot;console&quot;</span>/&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">appender-ref</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">&quot;rollFile&quot;</span>/&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">root</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">configuration</span>&gt;</span><br></code></pre></td></tr></table></figure>
</li>
<li><p>Filter和异步日志配置</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-meta">&lt;?xml version=<span class="hljs-string">&quot;1.0&quot;</span> encoding=<span class="hljs-string">&quot;UTF-8&quot;</span>?&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">configuration</span>&gt;</span><br>    <span class="hljs-comment">&lt;!-- 自定义属性 可以通过$&#123;name&#125;进行引用--&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;pattern&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;[%-5level] %d&#123;yyyy-MM-dd HH:mm:ss&#125; %c %M</span></span><br><span class="hljs-string"><span class="hljs-tag">                                    %L [%thread] %m %n&quot;</span>/&gt;</span><br>    <span class="hljs-comment">&lt;!--</span><br><span class="hljs-comment">    日志输出格式：</span><br><span class="hljs-comment">    %d&#123;pattern&#125;日期</span><br><span class="hljs-comment">    %m或者%msg为信息</span><br><span class="hljs-comment">    %M为method</span><br><span class="hljs-comment">    %L为行号</span><br><span class="hljs-comment">    %c类的完整名称</span><br><span class="hljs-comment">    %thread线程名称</span><br><span class="hljs-comment">    %n换行</span><br><span class="hljs-comment">    %-5level</span><br><span class="hljs-comment">    --&gt;</span><br>    <span class="hljs-comment">&lt;!-- 日志文件存放目录 --&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;log_dir&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;d:/logs/&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span><br>    <span class="hljs-comment">&lt;!--控制台输出appender对象--&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">appender</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;console&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;ch.qos.logback.core.ConsoleAppender&quot;</span>&gt;</span><br>        <span class="hljs-comment">&lt;!--输出流对象 默认 System.out 改为 System.err--&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">target</span>&gt;</span>System.err<span class="hljs-tag">&lt;/<span class="hljs-name">target</span>&gt;</span><br>        <span class="hljs-comment">&lt;!--日志格式配置--&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">encoder</span></span><br><span class="hljs-tag">                 <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;ch.qos.logback.classic.encoder.PatternLayoutEncoder&quot;</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">pattern</span>&gt;</span>$&#123;pattern&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">pattern</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">encoder</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">appender</span>&gt;</span><br>    <span class="hljs-comment">&lt;!-- 日志文件拆分和归档的appender对象--&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">appender</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;rollFile&quot;</span></span><br><span class="hljs-tag">              <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;ch.qos.logback.core.rolling.RollingFileAppender&quot;</span>&gt;</span><br>        <span class="hljs-comment">&lt;!--日志格式配置--&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">encoder</span></span><br><span class="hljs-tag">                 <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;ch.qos.logback.classic.encoder.PatternLayoutEncoder&quot;</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">pattern</span>&gt;</span>$&#123;pattern&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">pattern</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">encoder</span>&gt;</span><br>        <span class="hljs-comment">&lt;!--日志输出路径--&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">file</span>&gt;</span>$&#123;log_dir&#125;roll_logback.log<span class="hljs-tag">&lt;/<span class="hljs-name">file</span>&gt;</span><br>        <span class="hljs-comment">&lt;!--指定日志文件拆分和压缩规则--&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">rollingPolicy</span></span><br><span class="hljs-tag">                       <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;ch.qos.logback.core.rolling.SizeAndTimeBasedRollingPolicy&quot;</span>&gt;</span><br>            <span class="hljs-comment">&lt;!--通过指定压缩文件名称，来确定分割文件方式--&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">fileNamePattern</span>&gt;</span>$&#123;log_dir&#125;rolling.%d&#123;yyyy-MMdd&#125;.log%i.gz<span class="hljs-tag">&lt;/<span class="hljs-name">fileNamePattern</span>&gt;</span><br>            <span class="hljs-comment">&lt;!--文件拆分大小--&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">maxFileSize</span>&gt;</span>1MB<span class="hljs-tag">&lt;/<span class="hljs-name">maxFileSize</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">rollingPolicy</span>&gt;</span><br>        <span class="hljs-comment">&lt;!--filter配置--&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">filter</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;ch.qos.logback.classic.filter.LevelFilter&quot;</span>&gt;</span><br>            <span class="hljs-comment">&lt;!--设置拦截日志级别--&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">level</span>&gt;</span>error<span class="hljs-tag">&lt;/<span class="hljs-name">level</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">onMatch</span>&gt;</span>ACCEPT<span class="hljs-tag">&lt;/<span class="hljs-name">onMatch</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">onMismatch</span>&gt;</span>DENY<span class="hljs-tag">&lt;/<span class="hljs-name">onMismatch</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">filter</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">appender</span>&gt;</span><br>    <span class="hljs-comment">&lt;!--异步日志--&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">appender</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;async&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;ch.qos.logback.classic.AsyncAppender&quot;</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">appender-ref</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">&quot;rollFile&quot;</span>/&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">appender</span>&gt;</span><br>    <span class="hljs-comment">&lt;!--RootLogger对象--&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">root</span> <span class="hljs-attr">level</span>=<span class="hljs-string">&quot;all&quot;</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">appender-ref</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">&quot;console&quot;</span>/&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">appender-ref</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">&quot;async&quot;</span>/&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">root</span>&gt;</span><br>    <span class="hljs-comment">&lt;!--自定义logger additivity表示是否从 rootLogger继承配置--&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">logger</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;com.ydlclass&quot;</span> <span class="hljs-attr">level</span>=<span class="hljs-string">&quot;debug&quot;</span> <span class="hljs-attr">additivity</span>=<span class="hljs-string">&quot;false&quot;</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">appender-ref</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">&quot;console&quot;</span>/&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">logger</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">configuration</span>&gt;</span><br></code></pre></td></tr></table></figure></li>
</ol>
<h2 id="五、logback-access的使用"><a href="#五、logback-access的使用" class="headerlink" title="五、logback-access的使用"></a>五、logback-access的使用</h2><p>在server.xml里的<code>&lt;host&gt;</code>标签下加上</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">Valve</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&quot;org.apache.catalina.valves.AccessLogValve&quot;</span>  <span class="hljs-attr">directory</span>=<span class="hljs-string">&quot;logs&quot;</span> <span class="hljs-attr">prefix</span>=<span class="hljs-string">&quot;localhost_access_log.&quot;</span> <span class="hljs-attr">suffix</span>=<span class="hljs-string">&quot;.txt&quot;</span>  <span class="hljs-attr">pattern</span>=<span class="hljs-string">&quot;common&quot;</span> <span class="hljs-attr">resolveHosts</span>=<span class="hljs-string">&quot;false&quot;</span>/&gt;</span><br></code></pre></td></tr></table></figure>

<p>就可以了，下面咱们逐一分析各个参数。</p>
<table>
<thead>
<tr>
<th>className</th>
<th>想配置访问日志？这就必须得写成这样。</th>
</tr>
</thead>
<tbody><tr>
<td>directory</td>
<td>这个东西是日志文件放置的目录，在tomcat下面有个logs文件夹，那里面是专门放置日志文件的，当然你也可以修改，我就给改成了D:\</td>
</tr>
<tr>
<td>prefix</td>
<td>这个是日志文件的名称前缀，我的日志名称为localhost_access_log.2007-09-22.txt，前面的前缀就是这个localhost_access_log</td>
</tr>
<tr>
<td>suffix</td>
<td>这就是后缀名啦，可以改成别的</td>
</tr>
<tr>
<td>pattern</td>
<td>这个是最主要的参数了，具体的咱们下面讲，这个参数的内容比较丰富。</td>
</tr>
<tr>
<td>resolveHosts</td>
<td>如果这个值是true的话，tomcat会将这个服务器IP地址通过DNS转换为主机名，如果是false，就直接写服务器IP地址啦</td>
</tr>
</tbody></table>
<p>To use logback-access with Tomcat, after downloading the logback distribution, place the files <em>logback-core-1.3.0-alpha10.jar</em> and <em>logback-access-1.3.0-alpha10.jar</em> under $TOMCAT_HOME&#x2F;lib&#x2F; directory, where $TOMCAT_HOME is the folder where you have installed Tomcat.</p>
<p>logback-access模块与Servlet容器（如Tomcat和Jetty）集成，以提供HTTP访问日志功能。我们可以使 用logback-access模块来替换tomcat的访问日志。</p>
<ol>
<li>将logback-access.jar与logback-core.jar复制到$TOMCAT_HOME&#x2F;lib&#x2F;目录下</li>
<li>修改$TOMCAT_HOME&#x2F;conf&#x2F;server.xml中的Host元素中添加：</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java">&lt;Valve className=<span class="hljs-string">&quot;ch.qos.logback.access.tomcat.LogbackValve&quot;</span>/&gt;<br></code></pre></td></tr></table></figure>

<ol start="3">
<li><p>logback默认会在$TOMCAT_HOME&#x2F;conf下查找文件 logback-access.xml</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-meta">&lt;?xml version=<span class="hljs-string">&quot;1.0&quot;</span> encoding=<span class="hljs-string">&quot;UTF-8&quot;</span>?&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">configuration</span>&gt;</span><br>    <span class="hljs-comment">&lt;!-- always a good activate OnConsoleStatusListener --&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">statusListener</span></span><br><span class="hljs-tag">                    <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;ch.qos.logback.core.status.OnConsoleStatusListener&quot;</span>/&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;LOG_DIR&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;$&#123;catalina.base&#125;/logs&quot;</span>/&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">appender</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;FILE&quot;</span></span><br><span class="hljs-tag">              <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;ch.qos.logback.core.rolling.RollingFileAppender&quot;</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">file</span>&gt;</span>$&#123;LOG_DIR&#125;/access.log<span class="hljs-tag">&lt;/<span class="hljs-name">file</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">rollingPolicy</span></span><br><span class="hljs-tag">                       <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;ch.qos.logback.core.rolling.TimeBasedRollingPolicy&quot;</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">fileNamePattern</span>&gt;</span>access.%d&#123;yyyy-MM-dd&#125;.log.zip<span class="hljs-tag">&lt;/<span class="hljs-name">fileNamePattern</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">rollingPolicy</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">encoder</span>&gt;</span><br>            <span class="hljs-comment">&lt;!-- 访问日志的格式 --&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">pattern</span>&gt;</span>combined<span class="hljs-tag">&lt;/<span class="hljs-name">pattern</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">encoder</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">appender</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">appender-ref</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">&quot;FILE&quot;</span>/&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">configuration</span>&gt;</span><br></code></pre></td></tr></table></figure>

<p>官方配置： <a target="_blank" rel="noopener" href="https://logback.qos.ch/access.html#configuration">https://logback.qos.ch/access.html#configuration</a></p>
</li>
</ol>
<h1 id="第六章-log4j2的使用"><a href="#第六章-log4j2的使用" class="headerlink" title="第六章 log4j2的使用"></a>第六章 log4j2的使用</h1><p>Apache Log4j2是对Log4j的升级版，参考了logback的一些优秀的设计，并且修复了一些问题，因此带来了一些重大的提升，主要有：</p>
<ul>
<li>异常处理，在logback中，Appender中的异常不会被应用感知到，但是在log4j2中，提供了一些异常处理机制。</li>
<li>性能提升， log4j2相较于log4j 和logback都具有很明显的性能提升，后面会有官方测试的数据。</li>
<li>自动重载配置，参考了logback的设计，当然会提供自动刷新参数配置，最实用的就是我们在生产 上可以动态的修改日志的级别而不需要重启应用。</li>
</ul>
<p>官网： <a target="_blank" rel="noopener" href="https://logging.apache.org/log4j/2.x/">https://logging.apache.org/log4j/2.x/</a></p>
<h2 id="一、Log4j2入门"><a href="#一、Log4j2入门" class="headerlink" title="一、Log4j2入门"></a>一、Log4j2入门</h2><p>目前已经有三个门面了，其实不管是哪里都是江湖，都想写一个门面，一统江湖，所以log42出了提供日志实现以外，也拥有一套自己的独立的门面。</p>
<p> 目前市面上最主流的日志门面就是SLF4J，虽然Log4j2也是日志门面，因为它的日志实现功能非常强大，性能优越。所以大家一般还是将Log4j2看作是日志的实现，Slf4j + Log4j2应该是未来的大势所趋</p>
<h3 id="1、使用log4j-api做门面"><a href="#1、使用log4j-api做门面" class="headerlink" title="1、使用log4j-api做门面"></a>1、使用log4j-api做门面</h3><p>（1）添加依赖</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-comment">&lt;!-- Log4j2 门面API--&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.apache.logging.log4j<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>log4j-api<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>2.14.1<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><span class="hljs-comment">&lt;!-- Log4j2 日志实现 --&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.apache.logging.log4j<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>log4j-core<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>2.14.1<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></td></tr></table></figure>

<p>（2）JAVA代码</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">TestLog4j2</span> &#123;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">Logger</span> <span class="hljs-variable">LOGGER</span> <span class="hljs-operator">=</span> LogManager.getLogger(TestLog4j2.class);<br><br>    <span class="hljs-meta">@Test</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">testLog</span><span class="hljs-params">()</span>&#123;<br>        LOGGER.fatal(<span class="hljs-string">&quot;fatal&quot;</span>);<br>        LOGGER.error(<span class="hljs-string">&quot;error&quot;</span>);<br>        LOGGER.warn(<span class="hljs-string">&quot;warn&quot;</span>);<br>        LOGGER.info(<span class="hljs-string">&quot;info&quot;</span>);<br>        LOGGER.debug(<span class="hljs-string">&quot;debug&quot;</span>);<br>        LOGGER.trace(<span class="hljs-string">&quot;trace&quot;</span>);<br>    &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure>

<h3 id="2、使用slf4j做门面"><a href="#2、使用slf4j做门面" class="headerlink" title="2、使用slf4j做门面"></a>2、使用slf4j做门面</h3><p>使用slf4j作为日志的门面，使用log4j2作为日志的实现。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-comment">&lt;!-- Log4j2 门面API--&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.apache.logging.log4j<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>log4j-api<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>2.14.1<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><span class="hljs-comment">&lt;!-- Log4j2 日志实现 --&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.apache.logging.log4j<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>log4j-core<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>2.14.1<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><span class="hljs-comment">&lt;!--使用slf4j作为日志的门面,使用log4j2来记录日志 --&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.slf4j<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>slf4j-api<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.7.30<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><span class="hljs-comment">&lt;!--为slf4j绑定日志实现 log4j2的适配器 --&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.apache.logging.log4j<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>log4j-slf4j-impl<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>2.12.1<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> org.slf4j.<span class="hljs-type">Logger</span> <span class="hljs-variable">LOG</span> <span class="hljs-operator">=</span> LoggerFactory.getLogger(TestLog4j2.class);<br><br><span class="hljs-meta">@Test</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">testSlf4j</span><span class="hljs-params">()</span>&#123;<br>    LOG.error(<span class="hljs-string">&quot;error&quot;</span>);<br>    LOG.warn(<span class="hljs-string">&quot;warn&quot;</span>);<br>    LOG.debug(<span class="hljs-string">&quot;debug&quot;</span>);<br>    LOG.info(<span class="hljs-string">&quot;info&quot;</span>);<br>    LOG.trace(<span class="hljs-string">&quot;trace&quot;</span>);<br>&#125;<br></code></pre></td></tr></table></figure>

<h2 id="二、Log4j2配置"><a href="#二、Log4j2配置" class="headerlink" title="二、Log4j2配置"></a>二、Log4j2配置</h2><h3 id="1、默认配置："><a href="#1、默认配置：" class="headerlink" title="1、默认配置："></a>1、默认配置：</h3><p>DefaultConfiguration类中提供的默认配置将设置，</p>
<p>通过debug可以在LoggerContext类中发现</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">private</span> <span class="hljs-keyword">volatile</span> <span class="hljs-type">Configuration</span> <span class="hljs-variable">configuration</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">DefaultConfiguration</span>();<br></code></pre></td></tr></table></figure>

<p>可以看到默认的root日志的layout</p>
<p><img src="/../../../local_blog/springboot/SpringBoot%E6%97%A5%E5%BF%97%E6%A1%86%E6%9E%B6/image-20220316225755166-16474426759331.png" srcset="/img/loading.gif" lazyload alt="image-20220316225755166"></p>
<p>我们能从默认配置类中看到一些默认的配置：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setToDefault</span><span class="hljs-params">()</span> &#123;<br>    <span class="hljs-comment">// LOG4J2-1176 facilitate memory leak investigation</span><br>    setName(DefaultConfiguration.DEFAULT_NAME + <span class="hljs-string">&quot;@&quot;</span> + Integer.toHexString(hashCode()));<br>    <span class="hljs-keyword">final</span> Layout&lt;? <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Serializable</span>&gt; layout = PatternLayout.newBuilder()<br>        .withPattern(DefaultConfiguration.DEFAULT_PATTERN)<br>        .withConfiguration(<span class="hljs-built_in">this</span>)<br>        .build();<br>    <span class="hljs-keyword">final</span> <span class="hljs-type">Appender</span> <span class="hljs-variable">appender</span> <span class="hljs-operator">=</span> ConsoleAppender.createDefaultAppenderForLayout(layout);<br>    appender.start();<br>    addAppender(appender);<br>    <span class="hljs-keyword">final</span> <span class="hljs-type">LoggerConfig</span> <span class="hljs-variable">rootLoggerConfig</span> <span class="hljs-operator">=</span> getRootLogger();<br>    rootLoggerConfig.addAppender(appender, <span class="hljs-literal">null</span>, <span class="hljs-literal">null</span>);<br><br>    <span class="hljs-keyword">final</span> <span class="hljs-type">Level</span> <span class="hljs-variable">defaultLevel</span> <span class="hljs-operator">=</span> Level.ERROR;<br>    <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">levelName</span> <span class="hljs-operator">=</span> PropertiesUtil.getProperties().getStringProperty(DefaultConfiguration.DEFAULT_LEVEL,<br>                                                                              defaultLevel.name());<br>    <span class="hljs-keyword">final</span> <span class="hljs-type">Level</span> <span class="hljs-variable">level</span> <span class="hljs-operator">=</span> Level.valueOf(levelName);<br>    rootLoggerConfig.setLevel(level != <span class="hljs-literal">null</span> ? level : defaultLevel);<br>&#125;<br></code></pre></td></tr></table></figure>

<p>5 自定义配置文件位置</p>
<p>log4j2默认在classpath下查找配置文件，可以修改配置文件的位置。在非web项目中：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> IOException &#123;<br>	<span class="hljs-type">File</span> <span class="hljs-variable">file</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">File</span>(<span class="hljs-string">&quot;D:/log4j2.xml&quot;</span>);<br>	<span class="hljs-type">BufferedInputStream</span> <span class="hljs-variable">in</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">BufferedInputStream</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">FileInputStream</span>(file));<br>	<span class="hljs-keyword">final</span> <span class="hljs-type">ConfigurationSource</span> <span class="hljs-variable">source</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ConfigurationSource</span>(in);<br>	Configurator.initialize(<span class="hljs-literal">null</span>, source);<br>	<br>	<span class="hljs-type">Logger</span> <span class="hljs-variable">logger</span> <span class="hljs-operator">=</span> LogManager.getLogger(<span class="hljs-string">&quot;mylog&quot;</span>);<br>&#125;<br></code></pre></td></tr></table></figure>

<p>如果是web项目，在web.xml中添加</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">context-param</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">param-name</span>&gt;</span>log4jConfiguration<span class="hljs-tag">&lt;/<span class="hljs-name">param-name</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">param-value</span>&gt;</span>/WEB-INF/conf/log4j2.xml<span class="hljs-tag">&lt;/<span class="hljs-name">param-value</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">context-param</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">listener</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">listener-class</span>&gt;</span>org.apache.logging.log4j.web.Log4jServletContextListener<span class="hljs-tag">&lt;/<span class="hljs-name">listener-class</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">listener</span>&gt;</span><br></code></pre></td></tr></table></figure>

<p>log4j2默认加载classpath下的 log4j2.xml 文件中的配置。事实上log4j2可以通过 XML、JSON、YAML 或properties格式进行配置：</p>
<p><a target="_blank" rel="noopener" href="https://logging.apache.org/log4j/2.x/manual/configuration.html">https://logging.apache.org/log4j/2.x/manual/configuration.html</a></p>
<p>如果找不到配置文件，Log4j 将提供默认配置。DefaultConfiguration 类中提供的默认配置将设置：</p>
<ul>
<li>%d{HH:mm:ss.SSS} ，表示输出到毫秒的时间</li>
<li>%t，输出当前线程名称</li>
<li>%-5level，输出日志级别，-5表示左对齐并且固定输出5个字符，如果不足在右边补0</li>
<li>%logger，输出logger名称，因为Root Logger没有名称，所以没有输出</li>
<li>%msg，日志文本</li>
<li>%n，换行</li>
</ul>
<p>其他常用的占位符有：</p>
<ul>
<li>%F，输出所在的类文件名，如Client.java</li>
<li>%L，输出行号</li>
<li>%M，输出所在方法名</li>
<li>%l，输出语句所在的行数, 包括类名、方法名、文件名、行数</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-meta">&lt;?xml version=<span class="hljs-string">&quot;1.0&quot;</span> encoding=<span class="hljs-string">&quot;UTF-8&quot;</span>?&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">Configuration</span> <span class="hljs-attr">status</span>=<span class="hljs-string">&quot;warn&quot;</span> <span class="hljs-attr">monitorInterval</span>=<span class="hljs-string">&quot;5&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">properties</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;LOG_HOME&quot;</span>&gt;</span>D:/logs<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">properties</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">Appenders</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">Console</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;Console&quot;</span> <span class="hljs-attr">target</span>=<span class="hljs-string">&quot;SYSTEM_OUT&quot;</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">PatternLayout</span> <span class="hljs-attr">pattern</span>=<span class="hljs-string">&quot;%d&#123;HH:mm:ss.SSS&#125; [%t] [%-5level] %c&#123;36&#125;:%L -</span></span><br><span class="hljs-string"><span class="hljs-tag">                                    -- %m%n&quot;</span> /&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">Console</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">File</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;file&quot;</span> <span class="hljs-attr">fileName</span>=<span class="hljs-string">&quot;$&#123;LOG_HOME&#125;/myfile.log&quot;</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">PatternLayout</span> <span class="hljs-attr">pattern</span>=<span class="hljs-string">&quot;[%d&#123;yyyy-MM-dd HH:mm:ss.SSS&#125;] [%-5level] %l</span></span><br><span class="hljs-string"><span class="hljs-tag">                                    %c&#123;36&#125; - %m%n&quot;</span> /&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">File</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">RandomAccessFile</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;accessFile&quot;</span> <span class="hljs-attr">fileName</span>=<span class="hljs-string">&quot;$&#123;LOG_HOME&#125;/myAcclog.log&quot;</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">PatternLayout</span> <span class="hljs-attr">pattern</span>=<span class="hljs-string">&quot;[%d&#123;yyyy-MM-dd HH:mm:ss.SSS&#125;] [%-5level] %l</span></span><br><span class="hljs-string"><span class="hljs-tag">                                    %c&#123;36&#125; - %m%n&quot;</span> /&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">RandomAccessFile</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">RollingFile</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;rollingFile&quot;</span> <span class="hljs-attr">fileName</span>=<span class="hljs-string">&quot;$&#123;LOG_HOME&#125;/myrollog.log&quot;</span></span><br><span class="hljs-tag">                     <span class="hljs-attr">filePattern</span>=<span class="hljs-string">&quot;D:/logs/$&#123;date:yyyy-MM-dd&#125;/myrollog-%d&#123;yyyyMM-dd-HH-mm&#125;-%i.log&quot;</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">ThresholdFilter</span> <span class="hljs-attr">level</span>=<span class="hljs-string">&quot;debug&quot;</span> <span class="hljs-attr">onMatch</span>=<span class="hljs-string">&quot;ACCEPT&quot;</span> <span class="hljs-attr">onMismatch</span>=<span class="hljs-string">&quot;DENY&quot;</span> /&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">PatternLayout</span> <span class="hljs-attr">pattern</span>=<span class="hljs-string">&quot;[%d&#123;yyyy-MM-dd HH:mm:ss.SSS&#125;] [%-5level] %l</span></span><br><span class="hljs-string"><span class="hljs-tag">                                    %c&#123;36&#125; - %msg%n&quot;</span> /&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">Policies</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">OnStartupTriggeringPolicy</span> /&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">SizeBasedTriggeringPolicy</span> <span class="hljs-attr">size</span>=<span class="hljs-string">&quot;10 MB&quot;</span> /&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">TimeBasedTriggeringPolicy</span> /&gt;</span><br>            <span class="hljs-tag">&lt;/<span class="hljs-name">Policies</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">DefaultRolloverStrategy</span> <span class="hljs-attr">max</span>=<span class="hljs-string">&quot;30&quot;</span> /&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">RollingFile</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">RollingRandomAccessFile</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;MyFile&quot;</span></span><br><span class="hljs-tag">			<span class="hljs-attr">fileName</span>=<span class="hljs-string">&quot;$&#123;LOG_HOME&#125;/$&#123;FILE_NAME&#125;.log&quot;</span></span><br><span class="hljs-tag">			<span class="hljs-attr">filePattern</span>=<span class="hljs-string">&quot;$&#123;LOG_HOME&#125;/$&#123;date:yyyy-MM&#125;/$&#123;FILE_NAME&#125;-%d&#123;yyyy-MM-dd HH-mm&#125;-%i.log&quot;</span>&gt;</span><br>			<span class="hljs-tag">&lt;<span class="hljs-name">PatternLayout</span></span><br><span class="hljs-tag">				<span class="hljs-attr">pattern</span>=<span class="hljs-string">&quot;%d&#123;yyyy-MM-dd HH:mm:ss.SSS&#125; [%t] %-5level %logger&#123;36&#125; - %msg%n&quot;</span> /&gt;</span><br>			<span class="hljs-tag">&lt;<span class="hljs-name">Policies</span>&gt;</span><br>				<span class="hljs-tag">&lt;<span class="hljs-name">TimeBasedTriggeringPolicy</span> <span class="hljs-attr">interval</span>=<span class="hljs-string">&quot;1&quot;</span> /&gt;</span><br>				<span class="hljs-tag">&lt;<span class="hljs-name">SizeBasedTriggeringPolicy</span> <span class="hljs-attr">size</span>=<span class="hljs-string">&quot;10 MB&quot;</span> /&gt;</span><br>			<span class="hljs-tag">&lt;/<span class="hljs-name">Policies</span>&gt;</span><br>			<span class="hljs-tag">&lt;<span class="hljs-name">DefaultRolloverStrategy</span> <span class="hljs-attr">max</span>=<span class="hljs-string">&quot;20&quot;</span> /&gt;</span><br>		<span class="hljs-tag">&lt;/<span class="hljs-name">RollingRandomAccessFile</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">Appenders</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">Loggers</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">Logger</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;mylog&quot;</span> <span class="hljs-attr">level</span>=<span class="hljs-string">&quot;trace&quot;</span> <span class="hljs-attr">additivity</span>=<span class="hljs-string">&quot;false&quot;</span>&gt;</span><br>			<span class="hljs-tag">&lt;<span class="hljs-name">AppenderRef</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">&quot;MyFile&quot;</span> /&gt;</span><br>		<span class="hljs-tag">&lt;/<span class="hljs-name">Logger</span>&gt;</span><br>		<span class="hljs-tag">&lt;<span class="hljs-name">Root</span> <span class="hljs-attr">level</span>=<span class="hljs-string">&quot;error&quot;</span>&gt;</span><br>			<span class="hljs-tag">&lt;<span class="hljs-name">AppenderRef</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">&quot;Console&quot;</span> /&gt;</span><br>		<span class="hljs-tag">&lt;/<span class="hljs-name">Root</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">Loggers</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">Configuration</span>&gt;</span><br></code></pre></td></tr></table></figure>

<p>注意根节点增加了一个monitorInterval属性，含义是每隔300秒重新读取配置文件，可以不重启应用的情况下修改配置，还是很好用的功能。</p>
<p>RollingRandomAccessFile的属性：</p>
<ul>
<li>fileName 指定当前日志文件的位置和文件名称</li>
<li>filePattern 指定当发生Rolling时，文件的转移和重命名规则</li>
<li>SizeBasedTriggeringPolicy 指定当文件体积大于size指定的值时，触发Rolling</li>
<li>DefaultRolloverStrategy 指定最多保存的文件个数</li>
<li>TimeBasedTriggeringPolicy 这个配置需要和filePattern结合使用，</li>
<li>注意filePattern中配置的文件重命名规则是${FILE_NAME}-%d{yyyy-MM-dd HH-mm}-%i，最小的时间粒度是mm，即分钟。</li>
<li>TimeBasedTriggeringPolicy指定的size是1，结合起来就是每1分钟生成一个新文件。如果改成%d{yyyy-MM-dd HH}，最小粒度为小时，则每一个小时生成一个文件。</li>
</ul>
<h2 id="三、Log4j2异步日志"><a href="#三、Log4j2异步日志" class="headerlink" title="三、Log4j2异步日志"></a>三、Log4j2异步日志</h2><p><strong>异步日志</strong></p>
<p>log4j2最大的特点就是异步日志，其性能的提升主要也是从异步日志中受益，我们来看看如何使用 log4j2的异步日志。</p>
<p>Log4j2提供了两种实现日志的方式，一个是通过AsyncAppender，一个是通过AsyncLogger，分别对应 前面我们说的Appender组件和Logger组件。</p>
<p>注意：配置异步日志需要添加依赖</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-comment">&lt;!--异步日志依赖--&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.lmax<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>disruptor<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>3.3.4<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></td></tr></table></figure>

<ol>
<li><p>AsyncAppender方式</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-meta">&lt;?xml version=<span class="hljs-string">&quot;1.0&quot;</span> encoding=<span class="hljs-string">&quot;UTF-8&quot;</span>?&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">Configuration</span> <span class="hljs-attr">status</span>=<span class="hljs-string">&quot;warn&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">properties</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;LOG_HOME&quot;</span>&gt;</span>D:/logs<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">properties</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">Appenders</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">File</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;file&quot;</span> <span class="hljs-attr">fileName</span>=<span class="hljs-string">&quot;$&#123;LOG_HOME&#125;/myfile.log&quot;</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">PatternLayout</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">Pattern</span>&gt;</span>%d %p %c&#123;1.&#125; [%t] %m%n<span class="hljs-tag">&lt;/<span class="hljs-name">Pattern</span>&gt;</span><br>            <span class="hljs-tag">&lt;/<span class="hljs-name">PatternLayout</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">File</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">Async</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;Async&quot;</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">AppenderRef</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">&quot;file&quot;</span>/&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">Async</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">Appenders</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">Loggers</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">Root</span> <span class="hljs-attr">level</span>=<span class="hljs-string">&quot;error&quot;</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">AppenderRef</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">&quot;Async&quot;</span>/&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">Root</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">Loggers</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">Configuration</span>&gt;</span><br></code></pre></td></tr></table></figure>
</li>
<li><p>AsyncLogger方式</p>
<p>AsyncLogger才是log4j2 的重头戏，也是官方推荐的异步方式。它可以使得调用Logger.log返回的 更快。你可以有两种选择：全局异步和混合异步。</p>
</li>
</ol>
<ul>
<li><p><strong>全局异步</strong>就是，所有的日志都异步的记录，在配置文件上不用做任何改动，只需要添加一个 log4j2.component.properties 配置；</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs properties"><span class="hljs-attr">Log4jContextSelector</span>=<span class="hljs-string">org.apache.logging.log4j.core.async.AsyncLoggerContextSelector</span><br></code></pre></td></tr></table></figure>
</li>
<li><p><strong>混合异步</strong>就是，你可以在应用中同时使用同步日志和异步日志，这使得日志的配置方式更加灵活。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-meta">&lt;?xml version=<span class="hljs-string">&quot;1.0&quot;</span> encoding=<span class="hljs-string">&quot;UTF-8&quot;</span>?&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">Configuration</span> <span class="hljs-attr">status</span>=<span class="hljs-string">&quot;WARN&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">properties</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;LOG_HOME&quot;</span>&gt;</span>D:/logs<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">properties</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">Appenders</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">File</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;file&quot;</span> <span class="hljs-attr">fileName</span>=<span class="hljs-string">&quot;$&#123;LOG_HOME&#125;/myfile.log&quot;</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">PatternLayout</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">Pattern</span>&gt;</span>%d %p %c&#123;1.&#125; [%t] %m%n<span class="hljs-tag">&lt;/<span class="hljs-name">Pattern</span>&gt;</span><br>            <span class="hljs-tag">&lt;/<span class="hljs-name">PatternLayout</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">File</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">Async</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;Async&quot;</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">AppenderRef</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">&quot;file&quot;</span>/&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">Async</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">Appenders</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">Loggers</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">AsyncLogger</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;com.ydlclass&quot;</span> <span class="hljs-attr">level</span>=<span class="hljs-string">&quot;trace&quot;</span></span><br><span class="hljs-tag">                     <span class="hljs-attr">includeLocation</span>=<span class="hljs-string">&quot;false&quot;</span> <span class="hljs-attr">additivity</span>=<span class="hljs-string">&quot;false&quot;</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">AppenderRef</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">&quot;file&quot;</span>/&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">AsyncLogger</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">Root</span> <span class="hljs-attr">level</span>=<span class="hljs-string">&quot;info&quot;</span> <span class="hljs-attr">includeLocation</span>=<span class="hljs-string">&quot;true&quot;</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">AppenderRef</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">&quot;file&quot;</span>/&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">Root</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">Loggers</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">Configuration</span>&gt;</span><br></code></pre></td></tr></table></figure></li>
</ul>
<p>如上配置： com.ydlclass 日志是异步的，root日志是同步的。</p>
<p>使用异步日志需要注意的问题：</p>
<ol>
<li>如果使用异步日志，AsyncAppender、AsyncLogger和全局日志，不要同时出现。性能会和 AsyncAppender一致，降至最低。</li>
<li>设置includeLocation&#x3D;false ，打印位置信息会急剧降低异步日志的性能，比同步日志还要慢。</li>
</ol>
<h1 id="第七章：SpringBoot"><a href="#第七章：SpringBoot" class="headerlink" title="第七章：SpringBoot"></a>第七章：SpringBoot</h1><h2 id="第一步"><a href="#第一步" class="headerlink" title="第一步"></a>第一步</h2><p>准备 logback.xml</p>
<p>在 springboot 推荐使用  logback-spring.xml 配置文件</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-meta">&lt;?xml version=<span class="hljs-string">&quot;1.0&quot;</span> encoding=<span class="hljs-string">&quot;UTF-8&quot;</span>?&gt;</span><br><span class="hljs-comment">&lt;!-- 日志级别从低到高分为TRACE &lt; DEBUG &lt; INFO &lt; WARN &lt; ERROR &lt; FATAL，如果设置为WARN，则低于WARN的信息都不会输出 --&gt;</span><br><span class="hljs-comment">&lt;!-- scan:当此属性设置为true时，配置文件如果发生改变，将会被重新加载，默认值为true --&gt;</span><br><span class="hljs-comment">&lt;!-- scanPeriod:设置监测配置文件是否有修改的时间间隔，如果没有给出时间单位，默认单位是毫秒。当scan为true时，此属性生效。默认的时间间隔为1分钟。 --&gt;</span><br><span class="hljs-comment">&lt;!-- de<span class="hljs-doctag">bug:</span>当此属性设置为true时，将打印出logback内部日志信息，实时查看logback运行状态。默认值为false。 --&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">configuration</span>  <span class="hljs-attr">scan</span>=<span class="hljs-string">&quot;true&quot;</span> <span class="hljs-attr">scanPeriod</span>=<span class="hljs-string">&quot;10 seconds&quot;</span>&gt;</span><br><br>    <span class="hljs-comment">&lt;!--&lt;include resource=&quot;org/springframework/boot/logging/logback/base.xml&quot; /&gt;--&gt;</span><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">contextName</span>&gt;</span>logback<span class="hljs-tag">&lt;/<span class="hljs-name">contextName</span>&gt;</span><br>    <span class="hljs-comment">&lt;!-- name的值是变量的名称，value的值时变量定义的值。通过定义的值会被插入到logger上下文中。定义变量后，可以使“$&#123;&#125;”来使用变量。 --&gt;</span><br>    <span class="hljs-comment">&lt;!-- 日志存放目录 --&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;LOG_HOME&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;D:/dev/logs/boot-start/aop&quot;</span> /&gt;</span><br><br>    <span class="hljs-comment">&lt;!-- 彩色日志 --&gt;</span><br>    <span class="hljs-comment">&lt;!-- 彩色日志依赖的渲染类 --&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">conversionRule</span> <span class="hljs-attr">conversionWord</span>=<span class="hljs-string">&quot;clr&quot;</span> <span class="hljs-attr">converterClass</span>=<span class="hljs-string">&quot;org.springframework.boot.logging.logback.ColorConverter&quot;</span> /&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">conversionRule</span> <span class="hljs-attr">conversionWord</span>=<span class="hljs-string">&quot;wex&quot;</span> <span class="hljs-attr">converterClass</span>=<span class="hljs-string">&quot;org.springframework.boot.logging.logback.WhitespaceThrowableProxyConverter&quot;</span> /&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">conversionRule</span> <span class="hljs-attr">conversionWord</span>=<span class="hljs-string">&quot;wEx&quot;</span> <span class="hljs-attr">converterClass</span>=<span class="hljs-string">&quot;org.springframework.boot.logging.logback.ExtendedWhitespaceThrowableProxyConverter&quot;</span> /&gt;</span><br><br>    <span class="hljs-comment">&lt;!--</span><br><span class="hljs-comment">        %p:输出优先级，即DEBUG,INFO,WARN,ERROR,FATAL</span><br><span class="hljs-comment">        %r:输出自应用启动到输出该日志讯息所耗费的毫秒数</span><br><span class="hljs-comment">        %t:输出产生该日志事件的线程名</span><br><span class="hljs-comment">        %f:输出日志讯息所属的类别的类别名</span><br><span class="hljs-comment">        %c:输出日志讯息所属的类的全名</span><br><span class="hljs-comment">        %d:输出日志时间点的日期或时间，指定格式的方式： %d&#123;yyyy-MM-dd HH:mm:ss&#125;</span><br><span class="hljs-comment">        %l:输出日志事件的发生位置，即输出日志讯息的语句在他所在类别的第几行。</span><br><span class="hljs-comment">        %m:输出代码中指定的讯息，如log(message)中的message</span><br><span class="hljs-comment">        %n:输出一个换行符号</span><br><span class="hljs-comment">    --&gt;</span><br>    <span class="hljs-comment">&lt;!-- 彩色日志格式 --&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;CONSOLE_LOG_PATTERN&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;$&#123;CONSOLE_LOG_PATTERN:-%clr(%d&#123;yyyy-MM-dd HH:mm:ss.SSS&#125;)&#123;faint&#125; %clr($&#123;LOG_LEVEL_PATTERN:-%5p&#125;) %clr($&#123;PID:- &#125;)&#123;magenta&#125; %clr(---)&#123;faint&#125; %clr([%15.15t])&#123;faint&#125; %clr(%-40.40logger&#123;39&#125;)&#123;cyan&#125; %clr(:)&#123;faint&#125; %m%n$&#123;LOG_EXCEPTION_CONVERSION_WORD:-%wEx&#125;&#125;&quot;</span>/&gt;</span><br><br><br>    <span class="hljs-comment">&lt;!--</span><br><span class="hljs-comment">        Appender: 设置日志信息的去向,常用的有以下几个</span><br><span class="hljs-comment">            ch.qos.logback.core.ConsoleAppender (控制台)</span><br><span class="hljs-comment">            ch.qos.logback.core.rolling.RollingFileAppender (文件大小到达指定尺寸的时候产生一个新文件)</span><br><span class="hljs-comment">            ch.qos.logback.core.FileAppender (文件)</span><br><span class="hljs-comment">    --&gt;</span><br>    <span class="hljs-comment">&lt;!--输出到控制台--&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">appender</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;CONSOLE&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;ch.qos.logback.core.ConsoleAppender&quot;</span>&gt;</span><br>        <span class="hljs-comment">&lt;!--此日志appender是为开发使用，只配置最底级别，控制台输出的日志级别是大于或等于此级别的日志信息--&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">filter</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;ch.qos.logback.classic.filter.ThresholdFilter&quot;</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">level</span>&gt;</span>info<span class="hljs-tag">&lt;/<span class="hljs-name">level</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">filter</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">encoder</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">Pattern</span>&gt;</span>$&#123;CONSOLE_LOG_PATTERN&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">Pattern</span>&gt;</span><br>            <span class="hljs-comment">&lt;!-- 设置字符集 --&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">charset</span>&gt;</span>UTF-8<span class="hljs-tag">&lt;/<span class="hljs-name">charset</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">encoder</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">appender</span>&gt;</span><br><br><br>    <span class="hljs-comment">&lt;!--输出到文件--&gt;</span><br><br>    <span class="hljs-comment">&lt;!-- 时间滚动输出 level为 DEBUG 日志 --&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">appender</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;DEBUG_FILE&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;ch.qos.logback.core.rolling.RollingFileAppender&quot;</span>&gt;</span><br>        <span class="hljs-comment">&lt;!-- 正在记录的日志文件的路径及文件名 --&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">file</span>&gt;</span>$&#123;LOG_HOME&#125;/log_debug.log<span class="hljs-tag">&lt;/<span class="hljs-name">file</span>&gt;</span><br>        <span class="hljs-comment">&lt;!--日志文件输出格式--&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">encoder</span>&gt;</span><br>            <span class="hljs-comment">&lt;!-- 格式化输出：%d表示日期,%thread表示线程名,%-5level表示级别从左显示5个字符宽度,%msg表示日志消息,%n表示换行符 --&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">pattern</span>&gt;</span>%d&#123;yyyy-MM-dd HH:mm:ss.SSS&#125; [%thread] %-5level %logger&#123;50&#125; - %msg%n<span class="hljs-tag">&lt;/<span class="hljs-name">pattern</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">charset</span>&gt;</span>UTF-8<span class="hljs-tag">&lt;/<span class="hljs-name">charset</span>&gt;</span> <span class="hljs-comment">&lt;!-- 设置字符集 --&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">encoder</span>&gt;</span><br>        <span class="hljs-comment">&lt;!-- 日志记录器的滚动策略，按日期，按大小记录 --&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">rollingPolicy</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;ch.qos.logback.core.rolling.TimeBasedRollingPolicy&quot;</span>&gt;</span><br>            <span class="hljs-comment">&lt;!-- 日志归档 --&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">fileNamePattern</span>&gt;</span>$&#123;LOG_HOME&#125;/debug/log-debug-%d&#123;yyyy-MM-dd&#125;.%i.log<span class="hljs-tag">&lt;/<span class="hljs-name">fileNamePattern</span>&gt;</span><br>            <span class="hljs-comment">&lt;!-- 除按日志记录之外，还配置了日志文件不能超过100M，若超过100M，日志文件序号+1 --&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">timeBasedFileNamingAndTriggeringPolicy</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;ch.qos.logback.core.rolling.SizeAndTimeBasedFNATP&quot;</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">maxFileSize</span>&gt;</span>100MB<span class="hljs-tag">&lt;/<span class="hljs-name">maxFileSize</span>&gt;</span><br>            <span class="hljs-tag">&lt;/<span class="hljs-name">timeBasedFileNamingAndTriggeringPolicy</span>&gt;</span><br>            <span class="hljs-comment">&lt;!--日志文件保留天数--&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">maxHistory</span>&gt;</span>30<span class="hljs-tag">&lt;/<span class="hljs-name">maxHistory</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">rollingPolicy</span>&gt;</span><br>        <span class="hljs-comment">&lt;!-- 此日志文件只记录debug级别的 --&gt;</span><br>        <span class="hljs-comment">&lt;!-- LevelFilter： 级别过滤器，根据日志级别进行过滤 --&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">filter</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;ch.qos.logback.classic.filter.LevelFilter&quot;</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">level</span>&gt;</span>debug<span class="hljs-tag">&lt;/<span class="hljs-name">level</span>&gt;</span><br>            !-- 用于配置符合过滤条件的操作 ACCEPT：日志会被立即处理，不再经过剩余过滤器 --&gt;<br>            <span class="hljs-tag">&lt;<span class="hljs-name">onMatch</span>&gt;</span>ACCEPT<span class="hljs-tag">&lt;/<span class="hljs-name">onMatch</span>&gt;</span><br>            <span class="hljs-comment">&lt;!-- 用于配置不符合过滤条件的操作 DENY：日志将立即被抛弃不再经过其他过滤器 --&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">onMismatch</span>&gt;</span>DENY<span class="hljs-tag">&lt;/<span class="hljs-name">onMismatch</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">filter</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">appender</span>&gt;</span><br><br>    <span class="hljs-comment">&lt;!-- 时间滚动输出 level为 INFO 日志 --&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">appender</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;INFO_FILE&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;ch.qos.logback.core.rolling.RollingFileAppender&quot;</span>&gt;</span><br>        <span class="hljs-comment">&lt;!-- 正在记录的日志文件的路径及文件名 --&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">file</span>&gt;</span>$&#123;LOG_HOME&#125;/log_info.log<span class="hljs-tag">&lt;/<span class="hljs-name">file</span>&gt;</span><br>        <span class="hljs-comment">&lt;!--日志文件输出格式--&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">encoder</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">pattern</span>&gt;</span>%d&#123;yyyy-MM-dd HH:mm:ss.SSS&#125; [%thread] %-5level %logger&#123;50&#125; - %msg%n<span class="hljs-tag">&lt;/<span class="hljs-name">pattern</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">charset</span>&gt;</span>UTF-8<span class="hljs-tag">&lt;/<span class="hljs-name">charset</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">encoder</span>&gt;</span><br>        <span class="hljs-comment">&lt;!-- 日志记录器的滚动策略，按日期，按大小记录 --&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">rollingPolicy</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;ch.qos.logback.core.rolling.TimeBasedRollingPolicy&quot;</span>&gt;</span><br>            <span class="hljs-comment">&lt;!-- 每天日志归档路径以及格式 --&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">fileNamePattern</span>&gt;</span>$&#123;LOG_HOME&#125;/info/log-info-%d&#123;yyyy-MM-dd&#125;.%i.log<span class="hljs-tag">&lt;/<span class="hljs-name">fileNamePattern</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">timeBasedFileNamingAndTriggeringPolicy</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;ch.qos.logback.core.rolling.SizeAndTimeBasedFNATP&quot;</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">maxFileSize</span>&gt;</span>100MB<span class="hljs-tag">&lt;/<span class="hljs-name">maxFileSize</span>&gt;</span><br>            <span class="hljs-tag">&lt;/<span class="hljs-name">timeBasedFileNamingAndTriggeringPolicy</span>&gt;</span><br>            <span class="hljs-comment">&lt;!--日志文件保留天数--&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">maxHistory</span>&gt;</span>30<span class="hljs-tag">&lt;/<span class="hljs-name">maxHistory</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">rollingPolicy</span>&gt;</span><br>        <span class="hljs-comment">&lt;!-- 此日志文件只记录info级别的 --&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">filter</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;ch.qos.logback.classic.filter.LevelFilter&quot;</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">level</span>&gt;</span>info<span class="hljs-tag">&lt;/<span class="hljs-name">level</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">onMatch</span>&gt;</span>ACCEPT<span class="hljs-tag">&lt;/<span class="hljs-name">onMatch</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">onMismatch</span>&gt;</span>DENY<span class="hljs-tag">&lt;/<span class="hljs-name">onMismatch</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">filter</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">appender</span>&gt;</span><br><br>    <span class="hljs-comment">&lt;!-- 时间滚动输出 level为 WARN 日志 --&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">appender</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;WARN_FILE&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;ch.qos.logback.core.rolling.RollingFileAppender&quot;</span>&gt;</span><br>        <span class="hljs-comment">&lt;!-- 正在记录的日志文件的路径及文件名 --&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">file</span>&gt;</span>$&#123;LOG_HOME&#125;/log_warn.log<span class="hljs-tag">&lt;/<span class="hljs-name">file</span>&gt;</span><br>        <span class="hljs-comment">&lt;!--日志文件输出格式--&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">encoder</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">pattern</span>&gt;</span>%d&#123;yyyy-MM-dd HH:mm:ss.SSS&#125; [%thread] %-5level %logger&#123;50&#125; - %msg%n<span class="hljs-tag">&lt;/<span class="hljs-name">pattern</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">charset</span>&gt;</span>UTF-8<span class="hljs-tag">&lt;/<span class="hljs-name">charset</span>&gt;</span> <span class="hljs-comment">&lt;!-- 此处设置字符集 --&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">encoder</span>&gt;</span><br>        <span class="hljs-comment">&lt;!-- 日志记录器的滚动策略，按日期，按大小记录 --&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">rollingPolicy</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;ch.qos.logback.core.rolling.TimeBasedRollingPolicy&quot;</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">fileNamePattern</span>&gt;</span>$&#123;LOG_HOME&#125;/warn/log-warn-%d&#123;yyyy-MM-dd&#125;.%i.log<span class="hljs-tag">&lt;/<span class="hljs-name">fileNamePattern</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">timeBasedFileNamingAndTriggeringPolicy</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;ch.qos.logback.core.rolling.SizeAndTimeBasedFNATP&quot;</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">maxFileSize</span>&gt;</span>100MB<span class="hljs-tag">&lt;/<span class="hljs-name">maxFileSize</span>&gt;</span><br>            <span class="hljs-tag">&lt;/<span class="hljs-name">timeBasedFileNamingAndTriggeringPolicy</span>&gt;</span><br>            <span class="hljs-comment">&lt;!--日志文件保留天数--&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">maxHistory</span>&gt;</span>30<span class="hljs-tag">&lt;/<span class="hljs-name">maxHistory</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">rollingPolicy</span>&gt;</span><br>        <span class="hljs-comment">&lt;!-- 此日志文件只记录warn级别的 --&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">filter</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;ch.qos.logback.classic.filter.LevelFilter&quot;</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">level</span>&gt;</span>warn<span class="hljs-tag">&lt;/<span class="hljs-name">level</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">onMatch</span>&gt;</span>ACCEPT<span class="hljs-tag">&lt;/<span class="hljs-name">onMatch</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">onMismatch</span>&gt;</span>DENY<span class="hljs-tag">&lt;/<span class="hljs-name">onMismatch</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">filter</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">appender</span>&gt;</span><br><br><br>    <span class="hljs-comment">&lt;!-- 时间滚动输出 level为 ERROR 日志 --&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">appender</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;ERROR_FILE&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;ch.qos.logback.core.rolling.RollingFileAppender&quot;</span>&gt;</span><br>        <span class="hljs-comment">&lt;!-- 正在记录的日志文件的路径及文件名 --&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">file</span>&gt;</span>$&#123;LOG_HOME&#125;/log_error.log<span class="hljs-tag">&lt;/<span class="hljs-name">file</span>&gt;</span><br>        <span class="hljs-comment">&lt;!--日志文件输出格式--&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">encoder</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">pattern</span>&gt;</span>%d&#123;yyyy-MM-dd HH:mm:ss.SSS&#125; [%thread] %-5level %logger&#123;50&#125; - %msg%n<span class="hljs-tag">&lt;/<span class="hljs-name">pattern</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">charset</span>&gt;</span>UTF-8<span class="hljs-tag">&lt;/<span class="hljs-name">charset</span>&gt;</span> <span class="hljs-comment">&lt;!-- 此处设置字符集 --&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">encoder</span>&gt;</span><br>        <span class="hljs-comment">&lt;!-- 日志记录器的滚动策略，按日期，按大小记录 --&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">rollingPolicy</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;ch.qos.logback.core.rolling.TimeBasedRollingPolicy&quot;</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">fileNamePattern</span>&gt;</span>$&#123;LOG_HOME&#125;/error/log-error-%d&#123;yyyy-MM-dd&#125;.%i.log<span class="hljs-tag">&lt;/<span class="hljs-name">fileNamePattern</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">timeBasedFileNamingAndTriggeringPolicy</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;ch.qos.logback.core.rolling.SizeAndTimeBasedFNATP&quot;</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">maxFileSize</span>&gt;</span>100MB<span class="hljs-tag">&lt;/<span class="hljs-name">maxFileSize</span>&gt;</span><br>            <span class="hljs-tag">&lt;/<span class="hljs-name">timeBasedFileNamingAndTriggeringPolicy</span>&gt;</span><br>            <span class="hljs-comment">&lt;!--日志文件保留天数--&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">maxHistory</span>&gt;</span>15<span class="hljs-tag">&lt;/<span class="hljs-name">maxHistory</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">rollingPolicy</span>&gt;</span><br>        <span class="hljs-comment">&lt;!-- 此日志文件只记录ERROR级别的 --&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">filter</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;ch.qos.logback.classic.filter.LevelFilter&quot;</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">level</span>&gt;</span>ERROR<span class="hljs-tag">&lt;/<span class="hljs-name">level</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">onMatch</span>&gt;</span>ACCEPT<span class="hljs-tag">&lt;/<span class="hljs-name">onMatch</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">onMismatch</span>&gt;</span>DENY<span class="hljs-tag">&lt;/<span class="hljs-name">onMismatch</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">filter</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">appender</span>&gt;</span><br><br>    <span class="hljs-comment">&lt;!--</span><br><span class="hljs-comment">        &lt;logger&gt;用来设置某一个包或者具体的某一个类的日志打印级别、以及指定&lt;appender&gt;。</span><br><span class="hljs-comment">        &lt;logger&gt;仅有一个name属性，一个可选的level和一个可选的addtivity属性。</span><br><span class="hljs-comment">        name:用来指定受此logger约束的某一个包或者具体的某一个类。</span><br><span class="hljs-comment">        level:用来设置打印级别，大小写无关：TRACE, DEBUG, INFO, WARN, ERROR, ALL 和 OFF，</span><br><span class="hljs-comment">              还有一个特殊值INHERITED或者同义词NULL，代表强制执行上级的级别。</span><br><span class="hljs-comment">              如果未设置此属性，那么当前logger将会继承上级的级别。</span><br><span class="hljs-comment">        addtivity:是否向上级logger传递打印信息。默认是true。</span><br><span class="hljs-comment">        &lt;logger&gt;可以包含零个或多个&lt;appender-ref&gt;元素，标识这个appender将会添加到这个logger</span><br><span class="hljs-comment">    --&gt;</span><br>    <span class="hljs-comment">&lt;!--&lt;logger name=&quot;org.springframework.web&quot; level=&quot;info&quot;/&gt;--&gt;</span><br>    <span class="hljs-comment">&lt;!--&lt;logger name=&quot;org.springframework.scheduling.annotation.ScheduledAnnotationBeanPostProcessor&quot; level=&quot;INFO&quot;/&gt;--&gt;</span><br>    <span class="hljs-comment">&lt;!--</span><br><span class="hljs-comment">        使用mybatis的时候，sql语句是debug下才会打印，而这里我们只配置了info，所以想要查看sql语句的话，有以下两种操作：</span><br><span class="hljs-comment">        第一种把&lt;root level=&quot;INFO&quot;&gt;改成&lt;root level=&quot;DEBUG&quot;&gt;这样就会打印sql，不过这样日志那边会出现很多其他消息</span><br><span class="hljs-comment">        第二种就是单独给dao下目录配置debug模式，代码如下，这样配置sql语句会打印，其他还是正常info级别：</span><br><span class="hljs-comment">     --&gt;</span><br><br><br>    <span class="hljs-comment">&lt;!--</span><br><span class="hljs-comment">        root节点是必选节点，用来指定最基础的日志输出级别，只有一个level属性</span><br><span class="hljs-comment">        level:用来设置打印级别，大小写无关：TRACE, DEBUG, INFO, WARN, ERROR, ALL 和 OFF，</span><br><span class="hljs-comment">        不能设置为INHERITED或者同义词NULL。默认是DEBUG</span><br><span class="hljs-comment">        可以包含零个或多个元素，标识这个appender将会添加到这个logger。</span><br><span class="hljs-comment">    --&gt;</span><br><br>    <span class="hljs-comment">&lt;!--开发环境:打印控制台--&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">springProfile</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;dev&quot;</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">logger</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;com.atguigu.log&quot;</span> <span class="hljs-attr">level</span>=<span class="hljs-string">&quot;debug&quot;</span>/&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">springProfile</span>&gt;</span><br><br>    <span class="hljs-comment">&lt;!-- 日志输出级别 开发环境DEBUG 生产环境INFO --&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">root</span> <span class="hljs-attr">level</span>=<span class="hljs-string">&quot;DEBUG&quot;</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">appender-ref</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">&quot;CONSOLE&quot;</span> /&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">appender-ref</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">&quot;DEBUG_FILE&quot;</span> /&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">appender-ref</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">&quot;INFO_FILE&quot;</span> /&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">appender-ref</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">&quot;WARN_FILE&quot;</span> /&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">appender-ref</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">&quot;ERROR_FILE&quot;</span> /&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">root</span>&gt;</span><br><br>    <span class="hljs-comment">&lt;!--生产环境:输出到文件--&gt;</span><br>    <span class="hljs-comment">&lt;!--&lt;springProfile name=&quot;pro&quot;&gt;--&gt;</span><br>    <span class="hljs-comment">&lt;!--&lt;root level=&quot;info&quot;&gt;--&gt;</span><br>    <span class="hljs-comment">&lt;!--&lt;appender-ref ref=&quot;CONSOLE&quot; /&gt;--&gt;</span><br>    <span class="hljs-comment">&lt;!--&lt;appender-ref ref=&quot;DEBUG_FILE&quot; /&gt;--&gt;</span><br>    <span class="hljs-comment">&lt;!--&lt;appender-ref ref=&quot;INFO_FILE&quot; /&gt;--&gt;</span><br>    <span class="hljs-comment">&lt;!--&lt;appender-ref ref=&quot;ERROR_FILE&quot; /&gt;--&gt;</span><br>    <span class="hljs-comment">&lt;!--&lt;appender-ref ref=&quot;WARN_FILE&quot; /&gt;--&gt;</span><br>    <span class="hljs-comment">&lt;!--&lt;/root&gt;--&gt;</span><br>    <span class="hljs-comment">&lt;!--&lt;/springProfile&gt;--&gt;</span><br><br><span class="hljs-tag">&lt;/<span class="hljs-name">configuration</span>&gt;</span><br></code></pre></td></tr></table></figure>

<p>编写 @userAccess 注解</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Target(&#123;ElementType.METHOD,ElementType.TYPE&#125;)</span><br><span class="hljs-meta">@Retention(RetentionPolicy.RUNTIME)</span><br><span class="hljs-keyword">public</span> <span class="hljs-meta">@interface</span> UserAccess &#123;<br>    String <span class="hljs-title function_">desc</span><span class="hljs-params">()</span> <span class="hljs-keyword">default</span> <span class="hljs-string">&quot;无信息&quot;</span>;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>编写 UserAccessAspect</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Component</span><br><span class="hljs-meta">@Aspect</span><br><span class="hljs-meta">@Slf4j</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserAccessAspect</span> &#123;<br><br>    <span class="hljs-meta">@Pointcut(value = &quot;@annotation(com.wscode.boot.aop.aspect.UserAccess)&quot;)</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">access</span><span class="hljs-params">()</span> &#123;&#125;<br><br>    <span class="hljs-meta">@Before(&quot;access()&quot;)</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">deBefore</span><span class="hljs-params">(JoinPoint joinPoint)</span> <span class="hljs-keyword">throws</span> Throwable &#123;<br>        log.info(<span class="hljs-string">&quot;second before&quot;</span>);<br>    &#125;<br><br>    <span class="hljs-meta">@Around(&quot;@annotation(userAccess)&quot;)</span><br>    <span class="hljs-keyword">public</span> Object <span class="hljs-title function_">around</span><span class="hljs-params">(ProceedingJoinPoint pjp, UserAccess userAccess)</span> &#123;<br>        <span class="hljs-comment">//获取注解里的值</span><br>        System.out.println();<br>        log.info(<span class="hljs-string">&quot;second around:&#123;&#125;&quot;</span> , userAccess.desc());<br>        <span class="hljs-keyword">try</span> &#123;<br>            <span class="hljs-keyword">return</span> pjp.proceed();<br>        &#125; <span class="hljs-keyword">catch</span> (Throwable throwable) &#123;<br>            throwable.printStackTrace();<br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>当用户发出请求，请求的方法上面有@UserAccess注解，会被这个Aspect拦截到，在内部可以根据传过来的值做一些处理……</p>
<p>编写一个 日志切面 [<strong>会记录请求的详细信息到日志系统中</strong>]</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.wscode.boot.aop.aspect;<br><br><span class="hljs-keyword">import</span> lombok.extern.slf4j.Slf4j;<br><span class="hljs-keyword">import</span> org.aspectj.lang.JoinPoint;<br><span class="hljs-keyword">import</span> org.aspectj.lang.ProceedingJoinPoint;<br><span class="hljs-keyword">import</span> org.aspectj.lang.annotation.*;<br><span class="hljs-keyword">import</span> org.springframework.web.context.request.RequestContextHolder;<br><span class="hljs-keyword">import</span> org.springframework.web.context.request.ServletRequestAttributes;<br><br><span class="hljs-keyword">import</span> javax.servlet.http.HttpServletRequest;<br><span class="hljs-keyword">import</span> java.util.Arrays;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 日志切面</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@author</span> 温笙</span><br><span class="hljs-comment"> */</span><br><span class="hljs-meta">@Slf4j</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">LogAspect</span> &#123;<br><br><br>    <span class="hljs-meta">@Pointcut(&quot;execution(public * com.wscode.boot.aop.controller.*.*(..))&quot;)</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">weblog</span><span class="hljs-params">()</span>&#123;&#125;<br><br>    <span class="hljs-meta">@Before(&quot;weblog()&quot;)</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">doBefore</span><span class="hljs-params">(JoinPoint joinPoint)</span>&#123;<br>        <span class="hljs-comment">// 接收到请求，记录请求内容</span><br>        <span class="hljs-type">ServletRequestAttributes</span> <span class="hljs-variable">requestAttributes</span> <span class="hljs-operator">=</span> (ServletRequestAttributes) RequestContextHolder.getRequestAttributes();<br><br>        <span class="hljs-keyword">assert</span> requestAttributes != <span class="hljs-literal">null</span>;<br>        <span class="hljs-type">HttpServletRequest</span> <span class="hljs-variable">request</span> <span class="hljs-operator">=</span> requestAttributes.getRequest();<br><br>        <span class="hljs-comment">// 记录请求内容</span><br>        log.info(<span class="hljs-string">&quot;URL : &#123;&#125;&quot;</span>,request.getRequestURL().toString());<br>        log.info(<span class="hljs-string">&quot;http_method : &#123;&#125;&quot;</span>,request.getMethod());<br>        log.info(<span class="hljs-string">&quot;IP : &#123;&#125;&quot;</span>,request.getRemoteAddr());<br>        log.info(<span class="hljs-string">&quot;class_method : &#123;&#125;&quot;</span>,joinPoint.getSignature().getDeclaringTypeName()+<span class="hljs-string">&quot;.&quot;</span>+joinPoint.getSignature().getName());<br>        log.info(<span class="hljs-string">&quot;args : &#123;&#125;&quot;</span>, Arrays.toString(joinPoint.getArgs()));<br>    &#125;<br><br>    <span class="hljs-meta">@AfterReturning(returning = &quot;ret&quot;, pointcut = &quot;weblog()&quot;)</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">doAfterReturning</span><span class="hljs-params">(Object ret)</span>&#123;<br>        <span class="hljs-comment">// 处理完毕请求，返回内容</span><br>        log.info(<span class="hljs-string">&quot;方法的返回值:&#123;&#125;&quot;</span>,ret);<br>    &#125;<br><br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 后置异常通知</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> joinPoint 切入点</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-meta">@AfterThrowing(&quot;weblog()&quot;)</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">throwsContent</span><span class="hljs-params">(JoinPoint joinPoint)</span>&#123;<br>        log.info(<span class="hljs-string">&quot;后置异常通知===&gt;方法异常:&#123;&#125;&quot;</span>,joinPoint.getSignature().getName());<br>    &#125;<br><br>    <span class="hljs-meta">@After(&quot;weblog()&quot;)</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">after</span><span class="hljs-params">(JoinPoint joinPoint)</span>&#123;<br>        log.info(<span class="hljs-string">&quot;后置最终通知,final增强，不管是抛出异常或者正常退出都会执行==&gt;切入点：&#123;&#125;&quot;</span>,joinPoint);<br>    &#125;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 环绕通知,环绕增强，相当于MethodInterceptor</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> pjp</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment">     * <span class="hljs-doctag">@throws</span> Throwable</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-meta">@Around(&quot;webLog()&quot;)</span><br>    <span class="hljs-keyword">public</span> Object <span class="hljs-title function_">around</span><span class="hljs-params">(ProceedingJoinPoint pjp)</span> <span class="hljs-keyword">throws</span> Throwable&#123;<br>        log.info(<span class="hljs-string">&quot;方法环绕start.....&quot;</span>);<br>        <span class="hljs-keyword">try</span> &#123;<br>            <span class="hljs-type">Object</span> <span class="hljs-variable">o</span> <span class="hljs-operator">=</span>  pjp.proceed();<br>            System.out.println(<span class="hljs-string">&quot;方法环绕proceed，结果是 :&quot;</span> + o);<br>            <span class="hljs-keyword">return</span> o;<br>        &#125; <span class="hljs-keyword">catch</span> (Throwable e) &#123;<br>            <span class="hljs-keyword">throw</span> e;<br>        &#125;<br>    &#125;<br><br><br><br><br>&#125;<br></code></pre></td></tr></table></figure>

<p>测试 请求</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Component</span><br><span class="hljs-meta">@Aspect</span><br><span class="hljs-meta">@Slf4j</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserAccessAspect</span> &#123;<br><br>    <span class="hljs-meta">@Pointcut(value = &quot;@annotation(com.wscode.boot.aop.aspect.UserAccess)&quot;)</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">access</span><span class="hljs-params">()</span> &#123;&#125;<br><br>    <span class="hljs-meta">@Before(&quot;access()&quot;)</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">deBefore</span><span class="hljs-params">(JoinPoint joinPoint)</span> <span class="hljs-keyword">throws</span> Throwable &#123;<br>        log.info(<span class="hljs-string">&quot;second before&quot;</span>);<br>    &#125;<br><br>    <span class="hljs-meta">@Around(&quot;@annotation(userAccess)&quot;)</span><br>    <span class="hljs-keyword">public</span> Object <span class="hljs-title function_">around</span><span class="hljs-params">(ProceedingJoinPoint pjp, UserAccess userAccess)</span> &#123;<br>        <span class="hljs-comment">//获取注解里的值</span><br>        System.out.println();<br>        log.info(<span class="hljs-string">&quot;second around:&#123;&#125;&quot;</span> , userAccess.desc());<br>        <span class="hljs-keyword">try</span> &#123;<br>            <span class="hljs-keyword">return</span> pjp.proceed();<br>        &#125; <span class="hljs-keyword">catch</span> (Throwable throwable) &#123;<br>            throwable.printStackTrace();<br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>


              
            </div>
            <hr/>
            <div>
              <div class="post-metas my-3">
  
    <div class="post-meta mr-3 d-flex align-items-center">
      <i class="iconfont icon-category"></i>
      

<span class="category-chains">
  
  
    
      <span class="category-chain">
        
  <a href="/categories/springboot/" class="category-chain-item">springboot</a>
  
  

      </span>
    
  
</span>

    </div>
  
  
</div>


              
  

  <div class="license-box my-3">
    <div class="license-title">
      <div>SpringBoot日志框架</div>
      <div>http://example.com/2022/05/20/SpringBoot日志框架/</div>
    </div>
    <div class="license-meta">
      
        <div class="license-meta-item">
          <div>作者</div>
          <div>温笙</div>
        </div>
      
      
        <div class="license-meta-item license-meta-date">
          <div>发布于</div>
          <div>2022年5月20日</div>
        </div>
      
      
      <div class="license-meta-item">
        <div>许可协议</div>
        <div>
          
            
            
              <a target="_blank" href="https://creativecommons.org/licenses/by/4.0/">
              <span class="hint--top hint--rounded" aria-label="BY - 署名">
                <i class="iconfont icon-by"></i>
              </span>
              </a>
            
          
        </div>
      </div>
    </div>
    <div class="license-icon iconfont"></div>
  </div>



              
                <div class="post-prevnext my-3">
                  <article class="post-prev col-6">
                    
                    
                      <a href="/2022/06/04/%E7%AC%AC%E5%9B%9B%E7%AB%A0SpringBoot%E7%9A%84web%E9%85%8D%E7%BD%AE/" title="第四章SpringBoot的web配置">
                        <i class="iconfont icon-arrowleft"></i>
                        <span class="hidden-mobile">第四章SpringBoot的web配置</span>
                        <span class="visible-mobile">上一篇</span>
                      </a>
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/2022/05/20/%E7%AC%AC%E4%B8%89%E7%AB%A0SpringBoot%E8%A7%86%E5%9B%BE%E5%B1%82%E9%85%8D%E7%BD%AE-2/" title="第三章SpringBoot视图层配置(2)">
                        <span class="hidden-mobile">第三章SpringBoot视图层配置(2)</span>
                        <span class="visible-mobile">下一篇</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
          </article>
        </div>
      </div>
    </div>

    <div class="side-col d-none d-lg-block col-lg-2">
      
  <aside class="sidebar" style="margin-left: -1rem">
    <div id="toc">
  <p class="toc-header"><i class="iconfont icon-list"></i>&nbsp;目录</p>
  <div class="toc-body" id="toc-body"></div>
</div>



  </aside>


    </div>
  </div>
</div>





  



  



  



  



  






    

    
      <a id="scroll-top-button" aria-label="TOP" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">搜索</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v" for="local-search-input">关键词</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>

    

    
  </main>

  <footer>
    <div class="footer-inner">
  
    <div class="footer-content">
       <a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a> <i class="iconfont icon-love"></i> <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"><span>Fluid</span></a> 
    </div>
  
  
  
  
</div>

  </footer>

  <!-- Scripts -->
  
  <script  src="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://lib.baomitu.com/jquery/3.6.0/jquery.min.js" ></script>
<script  src="https://lib.baomitu.com/twitter-bootstrap/4.6.1/js/bootstrap.min.js" ></script>
<script  src="/js/events.js" ></script>
<script  src="/js/plugins.js" ></script>


  <script  src="https://lib.baomitu.com/typed.js/2.0.12/typed.min.js" ></script>
  <script>
    (function (window, document) {
      var typing = Fluid.plugins.typing;
      var subtitle = document.getElementById('subtitle');
      if (!subtitle || !typing) {
        return;
      }
      var text = subtitle.getAttribute('data-typed-text');
      
        typing(text);
      
    })(window, document);
  </script>






  
    <script  src="/js/img-lazyload.js" ></script>
  




  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/tocbot/4.18.0/tocbot.min.js', function() {
    var toc = jQuery('#toc');
    if (toc.length === 0 || !window.tocbot) { return; }
    var boardCtn = jQuery('#board-ctn');
    var boardTop = boardCtn.offset().top;

    window.tocbot.init({
      tocSelector     : '#toc-body',
      contentSelector : '.markdown-body',
      headingSelector : CONFIG.toc.headingSelector || 'h1,h2,h3,h4,h5,h6',
      linkClass       : 'tocbot-link',
      activeLinkClass : 'tocbot-active-link',
      listClass       : 'tocbot-list',
      isCollapsedClass: 'tocbot-is-collapsed',
      collapsibleClass: 'tocbot-is-collapsible',
      collapseDepth   : CONFIG.toc.collapseDepth || 0,
      scrollSmooth    : true,
      headingsOffset  : -boardTop
    });
    if (toc.find('.toc-list-item').length > 0) {
      toc.css('visibility', 'visible');
    }
  });
</script>


  <script>
  (function() {
    var enableLang = CONFIG.code_language.enable && CONFIG.code_language.default;
    var enableCopy = CONFIG.copy_btn;
    if (!enableLang && !enableCopy) {
      return;
    }

    function getBgClass(ele) {
      return Fluid.utils.getBackgroundLightness(ele) >= 0 ? 'code-widget-light' : 'code-widget-dark';
    }

    var copyTmpl = '';
    copyTmpl += '<div class="code-widget">';
    copyTmpl += 'LANG';
    copyTmpl += '</div>';
    jQuery('.markdown-body pre').each(function() {
      var $pre = jQuery(this);
      if ($pre.find('code.mermaid').length > 0) {
        return;
      }
      if ($pre.find('span.line').length > 0) {
        return;
      }

      var lang = '';

      if (enableLang) {
        lang = CONFIG.code_language.default;
        if ($pre[0].children.length > 0 && $pre[0].children[0].classList.length >= 2 && $pre.children().hasClass('hljs')) {
          lang = $pre[0].children[0].classList[1];
        } else if ($pre[0].getAttribute('data-language')) {
          lang = $pre[0].getAttribute('data-language');
        } else if ($pre.parent().hasClass('sourceCode') && $pre[0].children.length > 0 && $pre[0].children[0].classList.length >= 2) {
          lang = $pre[0].children[0].classList[1];
          $pre.parent().addClass('code-wrapper');
        } else if ($pre.parent().hasClass('markdown-body') && $pre[0].classList.length === 0) {
          $pre.wrap('<div class="code-wrapper"></div>');
        }
        lang = lang.toUpperCase().replace('NONE', CONFIG.code_language.default);
      }
      $pre.append(copyTmpl.replace('LANG', lang).replace('code-widget">',
        getBgClass($pre[0]) + (enableCopy ? ' code-widget copy-btn" data-clipboard-snippet><i class="iconfont icon-copy"></i>' : ' code-widget">')));

      if (enableCopy) {
        Fluid.utils.createScript('https://lib.baomitu.com/clipboard.js/2.0.10/clipboard.min.js', function() {
          var clipboard = new window.ClipboardJS('.copy-btn', {
            target: function(trigger) {
              var nodes = trigger.parentNode.childNodes;
              for (var i = 0; i < nodes.length; i++) {
                if (nodes[i].tagName === 'CODE') {
                  return nodes[i];
                }
              }
            }
          });
          clipboard.on('success', function(e) {
            e.clearSelection();
            e.trigger.innerHTML = e.trigger.innerHTML.replace('icon-copy', 'icon-success');
            setTimeout(function() {
              e.trigger.innerHTML = e.trigger.innerHTML.replace('icon-success', 'icon-copy');
            }, 2000);
          });
        });
      }
    });
  })();
</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/anchor-js/4.3.1/anchor.min.js', function() {
    window.anchors.options = {
      placement: CONFIG.anchorjs.placement,
      visible  : CONFIG.anchorjs.visible
    };
    if (CONFIG.anchorjs.icon) {
      window.anchors.options.icon = CONFIG.anchorjs.icon;
    }
    var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
    var res = [];
    for (var item of el) {
      res.push('.markdown-body > ' + item.trim());
    }
    if (CONFIG.anchorjs.placement === 'left') {
      window.anchors.options.class = 'anchorjs-link-left';
    }
    window.anchors.add(res.join(', '));
  });
</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.js', function() {
    Fluid.plugins.fancyBox();
  });
</script>


  <script>Fluid.plugins.imageCaption();</script>

  <script  src="/js/local-search.js" ></script>





<!-- 主题的启动项，将它保持在最底部 -->
<!-- the boot of the theme, keep it at the bottom -->
<script  src="/js/boot.js" ></script>


  

  <noscript>
    <div class="noscript-warning">博客在允许 JavaScript 运行的环境下浏览效果更佳</div>
  </noscript>
</body>
</html>
